"use strict";!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).index=e()}}((function(){return function e(t,i,n){function s(r,o){if(!i[r]){if(!t[r]){var c="function"==typeof require&&require;if(!o&&c)return c(r,!0);if(a)return a(r,!0);var d=new Error("Cannot find module '"+r+"'");throw d.code="MODULE_NOT_FOUND",d}var l=i[r]={exports:{}};t[r][0].call(l.exports,(function(e){return s(t[r][1][e]||e)}),l,l.exports,e,t,i,n)}return i[r].exports}for(var a="function"==typeof require&&require,r=0;r<n.length;r++)s(n[r]);return s}({1:[function(e,t,i){var n=e("./_hashClear"),s=e("./_hashDelete"),a=e("./_hashGet"),r=e("./_hashHas"),o=e("./_hashSet");function c(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}c.prototype.clear=n,c.prototype.delete=s,c.prototype.get=a,c.prototype.has=r,c.prototype.set=o,t.exports=c},{"./_hashClear":43,"./_hashDelete":44,"./_hashGet":45,"./_hashHas":46,"./_hashSet":47}],2:[function(e,t,i){var n=e("./_listCacheClear"),s=e("./_listCacheDelete"),a=e("./_listCacheGet"),r=e("./_listCacheHas"),o=e("./_listCacheSet");function c(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}c.prototype.clear=n,c.prototype.delete=s,c.prototype.get=a,c.prototype.has=r,c.prototype.set=o,t.exports=c},{"./_listCacheClear":54,"./_listCacheDelete":55,"./_listCacheGet":56,"./_listCacheHas":57,"./_listCacheSet":58}],3:[function(e,t,i){var n=e("./_getNative")(e("./_root"),"Map");t.exports=n},{"./_getNative":39,"./_root":70}],4:[function(e,t,i){var n=e("./_mapCacheClear"),s=e("./_mapCacheDelete"),a=e("./_mapCacheGet"),r=e("./_mapCacheHas"),o=e("./_mapCacheSet");function c(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var n=e[t];this.set(n[0],n[1])}}c.prototype.clear=n,c.prototype.delete=s,c.prototype.get=a,c.prototype.has=r,c.prototype.set=o,t.exports=c},{"./_mapCacheClear":59,"./_mapCacheDelete":60,"./_mapCacheGet":61,"./_mapCacheHas":62,"./_mapCacheSet":63}],5:[function(e,t,i){var n=e("./_ListCache"),s=e("./_stackClear"),a=e("./_stackDelete"),r=e("./_stackGet"),o=e("./_stackHas"),c=e("./_stackSet");function d(e){var t=this.__data__=new n(e);this.size=t.size}d.prototype.clear=s,d.prototype.delete=a,d.prototype.get=r,d.prototype.has=o,d.prototype.set=c,t.exports=d},{"./_ListCache":2,"./_stackClear":74,"./_stackDelete":75,"./_stackGet":76,"./_stackHas":77,"./_stackSet":78}],6:[function(e,t,i){var n=e("./_root").Symbol;t.exports=n},{"./_root":70}],7:[function(e,t,i){var n=e("./_root").Uint8Array;t.exports=n},{"./_root":70}],8:[function(e,t,i){t.exports=function(e,t,i){switch(i.length){case 0:return e.call(t);case 1:return e.call(t,i[0]);case 2:return e.call(t,i[0],i[1]);case 3:return e.call(t,i[0],i[1],i[2])}return e.apply(t,i)}},{}],9:[function(e,t,i){var n=e("./_baseTimes"),s=e("./isArguments"),a=e("./isArray"),r=e("./isBuffer"),o=e("./_isIndex"),c=e("./isTypedArray"),d=Object.prototype.hasOwnProperty;t.exports=function(e,t){var i=a(e),l=!i&&s(e),h=!i&&!l&&r(e),p=!i&&!l&&!h&&c(e),u=i||l||h||p,m=u?n(e.length,String):[],g=m.length;for(var f in e)!t&&!d.call(e,f)||u&&("length"==f||h&&("offset"==f||"parent"==f)||p&&("buffer"==f||"byteLength"==f||"byteOffset"==f)||o(f,g))||m.push(f);return m}},{"./_baseTimes":25,"./_isIndex":49,"./isArguments":84,"./isArray":85,"./isBuffer":88,"./isTypedArray":94}],10:[function(e,t,i){var n=e("./_baseAssignValue"),s=e("./eq");t.exports=function(e,t,i){(void 0!==i&&!s(e[t],i)||void 0===i&&!(t in e))&&n(e,t,i)}},{"./_baseAssignValue":13,"./eq":82}],11:[function(e,t,i){var n=e("./_baseAssignValue"),s=e("./eq"),a=Object.prototype.hasOwnProperty;t.exports=function(e,t,i){var r=e[t];a.call(e,t)&&s(r,i)&&(void 0!==i||t in e)||n(e,t,i)}},{"./_baseAssignValue":13,"./eq":82}],12:[function(e,t,i){var n=e("./eq");t.exports=function(e,t){for(var i=e.length;i--;)if(n(e[i][0],t))return i;return-1}},{"./eq":82}],13:[function(e,t,i){var n=e("./_defineProperty");t.exports=function(e,t,i){"__proto__"==t&&n?n(e,t,{configurable:!0,enumerable:!0,value:i,writable:!0}):e[t]=i}},{"./_defineProperty":36}],14:[function(e,t,i){var n=e("./isObject"),s=Object.create,a=function(){function e(){}return function(t){if(!n(t))return{};if(s)return s(t);e.prototype=t;var i=new e;return e.prototype=void 0,i}}();t.exports=a},{"./isObject":91}],15:[function(e,t,i){var n=e("./_createBaseFor")();t.exports=n},{"./_createBaseFor":34}],16:[function(e,t,i){var n=e("./_Symbol"),s=e("./_getRawTag"),a=e("./_objectToString"),r=n?n.toStringTag:void 0;t.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":r&&r in Object(e)?s(e):a(e)}},{"./_Symbol":6,"./_getRawTag":41,"./_objectToString":67}],17:[function(e,t,i){var n=e("./_baseGetTag"),s=e("./isObjectLike");t.exports=function(e){return s(e)&&"[object Arguments]"==n(e)}},{"./_baseGetTag":16,"./isObjectLike":92}],18:[function(e,t,i){var n=e("./isFunction"),s=e("./_isMasked"),a=e("./isObject"),r=e("./_toSource"),o=/^\[object .+?Constructor\]$/,c=Function.prototype,d=Object.prototype,l=c.toString,h=d.hasOwnProperty,p=RegExp("^"+l.call(h).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");t.exports=function(e){return!(!a(e)||s(e))&&(n(e)?p:o).test(r(e))}},{"./_isMasked":52,"./_toSource":79,"./isFunction":89,"./isObject":91}],19:[function(e,t,i){var n=e("./_baseGetTag"),s=e("./isLength"),a=e("./isObjectLike"),r={};r["[object Float32Array]"]=r["[object Float64Array]"]=r["[object Int8Array]"]=r["[object Int16Array]"]=r["[object Int32Array]"]=r["[object Uint8Array]"]=r["[object Uint8ClampedArray]"]=r["[object Uint16Array]"]=r["[object Uint32Array]"]=!0,r["[object Arguments]"]=r["[object Array]"]=r["[object ArrayBuffer]"]=r["[object Boolean]"]=r["[object DataView]"]=r["[object Date]"]=r["[object Error]"]=r["[object Function]"]=r["[object Map]"]=r["[object Number]"]=r["[object Object]"]=r["[object RegExp]"]=r["[object Set]"]=r["[object String]"]=r["[object WeakMap]"]=!1,t.exports=function(e){return a(e)&&s(e.length)&&!!r[n(e)]}},{"./_baseGetTag":16,"./isLength":90,"./isObjectLike":92}],20:[function(e,t,i){var n=e("./isObject"),s=e("./_isPrototype"),a=e("./_nativeKeysIn"),r=Object.prototype.hasOwnProperty;t.exports=function(e){if(!n(e))return a(e);var t=s(e),i=[];for(var o in e)("constructor"!=o||!t&&r.call(e,o))&&i.push(o);return i}},{"./_isPrototype":53,"./_nativeKeysIn":65,"./isObject":91}],21:[function(e,t,i){var n=e("./_Stack"),s=e("./_assignMergeValue"),a=e("./_baseFor"),r=e("./_baseMergeDeep"),o=e("./isObject"),c=e("./keysIn"),d=e("./_safeGet");t.exports=function e(t,i,l,h,p){t!==i&&a(i,(function(a,c){if(p||(p=new n),o(a))r(t,i,c,l,e,h,p);else{var u=h?h(d(t,c),a,c+"",t,i,p):void 0;void 0===u&&(u=a),s(t,c,u)}}),c)}},{"./_Stack":5,"./_assignMergeValue":10,"./_baseFor":15,"./_baseMergeDeep":22,"./_safeGet":71,"./isObject":91,"./keysIn":95}],22:[function(e,t,i){var n=e("./_assignMergeValue"),s=e("./_cloneBuffer"),a=e("./_cloneTypedArray"),r=e("./_copyArray"),o=e("./_initCloneObject"),c=e("./isArguments"),d=e("./isArray"),l=e("./isArrayLikeObject"),h=e("./isBuffer"),p=e("./isFunction"),u=e("./isObject"),m=e("./isPlainObject"),g=e("./isTypedArray"),f=e("./_safeGet"),v=e("./toPlainObject");t.exports=function(e,t,i,b,C,y,S){var E=f(e,i),T=f(t,i),I=S.get(T);if(I)n(e,i,I);else{var k=y?y(E,T,i+"",e,t,S):void 0,w=void 0===k;if(w){var R=d(T),P=!R&&h(T),x=!R&&!P&&g(T);k=T,R||P||x?d(E)?k=E:l(E)?k=r(E):P?(w=!1,k=s(T,!0)):x?(w=!1,k=a(T,!0)):k=[]:m(T)||c(T)?(k=E,c(E)?k=v(E):u(E)&&!p(E)||(k=o(T))):w=!1}w&&(S.set(T,k),C(k,T,b,y,S),S.delete(T)),n(e,i,k)}}},{"./_assignMergeValue":10,"./_cloneBuffer":28,"./_cloneTypedArray":29,"./_copyArray":30,"./_initCloneObject":48,"./_safeGet":71,"./isArguments":84,"./isArray":85,"./isArrayLikeObject":87,"./isBuffer":88,"./isFunction":89,"./isObject":91,"./isPlainObject":93,"./isTypedArray":94,"./toPlainObject":98}],23:[function(e,t,i){var n=e("./identity"),s=e("./_overRest"),a=e("./_setToString");t.exports=function(e,t){return a(s(e,t,n),e+"")}},{"./_overRest":69,"./_setToString":72,"./identity":83}],24:[function(e,t,i){var n=e("./constant"),s=e("./_defineProperty"),a=e("./identity"),r=s?function(e,t){return s(e,"toString",{configurable:!0,enumerable:!1,value:n(t),writable:!0})}:a;t.exports=r},{"./_defineProperty":36,"./constant":80,"./identity":83}],25:[function(e,t,i){t.exports=function(e,t){for(var i=-1,n=Array(e);++i<e;)n[i]=t(i);return n}},{}],26:[function(e,t,i){t.exports=function(e){return function(t){return e(t)}}},{}],27:[function(e,t,i){var n=e("./_Uint8Array");t.exports=function(e){var t=new e.constructor(e.byteLength);return new n(t).set(new n(e)),t}},{"./_Uint8Array":7}],28:[function(e,t,i){var n=e("./_root"),s="object"==typeof i&&i&&!i.nodeType&&i,a=s&&"object"==typeof t&&t&&!t.nodeType&&t,r=a&&a.exports===s?n.Buffer:void 0,o=r?r.allocUnsafe:void 0;t.exports=function(e,t){if(t)return e.slice();var i=e.length,n=o?o(i):new e.constructor(i);return e.copy(n),n}},{"./_root":70}],29:[function(e,t,i){var n=e("./_cloneArrayBuffer");t.exports=function(e,t){var i=t?n(e.buffer):e.buffer;return new e.constructor(i,e.byteOffset,e.length)}},{"./_cloneArrayBuffer":27}],30:[function(e,t,i){t.exports=function(e,t){var i=-1,n=e.length;for(t||(t=Array(n));++i<n;)t[i]=e[i];return t}},{}],31:[function(e,t,i){var n=e("./_assignValue"),s=e("./_baseAssignValue");t.exports=function(e,t,i,a){var r=!i;i||(i={});for(var o=-1,c=t.length;++o<c;){var d=t[o],l=a?a(i[d],e[d],d,i,e):void 0;void 0===l&&(l=e[d]),r?s(i,d,l):n(i,d,l)}return i}},{"./_assignValue":11,"./_baseAssignValue":13}],32:[function(e,t,i){var n=e("./_root")["__core-js_shared__"];t.exports=n},{"./_root":70}],33:[function(e,t,i){var n=e("./_baseRest"),s=e("./_isIterateeCall");t.exports=function(e){return n((function(t,i){var n=-1,a=i.length,r=a>1?i[a-1]:void 0,o=a>2?i[2]:void 0;for(r=e.length>3&&"function"==typeof r?(a--,r):void 0,o&&s(i[0],i[1],o)&&(r=a<3?void 0:r,a=1),t=Object(t);++n<a;){var c=i[n];c&&e(t,c,n,r)}return t}))}},{"./_baseRest":23,"./_isIterateeCall":50}],34:[function(e,t,i){t.exports=function(e){return function(t,i,n){for(var s=-1,a=Object(t),r=n(t),o=r.length;o--;){var c=r[e?o:++s];if(!1===i(a[c],c,a))break}return t}}},{}],35:[function(e,t,i){var n=e("./_baseMerge"),s=e("./isObject");t.exports=function e(t,i,a,r,o,c){return s(t)&&s(i)&&(c.set(i,t),n(t,i,void 0,e,c),c.delete(i)),t}},{"./_baseMerge":21,"./isObject":91}],36:[function(e,t,i){var n=e("./_getNative"),s=function(){try{var e=n(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();t.exports=s},{"./_getNative":39}],37:[function(e,t,i){(function(e){(function(){var i="object"==typeof e&&e&&e.Object===Object&&e;t.exports=i}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],38:[function(e,t,i){var n=e("./_isKeyable");t.exports=function(e,t){var i=e.__data__;return n(t)?i["string"==typeof t?"string":"hash"]:i.map}},{"./_isKeyable":51}],39:[function(e,t,i){var n=e("./_baseIsNative"),s=e("./_getValue");t.exports=function(e,t){var i=s(e,t);return n(i)?i:void 0}},{"./_baseIsNative":18,"./_getValue":42}],40:[function(e,t,i){var n=e("./_overArg")(Object.getPrototypeOf,Object);t.exports=n},{"./_overArg":68}],41:[function(e,t,i){var n=e("./_Symbol"),s=Object.prototype,a=s.hasOwnProperty,r=s.toString,o=n?n.toStringTag:void 0;t.exports=function(e){var t=a.call(e,o),i=e[o];try{e[o]=void 0;var n=!0}catch(e){}var s=r.call(e);return n&&(t?e[o]=i:delete e[o]),s}},{"./_Symbol":6}],42:[function(e,t,i){t.exports=function(e,t){return null==e?void 0:e[t]}},{}],43:[function(e,t,i){var n=e("./_nativeCreate");t.exports=function(){this.__data__=n?n(null):{},this.size=0}},{"./_nativeCreate":64}],44:[function(e,t,i){t.exports=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}},{}],45:[function(e,t,i){var n=e("./_nativeCreate"),s=Object.prototype.hasOwnProperty;t.exports=function(e){var t=this.__data__;if(n){var i=t[e];return"__lodash_hash_undefined__"===i?void 0:i}return s.call(t,e)?t[e]:void 0}},{"./_nativeCreate":64}],46:[function(e,t,i){var n=e("./_nativeCreate"),s=Object.prototype.hasOwnProperty;t.exports=function(e){var t=this.__data__;return n?void 0!==t[e]:s.call(t,e)}},{"./_nativeCreate":64}],47:[function(e,t,i){var n=e("./_nativeCreate");t.exports=function(e,t){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=n&&void 0===t?"__lodash_hash_undefined__":t,this}},{"./_nativeCreate":64}],48:[function(e,t,i){var n=e("./_baseCreate"),s=e("./_getPrototype"),a=e("./_isPrototype");t.exports=function(e){return"function"!=typeof e.constructor||a(e)?{}:n(s(e))}},{"./_baseCreate":14,"./_getPrototype":40,"./_isPrototype":53}],49:[function(e,t,i){var n=/^(?:0|[1-9]\d*)$/;t.exports=function(e,t){var i=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==i||"symbol"!=i&&n.test(e))&&e>-1&&e%1==0&&e<t}},{}],50:[function(e,t,i){var n=e("./eq"),s=e("./isArrayLike"),a=e("./_isIndex"),r=e("./isObject");t.exports=function(e,t,i){if(!r(i))return!1;var o=typeof t;return!!("number"==o?s(i)&&a(t,i.length):"string"==o&&t in i)&&n(i[t],e)}},{"./_isIndex":49,"./eq":82,"./isArrayLike":86,"./isObject":91}],51:[function(e,t,i){t.exports=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}},{}],52:[function(e,t,i){var n,s=e("./_coreJsData"),a=(n=/[^.]+$/.exec(s&&s.keys&&s.keys.IE_PROTO||""))?"Symbol(src)_1."+n:"";t.exports=function(e){return!!a&&a in e}},{"./_coreJsData":32}],53:[function(e,t,i){var n=Object.prototype;t.exports=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||n)}},{}],54:[function(e,t,i){t.exports=function(){this.__data__=[],this.size=0}},{}],55:[function(e,t,i){var n=e("./_assocIndexOf"),s=Array.prototype.splice;t.exports=function(e){var t=this.__data__,i=n(t,e);return!(i<0)&&(i==t.length-1?t.pop():s.call(t,i,1),--this.size,!0)}},{"./_assocIndexOf":12}],56:[function(e,t,i){var n=e("./_assocIndexOf");t.exports=function(e){var t=this.__data__,i=n(t,e);return i<0?void 0:t[i][1]}},{"./_assocIndexOf":12}],57:[function(e,t,i){var n=e("./_assocIndexOf");t.exports=function(e){return n(this.__data__,e)>-1}},{"./_assocIndexOf":12}],58:[function(e,t,i){var n=e("./_assocIndexOf");t.exports=function(e,t){var i=this.__data__,s=n(i,e);return s<0?(++this.size,i.push([e,t])):i[s][1]=t,this}},{"./_assocIndexOf":12}],59:[function(e,t,i){var n=e("./_Hash"),s=e("./_ListCache"),a=e("./_Map");t.exports=function(){this.size=0,this.__data__={hash:new n,map:new(a||s),string:new n}}},{"./_Hash":1,"./_ListCache":2,"./_Map":3}],60:[function(e,t,i){var n=e("./_getMapData");t.exports=function(e){var t=n(this,e).delete(e);return this.size-=t?1:0,t}},{"./_getMapData":38}],61:[function(e,t,i){var n=e("./_getMapData");t.exports=function(e){return n(this,e).get(e)}},{"./_getMapData":38}],62:[function(e,t,i){var n=e("./_getMapData");t.exports=function(e){return n(this,e).has(e)}},{"./_getMapData":38}],63:[function(e,t,i){var n=e("./_getMapData");t.exports=function(e,t){var i=n(this,e),s=i.size;return i.set(e,t),this.size+=i.size==s?0:1,this}},{"./_getMapData":38}],64:[function(e,t,i){var n=e("./_getNative")(Object,"create");t.exports=n},{"./_getNative":39}],65:[function(e,t,i){t.exports=function(e){var t=[];if(null!=e)for(var i in Object(e))t.push(i);return t}},{}],66:[function(e,t,i){var n=e("./_freeGlobal"),s="object"==typeof i&&i&&!i.nodeType&&i,a=s&&"object"==typeof t&&t&&!t.nodeType&&t,r=a&&a.exports===s&&n.process,o=function(){try{var e=a&&a.require&&a.require("util").types;return e||r&&r.binding&&r.binding("util")}catch(e){}}();t.exports=o},{"./_freeGlobal":37}],67:[function(e,t,i){var n=Object.prototype.toString;t.exports=function(e){return n.call(e)}},{}],68:[function(e,t,i){t.exports=function(e,t){return function(i){return e(t(i))}}},{}],69:[function(e,t,i){var n=e("./_apply"),s=Math.max;t.exports=function(e,t,i){return t=s(void 0===t?e.length-1:t,0),function(){for(var a=arguments,r=-1,o=s(a.length-t,0),c=Array(o);++r<o;)c[r]=a[t+r];r=-1;for(var d=Array(t+1);++r<t;)d[r]=a[r];return d[t]=i(c),n(e,this,d)}}},{"./_apply":8}],70:[function(e,t,i){var n=e("./_freeGlobal"),s="object"==typeof self&&self&&self.Object===Object&&self,a=n||s||Function("return this")();t.exports=a},{"./_freeGlobal":37}],71:[function(e,t,i){t.exports=function(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}},{}],72:[function(e,t,i){var n=e("./_baseSetToString"),s=e("./_shortOut")(n);t.exports=s},{"./_baseSetToString":24,"./_shortOut":73}],73:[function(e,t,i){var n=Date.now;t.exports=function(e){var t=0,i=0;return function(){var s=n(),a=16-(s-i);if(i=s,a>0){if(++t>=800)return arguments[0]}else t=0;return e.apply(void 0,arguments)}}},{}],74:[function(e,t,i){var n=e("./_ListCache");t.exports=function(){this.__data__=new n,this.size=0}},{"./_ListCache":2}],75:[function(e,t,i){t.exports=function(e){var t=this.__data__,i=t.delete(e);return this.size=t.size,i}},{}],76:[function(e,t,i){t.exports=function(e){return this.__data__.get(e)}},{}],77:[function(e,t,i){t.exports=function(e){return this.__data__.has(e)}},{}],78:[function(e,t,i){var n=e("./_ListCache"),s=e("./_Map"),a=e("./_MapCache");t.exports=function(e,t){var i=this.__data__;if(i instanceof n){var r=i.__data__;if(!s||r.length<199)return r.push([e,t]),this.size=++i.size,this;i=this.__data__=new a(r)}return i.set(e,t),this.size=i.size,this}},{"./_ListCache":2,"./_Map":3,"./_MapCache":4}],79:[function(e,t,i){var n=Function.prototype.toString;t.exports=function(e){if(null!=e){try{return n.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},{}],80:[function(e,t,i){t.exports=function(e){return function(){return e}}},{}],81:[function(e,t,i){var n=e("./_apply"),s=e("./_baseRest"),a=e("./_customDefaultsMerge"),r=e("./mergeWith"),o=s((function(e){return e.push(void 0,a),n(r,void 0,e)}));t.exports=o},{"./_apply":8,"./_baseRest":23,"./_customDefaultsMerge":35,"./mergeWith":96}],82:[function(e,t,i){t.exports=function(e,t){return e===t||e!=e&&t!=t}},{}],83:[function(e,t,i){t.exports=function(e){return e}},{}],84:[function(e,t,i){var n=e("./_baseIsArguments"),s=e("./isObjectLike"),a=Object.prototype,r=a.hasOwnProperty,o=a.propertyIsEnumerable,c=n(function(){return arguments}())?n:function(e){return s(e)&&r.call(e,"callee")&&!o.call(e,"callee")};t.exports=c},{"./_baseIsArguments":17,"./isObjectLike":92}],85:[function(e,t,i){var n=Array.isArray;t.exports=n},{}],86:[function(e,t,i){var n=e("./isFunction"),s=e("./isLength");t.exports=function(e){return null!=e&&s(e.length)&&!n(e)}},{"./isFunction":89,"./isLength":90}],87:[function(e,t,i){var n=e("./isArrayLike"),s=e("./isObjectLike");t.exports=function(e){return s(e)&&n(e)}},{"./isArrayLike":86,"./isObjectLike":92}],88:[function(e,t,i){var n=e("./_root"),s=e("./stubFalse"),a="object"==typeof i&&i&&!i.nodeType&&i,r=a&&"object"==typeof t&&t&&!t.nodeType&&t,o=r&&r.exports===a?n.Buffer:void 0,c=(o?o.isBuffer:void 0)||s;t.exports=c},{"./_root":70,"./stubFalse":97}],89:[function(e,t,i){var n=e("./_baseGetTag"),s=e("./isObject");t.exports=function(e){if(!s(e))return!1;var t=n(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},{"./_baseGetTag":16,"./isObject":91}],90:[function(e,t,i){t.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}},{}],91:[function(e,t,i){t.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},{}],92:[function(e,t,i){t.exports=function(e){return null!=e&&"object"==typeof e}},{}],93:[function(e,t,i){var n=e("./_baseGetTag"),s=e("./_getPrototype"),a=e("./isObjectLike"),r=Function.prototype,o=Object.prototype,c=r.toString,d=o.hasOwnProperty,l=c.call(Object);t.exports=function(e){if(!a(e)||"[object Object]"!=n(e))return!1;var t=s(e);if(null===t)return!0;var i=d.call(t,"constructor")&&t.constructor;return"function"==typeof i&&i instanceof i&&c.call(i)==l}},{"./_baseGetTag":16,"./_getPrototype":40,"./isObjectLike":92}],94:[function(e,t,i){var n=e("./_baseIsTypedArray"),s=e("./_baseUnary"),a=e("./_nodeUtil"),r=a&&a.isTypedArray,o=r?s(r):n;t.exports=o},{"./_baseIsTypedArray":19,"./_baseUnary":26,"./_nodeUtil":66}],95:[function(e,t,i){var n=e("./_arrayLikeKeys"),s=e("./_baseKeysIn"),a=e("./isArrayLike");t.exports=function(e){return a(e)?n(e,!0):s(e)}},{"./_arrayLikeKeys":9,"./_baseKeysIn":20,"./isArrayLike":86}],96:[function(e,t,i){var n=e("./_baseMerge"),s=e("./_createAssigner")((function(e,t,i,s){n(e,t,i,s)}));t.exports=s},{"./_baseMerge":21,"./_createAssigner":33}],97:[function(e,t,i){t.exports=function(){return!1}},{}],98:[function(e,t,i){var n=e("./_copyObject"),s=e("./keysIn");t.exports=function(e){return n(e,s(e))}},{"./_copyObject":31,"./keysIn":95}],99:[function(e,t,i){var n,s;n=this,s=function(){var e=function(){},t="undefined"!=typeof window&&void 0!==window.navigator&&/Trident\/|MSIE /.test(window.navigator.userAgent),i=["trace","debug","info","warn","error"];function n(e,t){var i=e[t];if("function"==typeof i.bind)return i.bind(e);try{return Function.prototype.bind.call(i,e)}catch(t){return function(){return Function.prototype.apply.apply(i,[e,arguments])}}}function s(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function a(i){return"debug"===i&&(i="log"),"undefined"!=typeof console&&("trace"===i&&t?s:void 0!==console[i]?n(console,i):void 0!==console.log?n(console,"log"):e)}function r(t,n){for(var s=0;s<i.length;s++){var a=i[s];this[a]=s<t?e:this.methodFactory(a,t,n)}this.log=this.debug}function o(e,t,i){return function(){"undefined"!=typeof console&&(r.call(this,t,i),this[e].apply(this,arguments))}}function c(e,t,i){return a(e)||o.apply(this,arguments)}function d(e,t,n){var s,a=this;t=null==t?"WARN":t;var o="loglevel";function d(){var e;if("undefined"!=typeof window&&o){try{e=window.localStorage[o]}catch(e){}if(void 0===e)try{var t=window.document.cookie,i=t.indexOf(encodeURIComponent(o)+"=");-1!==i&&(e=/^([^;]+)/.exec(t.slice(i))[1])}catch(e){}return void 0===a.levels[e]&&(e=void 0),e}}"string"==typeof e?o+=":"+e:"symbol"==typeof e&&(o=void 0),a.name=e,a.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},a.methodFactory=n||c,a.getLevel=function(){return s},a.setLevel=function(t,n){if("string"==typeof t&&void 0!==a.levels[t.toUpperCase()]&&(t=a.levels[t.toUpperCase()]),!("number"==typeof t&&t>=0&&t<=a.levels.SILENT))throw"log.setLevel() called with invalid level: "+t;if(s=t,!1!==n&&function(e){var t=(i[e]||"silent").toUpperCase();if("undefined"!=typeof window&&o){try{return void(window.localStorage[o]=t)}catch(e){}try{window.document.cookie=encodeURIComponent(o)+"="+t+";"}catch(e){}}}(t),r.call(a,t,e),"undefined"==typeof console&&t<a.levels.SILENT)return"No console available for logging"},a.setDefaultLevel=function(e){t=e,d()||a.setLevel(e,!1)},a.resetLevel=function(){a.setLevel(t,!1),function(){if("undefined"!=typeof window&&o){try{return void window.localStorage.removeItem(o)}catch(e){}try{window.document.cookie=encodeURIComponent(o)+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC"}catch(e){}}}()},a.enableAll=function(e){a.setLevel(a.levels.TRACE,e)},a.disableAll=function(e){a.setLevel(a.levels.SILENT,e)};var l=d();null==l&&(l=t),a.setLevel(l,!1)}var l=new d,h={};l.getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=h[e];return t||(t=h[e]=new d(e,l.getLevel(),l.methodFactory)),t};var p="undefined"!=typeof window?window.log:void 0;return l.noConflict=function(){return"undefined"!=typeof window&&window.log===l&&(window.log=p),l},l.getLoggers=function(){return h},l.default=l,l},"object"==typeof t&&t.exports?t.exports=s():n.log=s()},{}],100:[function(e,t,i){var n=e("sdp");function s(e,t,i,s,a){var r=n.writeRtpDescription(e.kind,t);if(r+=n.writeIceParameters(e.iceGatherer.getLocalParameters()),r+=n.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===i?"actpass":a||"active"),r+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?r+="a=sendrecv\r\n":e.rtpSender?r+="a=sendonly\r\n":e.rtpReceiver?r+="a=recvonly\r\n":r+="a=inactive\r\n",e.rtpSender){var o=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=o;var c="msid:"+(s?s.id:"-")+" "+o+"\r\n";r+="a="+c,r+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+c,e.sendEncodingParameters[0].rtx&&(r+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+c,r+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return r+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(r+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+n.localCName+"\r\n"),r}function a(e,t){var i={codecs:[],headerExtensions:[],fecMechanisms:[]},n=function(e,t){e=parseInt(e,10);for(var i=0;i<t.length;i++)if(t[i].payloadType===e||t[i].preferredPayloadType===e)return t[i]},s=function(e,t,i,s){var a=n(e.parameters.apt,i),r=n(t.parameters.apt,s);return a&&r&&a.name.toLowerCase()===r.name.toLowerCase()};return e.codecs.forEach((function(n){for(var a=0;a<t.codecs.length;a++){var r=t.codecs[a];if(n.name.toLowerCase()===r.name.toLowerCase()&&n.clockRate===r.clockRate){if("rtx"===n.name.toLowerCase()&&n.parameters&&r.parameters.apt&&!s(n,r,e.codecs,t.codecs))continue;(r=JSON.parse(JSON.stringify(r))).numChannels=Math.min(n.numChannels,r.numChannels),i.codecs.push(r),r.rtcpFeedback=r.rtcpFeedback.filter((function(e){for(var t=0;t<n.rtcpFeedback.length;t++)if(n.rtcpFeedback[t].type===e.type&&n.rtcpFeedback[t].parameter===e.parameter)return!0;return!1}));break}}})),e.headerExtensions.forEach((function(e){for(var n=0;n<t.headerExtensions.length;n++){var s=t.headerExtensions[n];if(e.uri===s.uri){i.headerExtensions.push(s);break}}})),i}function r(e,t,i){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(i)}function o(e,t){var i=e.getRemoteCandidates().find((function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type}));return i||e.addRemoteCandidate(t),!i}function c(e,t){var i=new Error(t);return i.name=e,i.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],i}t.exports=function(e,t){function i(t,i){i.addTrack(t),i.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function d(t,i,n,s){var a=new Event("track");a.track=i,a.receiver=n,a.transceiver={receiver:n},a.streams=s,e.setTimeout((function(){t._dispatchEvent("track",a)}))}var l=function(i){var s=this,a=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach((function(e){s[e]=a[e].bind(a)})),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",i=JSON.parse(JSON.stringify(i||{})),this.usingBundle="max-bundle"===i.bundlePolicy,"negotiate"===i.rtcpMuxPolicy)throw c("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(i.rtcpMuxPolicy||(i.rtcpMuxPolicy="require"),i.iceTransportPolicy){case"all":case"relay":break;default:i.iceTransportPolicy="all"}switch(i.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:i.bundlePolicy="balanced"}if(i.iceServers=function(e,t){var i=!1;return(e=JSON.parse(JSON.stringify(e))).filter((function(e){if(e&&(e.urls||e.url)){var n=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var s="string"==typeof n;return s&&(n=[n]),n=n.filter((function(e){return 0===e.indexOf("turn:")&&-1!==e.indexOf("transport=udp")&&-1===e.indexOf("turn:[")&&!i?(i=!0,!0):0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp")})),delete e.url,e.urls=s?n[0]:n,!!n.length}}))}(i.iceServers||[],t),this._iceGatherers=[],i.iceCandidatePoolSize)for(var r=i.iceCandidatePoolSize;r>0;r--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:i.iceServers,gatherPolicy:i.iceTransportPolicy}));else i.iceCandidatePoolSize=0;this._config=i,this.transceivers=[],this._sdpSessionId=n.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(l.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(l.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),l.prototype.onicecandidate=null,l.prototype.onaddstream=null,l.prototype.ontrack=null,l.prototype.onremovestream=null,l.prototype.onsignalingstatechange=null,l.prototype.oniceconnectionstatechange=null,l.prototype.onconnectionstatechange=null,l.prototype.onicegatheringstatechange=null,l.prototype.onnegotiationneeded=null,l.prototype.ondatachannel=null,l.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},l.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},l.prototype.getConfiguration=function(){return this._config},l.prototype.getLocalStreams=function(){return this.localStreams},l.prototype.getRemoteStreams=function(){return this.remoteStreams},l.prototype._createTransceiver=function(e,t){var i=this.transceivers.length>0,n={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&i)n.iceTransport=this.transceivers[0].iceTransport,n.dtlsTransport=this.transceivers[0].dtlsTransport;else{var s=this._createIceAndDtlsTransports();n.iceTransport=s.iceTransport,n.dtlsTransport=s.dtlsTransport}return t||this.transceivers.push(n),n},l.prototype.addTrack=function(t,i){if(this._isClosed)throw c("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var n;if(this.transceivers.find((function(e){return e.track===t})))throw c("InvalidAccessError","Track already exists.");for(var s=0;s<this.transceivers.length;s++)this.transceivers[s].track||this.transceivers[s].kind!==t.kind||(n=this.transceivers[s]);return n||(n=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(i)&&this.localStreams.push(i),n.track=t,n.stream=i,n.rtpSender=new e.RTCRtpSender(t,n.dtlsTransport),n.rtpSender},l.prototype.addStream=function(e){var i=this;if(t>=15025)e.getTracks().forEach((function(t){i.addTrack(t,e)}));else{var n=e.clone();e.getTracks().forEach((function(e,t){var i=n.getTracks()[t];e.addEventListener("enabled",(function(e){i.enabled=e.enabled}))})),n.getTracks().forEach((function(e){i.addTrack(e,n)}))}},l.prototype.removeTrack=function(t){if(this._isClosed)throw c("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var i=this.transceivers.find((function(e){return e.rtpSender===t}));if(!i)throw c("InvalidAccessError","Sender was not created by this connection.");var n=i.stream;i.rtpSender.stop(),i.rtpSender=null,i.track=null,i.stream=null,-1===this.transceivers.map((function(e){return e.stream})).indexOf(n)&&this.localStreams.indexOf(n)>-1&&this.localStreams.splice(this.localStreams.indexOf(n),1),this._maybeFireNegotiationNeeded()},l.prototype.removeStream=function(e){var t=this;e.getTracks().forEach((function(e){var i=t.getSenders().find((function(t){return t.track===e}));i&&t.removeTrack(i)}))},l.prototype.getSenders=function(){return this.transceivers.filter((function(e){return!!e.rtpSender})).map((function(e){return e.rtpSender}))},l.prototype.getReceivers=function(){return this.transceivers.filter((function(e){return!!e.rtpReceiver})).map((function(e){return e.rtpReceiver}))},l.prototype._createIceGatherer=function(t,i){var n=this;if(i&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var s=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(s,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var i=!e.candidate||0===Object.keys(e.candidate).length;s.state=i?"completed":"gathering",null!==n.transceivers[t].bufferedCandidateEvents&&n.transceivers[t].bufferedCandidateEvents.push(e)},s.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),s},l.prototype._gather=function(t,i){var s=this,a=this.transceivers[i].iceGatherer;if(!a.onlocalcandidate){var r=this.transceivers[i].bufferedCandidateEvents;this.transceivers[i].bufferedCandidateEvents=null,a.removeEventListener("localcandidate",this.transceivers[i].bufferCandidates),a.onlocalcandidate=function(e){if(!(s.usingBundle&&i>0)){var r=new Event("icecandidate");r.candidate={sdpMid:t,sdpMLineIndex:i};var o=e.candidate,c=!o||0===Object.keys(o).length;if(c)"new"!==a.state&&"gathering"!==a.state||(a.state="completed");else{"new"===a.state&&(a.state="gathering"),o.component=1,o.ufrag=a.getLocalParameters().usernameFragment;var d=n.writeCandidate(o);r.candidate=Object.assign(r.candidate,n.parseCandidate(d)),r.candidate.candidate=d,r.candidate.toJSON=function(){return{candidate:r.candidate.candidate,sdpMid:r.candidate.sdpMid,sdpMLineIndex:r.candidate.sdpMLineIndex,usernameFragment:r.candidate.usernameFragment}}}var l=n.getMediaSections(s._localDescription.sdp);l[r.candidate.sdpMLineIndex]+=c?"a=end-of-candidates\r\n":"a="+r.candidate.candidate+"\r\n",s._localDescription.sdp=n.getDescription(s._localDescription.sdp)+l.join("");var h=s.transceivers.every((function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state}));"gathering"!==s.iceGatheringState&&(s.iceGatheringState="gathering",s._emitGatheringStateChange()),c||s._dispatchEvent("icecandidate",r),h&&(s._dispatchEvent("icecandidate",new Event("icecandidate")),s.iceGatheringState="complete",s._emitGatheringStateChange())}},e.setTimeout((function(){r.forEach((function(e){a.onlocalcandidate(e)}))}),0)}},l.prototype._createIceAndDtlsTransports=function(){var t=this,i=new e.RTCIceTransport(null);i.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var n=new e.RTCDtlsTransport(i);return n.ondtlsstatechange=function(){t._updateConnectionState()},n.onerror=function(){Object.defineProperty(n,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:i,dtlsTransport:n}},l.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var i=this.transceivers[e].iceTransport;i&&(delete i.onicestatechange,delete this.transceivers[e].iceTransport);var n=this.transceivers[e].dtlsTransport;n&&(delete n.ondtlsstatechange,delete n.onerror,delete this.transceivers[e].dtlsTransport)},l.prototype._transceive=function(e,i,s){var r=a(e.localCapabilities,e.remoteCapabilities);i&&e.rtpSender&&(r.encodings=e.sendEncodingParameters,r.rtcp={cname:n.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(r.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(r)),s&&e.rtpReceiver&&r.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach((function(e){delete e.rtx})),e.recvEncodingParameters.length?r.encodings=e.recvEncodingParameters:r.encodings=[{}],r.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(r.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(r.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(r))},l.prototype.setLocalDescription=function(e){var t,i,s=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(c("TypeError",'Unsupported type "'+e.type+'"'));if(!r("setLocalDescription",e.type,s.signalingState)||s._isClosed)return Promise.reject(c("InvalidStateError","Can not set local "+e.type+" in state "+s.signalingState));if("offer"===e.type)t=n.splitSections(e.sdp),i=t.shift(),t.forEach((function(e,t){var i=n.parseRtpParameters(e);s.transceivers[t].localCapabilities=i})),s.transceivers.forEach((function(e,t){s._gather(e.mid,t)}));else if("answer"===e.type){t=n.splitSections(s._remoteDescription.sdp),i=t.shift();var o=n.matchPrefix(i,"a=ice-lite").length>0;t.forEach((function(e,t){var r=s.transceivers[t],c=r.iceGatherer,d=r.iceTransport,l=r.dtlsTransport,h=r.localCapabilities,p=r.remoteCapabilities;if(!(n.isRejected(e)&&0===n.matchPrefix(e,"a=bundle-only").length)&&!r.rejected){var u=n.getIceParameters(e,i),m=n.getDtlsParameters(e,i);o&&(m.role="server"),s.usingBundle&&0!==t||(s._gather(r.mid,t),"new"===d.state&&d.start(c,u,o?"controlling":"controlled"),"new"===l.state&&l.start(m));var g=a(h,p);s._transceive(r,g.codecs.length>0,!1)}}))}return s._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?s._updateSignalingState("have-local-offer"):s._updateSignalingState("stable"),Promise.resolve()},l.prototype.setRemoteDescription=function(s){var l=this;if(-1===["offer","answer"].indexOf(s.type))return Promise.reject(c("TypeError",'Unsupported type "'+s.type+'"'));if(!r("setRemoteDescription",s.type,l.signalingState)||l._isClosed)return Promise.reject(c("InvalidStateError","Can not set remote "+s.type+" in state "+l.signalingState));var h={};l.remoteStreams.forEach((function(e){h[e.id]=e}));var p=[],u=n.splitSections(s.sdp),m=u.shift(),g=n.matchPrefix(m,"a=ice-lite").length>0,f=n.matchPrefix(m,"a=group:BUNDLE ").length>0;l.usingBundle=f;var v=n.matchPrefix(m,"a=ice-options:")[0];return l.canTrickleIceCandidates=!!v&&v.substr(14).split(" ").indexOf("trickle")>=0,u.forEach((function(r,c){var d=n.splitLines(r),u=n.getKind(r),v=n.isRejected(r)&&0===n.matchPrefix(r,"a=bundle-only").length,b=d[0].substr(2).split(" ")[2],C=n.getDirection(r,m),y=n.parseMsid(r),S=n.getMid(r)||n.generateIdentifier();if(v||"application"===u&&("DTLS/SCTP"===b||"UDP/DTLS/SCTP"===b))l.transceivers[c]={mid:S,kind:u,protocol:b,rejected:!0};else{var E,T,I,k,w,R,P,x,_;!v&&l.transceivers[c]&&l.transceivers[c].rejected&&(l.transceivers[c]=l._createTransceiver(u,!0));var M,D,O=n.parseRtpParameters(r);v||(M=n.getIceParameters(r,m),(D=n.getDtlsParameters(r,m)).role="client"),P=n.parseRtpEncodingParameters(r);var L=n.parseRtcpParameters(r),A=n.matchPrefix(r,"a=end-of-candidates",m).length>0,N=n.matchPrefix(r,"a=candidate:").map((function(e){return n.parseCandidate(e)})).filter((function(e){return 1===e.component}));if(("offer"===s.type||"answer"===s.type)&&!v&&f&&c>0&&l.transceivers[c]&&(l._disposeIceAndDtlsTransports(c),l.transceivers[c].iceGatherer=l.transceivers[0].iceGatherer,l.transceivers[c].iceTransport=l.transceivers[0].iceTransport,l.transceivers[c].dtlsTransport=l.transceivers[0].dtlsTransport,l.transceivers[c].rtpSender&&l.transceivers[c].rtpSender.setTransport(l.transceivers[0].dtlsTransport),l.transceivers[c].rtpReceiver&&l.transceivers[c].rtpReceiver.setTransport(l.transceivers[0].dtlsTransport)),"offer"!==s.type||v){if("answer"===s.type&&!v){T=(E=l.transceivers[c]).iceGatherer,I=E.iceTransport,k=E.dtlsTransport,w=E.rtpReceiver,R=E.sendEncodingParameters,x=E.localCapabilities,l.transceivers[c].recvEncodingParameters=P,l.transceivers[c].remoteCapabilities=O,l.transceivers[c].rtcpParameters=L,N.length&&"new"===I.state&&(!g&&!A||f&&0!==c?N.forEach((function(e){o(E.iceTransport,e)})):I.setRemoteCandidates(N)),f&&0!==c||("new"===I.state&&I.start(T,M,"controlling"),"new"===k.state&&k.start(D)),!a(E.localCapabilities,E.remoteCapabilities).codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&E.sendEncodingParameters[0].rtx&&delete E.sendEncodingParameters[0].rtx,l._transceive(E,"sendrecv"===C||"recvonly"===C,"sendrecv"===C||"sendonly"===C),!w||"sendrecv"!==C&&"sendonly"!==C?delete E.rtpReceiver:(_=w.track,y?(h[y.stream]||(h[y.stream]=new e.MediaStream),i(_,h[y.stream]),p.push([_,w,h[y.stream]])):(h.default||(h.default=new e.MediaStream),i(_,h.default),p.push([_,w,h.default])))}}else{(E=l.transceivers[c]||l._createTransceiver(u)).mid=S,E.iceGatherer||(E.iceGatherer=l._createIceGatherer(c,f)),N.length&&"new"===E.iceTransport.state&&(!A||f&&0!==c?N.forEach((function(e){o(E.iceTransport,e)})):E.iceTransport.setRemoteCandidates(N)),x=e.RTCRtpReceiver.getCapabilities(u),t<15019&&(x.codecs=x.codecs.filter((function(e){return"rtx"!==e.name}))),R=E.sendEncodingParameters||[{ssrc:1001*(2*c+2)}];var B,G=!1;if("sendrecv"===C||"sendonly"===C){if(G=!E.rtpReceiver,w=E.rtpReceiver||new e.RTCRtpReceiver(E.dtlsTransport,u),G)_=w.track,y&&"-"===y.stream||(y?(h[y.stream]||(h[y.stream]=new e.MediaStream,Object.defineProperty(h[y.stream],"id",{get:function(){return y.stream}})),Object.defineProperty(_,"id",{get:function(){return y.track}}),B=h[y.stream]):(h.default||(h.default=new e.MediaStream),B=h.default)),B&&(i(_,B),E.associatedRemoteMediaStreams.push(B)),p.push([_,w,B])}else E.rtpReceiver&&E.rtpReceiver.track&&(E.associatedRemoteMediaStreams.forEach((function(t){var i=t.getTracks().find((function(e){return e.id===E.rtpReceiver.track.id}));i&&function(t,i){i.removeTrack(t),i.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:t}))}(i,t)})),E.associatedRemoteMediaStreams=[]);E.localCapabilities=x,E.remoteCapabilities=O,E.rtpReceiver=w,E.rtcpParameters=L,E.sendEncodingParameters=R,E.recvEncodingParameters=P,l._transceive(l.transceivers[c],!1,G)}}})),void 0===l._dtlsRole&&(l._dtlsRole="offer"===s.type?"active":"passive"),l._remoteDescription={type:s.type,sdp:s.sdp},"offer"===s.type?l._updateSignalingState("have-remote-offer"):l._updateSignalingState("stable"),Object.keys(h).forEach((function(t){var i=h[t];if(i.getTracks().length){if(-1===l.remoteStreams.indexOf(i)){l.remoteStreams.push(i);var n=new Event("addstream");n.stream=i,e.setTimeout((function(){l._dispatchEvent("addstream",n)}))}p.forEach((function(e){var t=e[0],n=e[1];i.id===e[2].id&&d(l,t,n,[i])}))}})),p.forEach((function(e){e[2]||d(l,e[0],e[1],[])})),e.setTimeout((function(){l&&l.transceivers&&l.transceivers.forEach((function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))}))}),4e3),Promise.resolve()},l.prototype.close=function(){this.transceivers.forEach((function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()})),this._isClosed=!0,this._updateSignalingState("closed")},l.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},l.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout((function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}}),0))},l.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&!e.rejected&&t[e.iceTransport.state]++})),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var i=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",i)}},l.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach((function(e){e.iceTransport&&e.dtlsTransport&&!e.rejected&&(t[e.iceTransport.state]++,t[e.dtlsTransport.state]++)})),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var i=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",i)}},l.prototype.createOffer=function(){var i=this;if(i._isClosed)return Promise.reject(c("InvalidStateError","Can not call createOffer after close"));var a=i.transceivers.filter((function(e){return"audio"===e.kind})).length,r=i.transceivers.filter((function(e){return"video"===e.kind})).length,o=arguments[0];if(o){if(o.mandatory||o.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==o.offerToReceiveAudio&&(a=!0===o.offerToReceiveAudio?1:!1===o.offerToReceiveAudio?0:o.offerToReceiveAudio),void 0!==o.offerToReceiveVideo&&(r=!0===o.offerToReceiveVideo?1:!1===o.offerToReceiveVideo?0:o.offerToReceiveVideo)}for(i.transceivers.forEach((function(e){"audio"===e.kind?--a<0&&(e.wantReceive=!1):"video"===e.kind&&--r<0&&(e.wantReceive=!1)}));a>0||r>0;)a>0&&(i._createTransceiver("audio"),a--),r>0&&(i._createTransceiver("video"),r--);var d=n.writeSessionBoilerplate(i._sdpSessionId,i._sdpSessionVersion++);i.transceivers.forEach((function(s,a){var r=s.track,o=s.kind,c=s.mid||n.generateIdentifier();s.mid=c,s.iceGatherer||(s.iceGatherer=i._createIceGatherer(a,i.usingBundle));var d=e.RTCRtpSender.getCapabilities(o);t<15019&&(d.codecs=d.codecs.filter((function(e){return"rtx"!==e.name}))),d.codecs.forEach((function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),s.remoteCapabilities&&s.remoteCapabilities.codecs&&s.remoteCapabilities.codecs.forEach((function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)}))})),d.headerExtensions.forEach((function(e){(s.remoteCapabilities&&s.remoteCapabilities.headerExtensions||[]).forEach((function(t){e.uri===t.uri&&(e.id=t.id)}))}));var l=s.sendEncodingParameters||[{ssrc:1001*(2*a+1)}];r&&t>=15019&&"video"===o&&!l[0].rtx&&(l[0].rtx={ssrc:l[0].ssrc+1}),s.wantReceive&&(s.rtpReceiver=new e.RTCRtpReceiver(s.dtlsTransport,o)),s.localCapabilities=d,s.sendEncodingParameters=l})),"max-compat"!==i._config.bundlePolicy&&(d+="a=group:BUNDLE "+i.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),d+="a=ice-options:trickle\r\n",i.transceivers.forEach((function(e,t){d+=s(e,e.localCapabilities,"offer",e.stream,i._dtlsRole),d+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===i.iceGatheringState||0!==t&&i.usingBundle||(e.iceGatherer.getLocalCandidates().forEach((function(e){e.component=1,d+="a="+n.writeCandidate(e)+"\r\n"})),"completed"===e.iceGatherer.state&&(d+="a=end-of-candidates\r\n"))}));var l=new e.RTCSessionDescription({type:"offer",sdp:d});return Promise.resolve(l)},l.prototype.createAnswer=function(){var i=this;if(i._isClosed)return Promise.reject(c("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==i.signalingState&&"have-local-pranswer"!==i.signalingState)return Promise.reject(c("InvalidStateError","Can not call createAnswer in signalingState "+i.signalingState));var r=n.writeSessionBoilerplate(i._sdpSessionId,i._sdpSessionVersion++);i.usingBundle&&(r+="a=group:BUNDLE "+i.transceivers.map((function(e){return e.mid})).join(" ")+"\r\n"),r+="a=ice-options:trickle\r\n";var o=n.getMediaSections(i._remoteDescription.sdp).length;i.transceivers.forEach((function(e,n){if(!(n+1>o)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?r+="m=application 0 DTLS/SCTP 5000\r\n":r+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?r+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(r+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(r+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var c;if(e.stream)"audio"===e.kind?c=e.stream.getAudioTracks()[0]:"video"===e.kind&&(c=e.stream.getVideoTracks()[0]),c&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1});var d=a(e.localCapabilities,e.remoteCapabilities);!d.codecs.filter((function(e){return"rtx"===e.name.toLowerCase()})).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,r+=s(e,d,"answer",e.stream,i._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(r+="a=rtcp-rsize\r\n")}}));var d=new e.RTCSessionDescription({type:"answer",sdp:r});return Promise.resolve(d)},l.prototype.addIceCandidate=function(e){var t,i=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise((function(s,a){if(!i._remoteDescription)return a(c("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var r=e.sdpMLineIndex;if(e.sdpMid)for(var d=0;d<i.transceivers.length;d++)if(i.transceivers[d].mid===e.sdpMid){r=d;break}var l=i.transceivers[r];if(!l)return a(c("OperationError","Can not add ICE candidate"));if(l.rejected)return s();var h=Object.keys(e.candidate).length>0?n.parseCandidate(e.candidate):{};if("tcp"===h.protocol&&(0===h.port||9===h.port))return s();if(h.component&&1!==h.component)return s();if((0===r||r>0&&l.iceTransport!==i.transceivers[0].iceTransport)&&!o(l.iceTransport,h))return a(c("OperationError","Can not add ICE candidate"));var p=e.candidate.trim();0===p.indexOf("a=")&&(p=p.substr(2)),(t=n.getMediaSections(i._remoteDescription.sdp))[r]+="a="+(h.type?p:"end-of-candidates")+"\r\n",i._remoteDescription.sdp=n.getDescription(i._remoteDescription.sdp)+t.join("")}else for(var u=0;u<i.transceivers.length&&(i.transceivers[u].rejected||(i.transceivers[u].iceTransport.addRemoteCandidate({}),(t=n.getMediaSections(i._remoteDescription.sdp))[u]+="a=end-of-candidates\r\n",i._remoteDescription.sdp=n.getDescription(i._remoteDescription.sdp)+t.join(""),!i.usingBundle));u++);s()}))},l.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var i=null;if(this.transceivers.forEach((function(e){e.rtpSender&&e.rtpSender.track===t?i=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(i=e.rtpReceiver)})),!i)throw c("InvalidAccessError","Invalid selector.");return i.getStats()}var n=[];return this.transceivers.forEach((function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach((function(t){e[t]&&n.push(e[t].getStats())}))})),Promise.all(n).then((function(e){var t=new Map;return e.forEach((function(e){e.forEach((function(e){t.set(e.id,e)}))})),t}))};["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach((function(t){var i=e[t];if(i&&i.prototype&&i.prototype.getStats){var n=i.prototype.getStats;i.prototype.getStats=function(){return n.apply(this).then((function(e){var t=new Map;return Object.keys(e).forEach((function(i){var n;e[i].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(n=e[i]).type]||n.type,t.set(i,e[i])})),t}))}}}));var h=["createOffer","createAnswer"];return h.forEach((function(e){var t=l.prototype[e];l.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then((function(t){"function"==typeof e[0]&&e[0].apply(null,[t])}),(function(t){"function"==typeof e[1]&&e[1].apply(null,[t])})):t.apply(this,arguments)}})),(h=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach((function(e){var t=l.prototype[e];l.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)}),(function(t){"function"==typeof e[2]&&e[2].apply(null,[t])})):t.apply(this,arguments)}})),["getStats"].forEach((function(e){var t=l.prototype[e];l.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then((function(){"function"==typeof e[1]&&e[1].apply(null)})):t.apply(this,arguments)}})),l}},{sdp:101}],101:[function(e,t,i){var n={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};n.localCName=n.generateIdentifier(),n.splitLines=function(e){return e.trim().split("\n").map((function(e){return e.trim()}))},n.splitSections=function(e){return e.split("\nm=").map((function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"}))},n.getDescription=function(e){var t=n.splitSections(e);return t&&t[0]},n.getMediaSections=function(e){var t=n.splitSections(e);return t.shift(),t},n.matchPrefix=function(e,t){return n.splitLines(e).filter((function(e){return 0===e.indexOf(t)}))},n.parseCandidate=function(e){for(var t,i={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},n=8;n<t.length;n+=2)switch(t[n]){case"raddr":i.relatedAddress=t[n+1];break;case"rport":i.relatedPort=parseInt(t[n+1],10);break;case"tcptype":i.tcpType=t[n+1];break;case"ufrag":i.ufrag=t[n+1],i.usernameFragment=t[n+1];break;default:i[t[n]]=t[n+1]}return i},n.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var i=e.type;return t.push("typ"),t.push(i),"host"!==i&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},n.parseIceOptions=function(e){return e.substr(14).split(" ")},n.parseRtpMap=function(e){var t=e.substr(9).split(" "),i={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),i.name=t[0],i.clockRate=parseInt(t[1],10),i.channels=3===t.length?parseInt(t[2],10):1,i.numChannels=i.channels,i},n.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var i=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==i?"/"+i:"")+"\r\n"},n.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},n.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},n.parseFmtp=function(e){for(var t,i={},n=e.substr(e.indexOf(" ")+1).split(";"),s=0;s<n.length;s++)i[(t=n[s].trim().split("="))[0].trim()]=t[1];return i},n.writeFmtp=function(e){var t="",i=e.payloadType;if(void 0!==e.preferredPayloadType&&(i=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var n=[];Object.keys(e.parameters).forEach((function(t){e.parameters[t]?n.push(t+"="+e.parameters[t]):n.push(t)})),t+="a=fmtp:"+i+" "+n.join(";")+"\r\n"}return t},n.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},n.writeRtcpFb=function(e){var t="",i=e.payloadType;return void 0!==e.preferredPayloadType&&(i=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((function(e){t+="a=rtcp-fb:"+i+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},n.parseSsrcMedia=function(e){var t=e.indexOf(" "),i={ssrc:parseInt(e.substr(7,t-7),10)},n=e.indexOf(":",t);return n>-1?(i.attribute=e.substr(t+1,n-t-1),i.value=e.substr(n+1)):i.attribute=e.substr(t+1),i},n.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((function(e){return parseInt(e,10)}))}},n.getMid=function(e){var t=n.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},n.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},n.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:n.matchPrefix(e+t,"a=fingerprint:").map(n.parseFingerprint)}},n.writeDtlsParameters=function(e,t){var i="a=setup:"+t+"\r\n";return e.fingerprints.forEach((function(e){i+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),i},n.parseCryptoLine=function(e){var t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},n.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?n.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},n.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;var t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},n.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},n.getCryptoParameters=function(e,t){return n.matchPrefix(e+t,"a=crypto:").map(n.parseCryptoLine)},n.getIceParameters=function(e,t){var i=n.matchPrefix(e+t,"a=ice-ufrag:")[0],s=n.matchPrefix(e+t,"a=ice-pwd:")[0];return i&&s?{usernameFragment:i.substr(12),password:s.substr(10)}:null},n.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},n.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=n.splitLines(e)[0].split(" "),s=3;s<i.length;s++){var a=i[s],r=n.matchPrefix(e,"a=rtpmap:"+a+" ")[0];if(r){var o=n.parseRtpMap(r),c=n.matchPrefix(e,"a=fmtp:"+a+" ");switch(o.parameters=c.length?n.parseFmtp(c[0]):{},o.rtcpFeedback=n.matchPrefix(e,"a=rtcp-fb:"+a+" ").map(n.parseRtcpFb),t.codecs.push(o),o.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(o.name.toUpperCase())}}}return n.matchPrefix(e,"a=extmap:").forEach((function(e){t.headerExtensions.push(n.parseExtmap(e))})),t},n.writeRtpDescription=function(e,t){var i="";i+="m="+e+" ",i+=t.codecs.length>0?"9":"0",i+=" UDP/TLS/RTP/SAVPF ",i+=t.codecs.map((function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType})).join(" ")+"\r\n",i+="c=IN IP4 0.0.0.0\r\n",i+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach((function(e){i+=n.writeRtpMap(e),i+=n.writeFmtp(e),i+=n.writeRtcpFb(e)}));var s=0;return t.codecs.forEach((function(e){e.maxptime>s&&(s=e.maxptime)})),s>0&&(i+="a=maxptime:"+s+"\r\n"),i+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach((function(e){i+=n.writeExtmap(e)})),i},n.parseRtpEncodingParameters=function(e){var t,i=[],s=n.parseRtpParameters(e),a=-1!==s.fecMechanisms.indexOf("RED"),r=-1!==s.fecMechanisms.indexOf("ULPFEC"),o=n.matchPrefix(e,"a=ssrc:").map((function(e){return n.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute})),c=o.length>0&&o[0].ssrc,d=n.matchPrefix(e,"a=ssrc-group:FID").map((function(e){return e.substr(17).split(" ").map((function(e){return parseInt(e,10)}))}));d.length>0&&d[0].length>1&&d[0][0]===c&&(t=d[0][1]),s.codecs.forEach((function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var n={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&t&&(n.rtx={ssrc:t}),i.push(n),a&&((n=JSON.parse(JSON.stringify(n))).fec={ssrc:c,mechanism:r?"red+ulpfec":"red"},i.push(n))}})),0===i.length&&c&&i.push({ssrc:c});var l=n.matchPrefix(e,"b=");return l.length&&(l=0===l[0].indexOf("b=TIAS:")?parseInt(l[0].substr(7),10):0===l[0].indexOf("b=AS:")?1e3*parseInt(l[0].substr(5),10)*.95-16e3:void 0,i.forEach((function(e){e.maxBitrate=l}))),i},n.parseRtcpParameters=function(e){var t={},i=n.matchPrefix(e,"a=ssrc:").map((function(e){return n.parseSsrcMedia(e)})).filter((function(e){return"cname"===e.attribute}))[0];i&&(t.cname=i.value,t.ssrc=i.ssrc);var s=n.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=s.length>0,t.compound=0===s.length;var a=n.matchPrefix(e,"a=rtcp-mux");return t.mux=a.length>0,t},n.parseMsid=function(e){var t,i=n.matchPrefix(e,"a=msid:");if(1===i.length)return{stream:(t=i[0].substr(7).split(" "))[0],track:t[1]};var s=n.matchPrefix(e,"a=ssrc:").map((function(e){return n.parseSsrcMedia(e)})).filter((function(e){return"msid"===e.attribute}));return s.length>0?{stream:(t=s[0].value.split(" "))[0],track:t[1]}:void 0},n.parseSctpDescription=function(e){var t,i=n.parseMLine(e),s=n.matchPrefix(e,"a=max-message-size:");s.length>0&&(t=parseInt(s[0].substr(19),10)),isNaN(t)&&(t=65536);var a=n.matchPrefix(e,"a=sctp-port:");if(a.length>0)return{port:parseInt(a[0].substr(12),10),protocol:i.fmt,maxMessageSize:t};if(n.matchPrefix(e,"a=sctpmap:").length>0){var r=n.matchPrefix(e,"a=sctpmap:")[0].substr(10).split(" ");return{port:parseInt(r[0],10),protocol:r[1],maxMessageSize:t}}},n.writeSctpDescription=function(e,t){var i=[];return i="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&i.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),i.join("")},n.generateSessionId=function(){return Math.random().toString().substr(2,21)},n.writeSessionBoilerplate=function(e,t,i){var s=void 0!==t?t:2;return"v=0\r\no="+(i||"thisisadapterortc")+" "+(e||n.generateSessionId())+" "+s+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},n.writeMediaSection=function(e,t,i,s){var a=n.writeRtpDescription(e.kind,t);if(a+=n.writeIceParameters(e.iceGatherer.getLocalParameters()),a+=n.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===i?"actpass":"active"),a+="a=mid:"+e.mid+"\r\n",e.direction?a+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?a+="a=sendrecv\r\n":e.rtpSender?a+="a=sendonly\r\n":e.rtpReceiver?a+="a=recvonly\r\n":a+="a=inactive\r\n",e.rtpSender){var r="msid:"+s.id+" "+e.rtpSender.track.id+"\r\n";a+="a="+r,a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+r,e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+r,a+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return a+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(a+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+n.localCName+"\r\n"),a},n.getDirection=function(e,t){for(var i=n.splitLines(e),s=0;s<i.length;s++)switch(i[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[s].substr(2)}return t?n.getDirection(t):"sendrecv"},n.getKind=function(e){return n.splitLines(e)[0].split(" ")[0].substr(2)},n.isRejected=function(e){return"0"===e.split(" ",2)[1]},n.parseMLine=function(e){var t=n.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},n.parseOLine=function(e){var t=n.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},n.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=n.splitLines(e),i=0;i<t.length;i++)if(t[i].length<2||"="!==t[i].charAt(1))return!1;return!0},"object"==typeof t&&(t.exports=n)},{}],102:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});var n=(0,e("./adapter_factory.js").adapterFactory)({window:"undefined"==typeof window?void 0:window});i.default=n},{"./adapter_factory.js":103}],103:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.adapterFactory=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.window,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0},d=n.log,l=n.detectBrowser(t),h={browserDetails:l,commonShim:c,extractVersion:n.extractVersion,disableLog:n.disableLog,disableWarnings:n.disableWarnings};switch(l.browser){case"chrome":if(!s||!s.shimPeerConnection||!i.shimChrome)return d("Chrome shim is not included in this adapter release."),h;if(null===l.version)return d("Chrome shim can not determine version, not shimming."),h;d("adapter.js shimming chrome."),h.browserShim=s,c.shimAddIceCandidateNullOrEmpty(t,l),s.shimGetUserMedia(t,l),s.shimMediaStream(t,l),s.shimPeerConnection(t,l),s.shimOnTrack(t,l),s.shimAddTrackRemoveTrack(t,l),s.shimGetSendersWithDtmf(t,l),s.shimGetStats(t,l),s.shimSenderReceiverGetStats(t,l),s.fixNegotiationNeeded(t,l),c.shimRTCIceCandidate(t,l),c.shimConnectionState(t,l),c.shimMaxMessageSize(t,l),c.shimSendThrowTypeError(t,l),c.removeExtmapAllowMixed(t,l);break;case"firefox":if(!r||!r.shimPeerConnection||!i.shimFirefox)return d("Firefox shim is not included in this adapter release."),h;d("adapter.js shimming firefox."),h.browserShim=r,c.shimAddIceCandidateNullOrEmpty(t,l),r.shimGetUserMedia(t,l),r.shimPeerConnection(t,l),r.shimOnTrack(t,l),r.shimRemoveStream(t,l),r.shimSenderGetStats(t,l),r.shimReceiverGetStats(t,l),r.shimRTCDataChannel(t,l),r.shimAddTransceiver(t,l),r.shimGetParameters(t,l),r.shimCreateOffer(t,l),r.shimCreateAnswer(t,l),c.shimRTCIceCandidate(t,l),c.shimConnectionState(t,l),c.shimMaxMessageSize(t,l),c.shimSendThrowTypeError(t,l);break;case"edge":if(!a||!a.shimPeerConnection||!i.shimEdge)return d("MS edge shim is not included in this adapter release."),h;d("adapter.js shimming edge."),h.browserShim=a,a.shimGetUserMedia(t,l),a.shimGetDisplayMedia(t,l),a.shimPeerConnection(t,l),a.shimReplaceTrack(t,l),c.shimMaxMessageSize(t,l),c.shimSendThrowTypeError(t,l);break;case"safari":if(!o||!i.shimSafari)return d("Safari shim is not included in this adapter release."),h;d("adapter.js shimming safari."),h.browserShim=o,c.shimAddIceCandidateNullOrEmpty(t,l),o.shimRTCIceServerUrls(t,l),o.shimCreateOfferLegacy(t,l),o.shimCallbacksAPI(t,l),o.shimLocalStreamsAPI(t,l),o.shimRemoteStreamsAPI(t,l),o.shimTrackEventTransceiver(t,l),o.shimGetUserMedia(t,l),o.shimAudioContext(t,l),c.shimRTCIceCandidate(t,l),c.shimMaxMessageSize(t,l),c.shimSendThrowTypeError(t,l),c.removeExtmapAllowMixed(t,l);break;default:d("Unsupported browser!")}return h};var n=d(e("./utils")),s=d(e("./chrome/chrome_shim")),a=d(e("./edge/edge_shim")),r=d(e("./firefox/firefox_shim")),o=d(e("./safari/safari_shim")),c=d(e("./common_shim"));function d(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}},{"./chrome/chrome_shim":104,"./common_shim":107,"./edge/edge_shim":108,"./firefox/firefox_shim":112,"./safari/safari_shim":115,"./utils":116}],104:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.shimGetDisplayMedia=i.shimGetUserMedia=void 0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=e("./getusermedia");Object.defineProperty(i,"shimGetUserMedia",{enumerable:!0,get:function(){return s.shimGetUserMedia}});var a=e("./getdisplaymedia");Object.defineProperty(i,"shimGetDisplayMedia",{enumerable:!0,get:function(){return a.shimGetDisplayMedia}}),i.shimMediaStream=function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},i.shimOnTrack=function(e){if("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var i=this;return this._ontrackpoly||(this._ontrackpoly=function(t){t.stream.addEventListener("addtrack",(function(n){var s=void 0;s=e.RTCPeerConnection.prototype.getReceivers?i.getReceivers().find((function(e){return e.track&&e.track.id===n.track.id})):{track:n.track};var a=new Event("track");a.track=n.track,a.receiver=s,a.transceiver={receiver:s},a.streams=[t.stream],i.dispatchEvent(a)})),t.stream.getTracks().forEach((function(n){var s=void 0;s=e.RTCPeerConnection.prototype.getReceivers?i.getReceivers().find((function(e){return e.track&&e.track.id===n.id})):{track:n};var a=new Event("track");a.track=n,a.receiver=s,a.transceiver={receiver:s},a.streams=[t.stream],i.dispatchEvent(a)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else r.wrapPeerConnectionEvent(e,"track",(function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e}))},i.shimGetSendersWithDtmf=function(e){if("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var i=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){var s=i.apply(this,arguments);return s||(s=t(this,e),this._senders.push(s)),s};var s=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){s.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var a=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var i=this;this._senders=this._senders||[],a.apply(this,[e]),e.getTracks().forEach((function(e){i._senders.push(t(i,e))}))};var r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._senders=this._senders||[],r.apply(this,[e]),e.getTracks().forEach((function(e){var i=t._senders.find((function(t){return t.track===e}));i&&t._senders.splice(t._senders.indexOf(i),1)}))}}else if("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var o=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=o.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},i.shimGetStats=function(e){if(!e.RTCPeerConnection)return;var t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=this,i=Array.prototype.slice.call(arguments),n=i[0],s=i[1],a=i[2];if(arguments.length>0&&"function"==typeof n)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof n))return t.apply(this,[]);var r=function(e){var t={};return e.result().forEach((function(e){var i={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((function(t){i[t]=e.stat(t)})),t[i.id]=i})),t},o=function(e){return new Map(Object.keys(e).map((function(t){return[t,e[t]]})))};if(arguments.length>=2){var c=function(e){s(o(r(e)))};return t.apply(this,[c,n])}return new Promise((function(i,n){t.apply(e,[function(e){i(o(r(e)))},n])})).then(s,a)}},i.shimSenderReceiverGetStats=function(e){if(!("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,i=t.apply(this,[]);return i.forEach((function(t){return t._pc=e})),i});var i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=i.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return r.filterStats(t,e.track,!0)}))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var s=e.RTCPeerConnection.prototype.getReceivers;s&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=s.apply(this,[]);return t.forEach((function(t){return t._pc=e})),t}),r.wrapPeerConnectionEvent(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then((function(t){return r.filterStats(t,e.track,!1)}))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;var a=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var t=arguments[0],i=void 0,n=void 0,s=void 0;return this.getSenders().forEach((function(e){e.track===t&&(i?s=!0:i=e)})),this.getReceivers().forEach((function(e){return e.track===t&&(n?s=!0:n=e),e.track===t})),s||i&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):i?i.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return a.apply(this,arguments)}},i.shimAddTrackRemoveTrackWithNative=c,i.shimAddTrackRemoveTrack=function(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return c(e);var i=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=i.apply(this);return this._reverseStreams=this._reverseStreams||{},t.map((function(t){return e._reverseStreams[t.id]}))};var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var i=this;if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((function(e){if(i.getSenders().find((function(t){return t.track===e})))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){var s=new e.MediaStream(t.getTracks());this._streams[t.id]=s,this._reverseStreams[s.id]=t,t=s}n.apply(this,[t])};var s=e.RTCPeerConnection.prototype.removeStream;function a(e,t){var i=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((function(t){var n=e._reverseStreams[t],s=e._streams[n.id];i=i.replace(new RegExp(s.id,"g"),n.id)})),new RTCSessionDescription({type:t.type,sdp:i})}function r(e,t){var i=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((function(t){var n=e._reverseStreams[t],s=e._streams[n.id];i=i.replace(new RegExp(n.id,"g"),s.id)})),new RTCSessionDescription({type:t.type,sdp:i})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},s.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,i){var n=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var s=[].slice.call(arguments,1);if(1!==s.length||!s[0].getTracks().find((function(e){return e===t})))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");var a=this.getSenders().find((function(e){return e.track===t}));if(a)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};var r=this._streams[i.id];if(r)r.addTrack(t),Promise.resolve().then((function(){n.dispatchEvent(new Event("negotiationneeded"))}));else{var o=new e.MediaStream([t]);this._streams[i.id]=o,this._reverseStreams[o.id]=i,this.addStream(o)}return this.getSenders().find((function(e){return e.track===t}))},["createOffer","createAnswer"].forEach((function(t){var i=e.RTCPeerConnection.prototype[t],n=o({},t,(function(){var e=this,t=arguments,n=arguments.length&&"function"==typeof arguments[0];return n?i.apply(this,[function(i){var n=a(e,i);t[0].apply(null,[n])},function(e){t[1]&&t[1].apply(null,e)},arguments[2]]):i.apply(this,arguments).then((function(t){return a(e,t)}))}));e.RTCPeerConnection.prototype[t]=n[t]}));var d=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=r(this,arguments[0]),d.apply(this,arguments)):d.apply(this,arguments)};var l=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=l.get.apply(this);return""===e.type?e:a(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};var i=void 0;Object.keys(this._streams).forEach((function(n){t._streams[n].getTracks().find((function(t){return e.track===t}))&&(i=t._streams[n])})),i&&(1===i.getTracks().length?this.removeStream(this._reverseStreams[i.id]):i.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}},i.shimPeerConnection=function(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection);if(!e.RTCPeerConnection)return;t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var i=e.RTCPeerConnection.prototype[t],n=o({},t,(function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}));e.RTCPeerConnection.prototype[t]=n[t]}))},i.fixNegotiationNeeded=function(e,t){r.wrapPeerConnectionEvent(e,"negotiationneeded",(function(e){var i=e.target;if(!(t.version<72||i.getConfiguration&&"plan-b"===i.getConfiguration().sdpSemantics)||"stable"===i.signalingState)return e}))};var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(e("../utils.js"));function o(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function c(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((function(t){return e._shimmedLocalStreams[t][0]}))};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,i){if(!i)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var n=t.apply(this,arguments);return this._shimmedLocalStreams[i.id]?-1===this._shimmedLocalStreams[i.id].indexOf(n)&&this._shimmedLocalStreams[i.id].push(n):this._shimmedLocalStreams[i.id]=[i,n],n};var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((function(e){if(t.getSenders().find((function(t){return t.track===e})))throw new DOMException("Track already exists.","InvalidAccessError")}));var n=this.getSenders();i.apply(this,arguments);var s=this.getSenders().filter((function(e){return-1===n.indexOf(e)}));this._shimmedLocalStreams[e.id]=[e].concat(s)};var n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],n.apply(this,arguments)};var s=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((function(i){var n=t._shimmedLocalStreams[i].indexOf(e);-1!==n&&t._shimmedLocalStreams[i].splice(n,1),1===t._shimmedLocalStreams[i].length&&delete t._shimmedLocalStreams[i]})),s.apply(this,arguments)}}},{"../utils.js":116,"./getdisplaymedia":105,"./getusermedia":106}],105:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.shimGetDisplayMedia=function(e,t){if(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices)return;if(!e.navigator.mediaDevices)return;if("function"!=typeof t)return void console.error("shimGetDisplayMedia: getSourceId argument is not a function");e.navigator.mediaDevices.getDisplayMedia=function(i){return t(i).then((function(t){var n=i.video&&i.video.width,s=i.video&&i.video.height,a=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:a||3}},n&&(i.video.mandatory.maxWidth=n),s&&(i.video.mandatory.maxHeight=s),e.navigator.mediaDevices.getUserMedia(i)}))}}},{}],106:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};i.shimGetUserMedia=function(e,t){var i=e&&e.navigator;if(!i.mediaDevices)return;var a=function(e){if("object"!==(void 0===e?"undefined":n(e))||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach((function(i){if("require"!==i&&"advanced"!==i&&"mediaSource"!==i){var s="object"===n(e[i])?e[i]:{ideal:e[i]};void 0!==s.exact&&"number"==typeof s.exact&&(s.min=s.max=s.exact);var a=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==s.ideal){t.optional=t.optional||[];var r={};"number"==typeof s.ideal?(r[a("min",i)]=s.ideal,t.optional.push(r),(r={})[a("max",i)]=s.ideal,t.optional.push(r)):(r[a("",i)]=s.ideal,t.optional.push(r))}void 0!==s.exact&&"number"!=typeof s.exact?(t.mandatory=t.mandatory||{},t.mandatory[a("",i)]=s.exact):["min","max"].forEach((function(e){void 0!==s[e]&&(t.mandatory=t.mandatory||{},t.mandatory[a(e,i)]=s[e])}))}})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},r=function(e,r){if(t.version>=61)return r(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"===n(e.audio)){var o=function(e,t,i){t in e&&!(i in e)&&(e[i]=e[t],delete e[t])};o((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),o(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=a(e.audio)}if(e&&"object"===n(e.video)){var c=e.video.facingMode;c=c&&("object"===(void 0===c?"undefined":n(c))?c:{ideal:c});var d=t.version<66;if(c&&("user"===c.exact||"environment"===c.exact||"user"===c.ideal||"environment"===c.ideal)&&(!i.mediaDevices.getSupportedConstraints||!i.mediaDevices.getSupportedConstraints().facingMode||d)){delete e.video.facingMode;var l=void 0;if("environment"===c.exact||"environment"===c.ideal?l=["back","rear"]:"user"!==c.exact&&"user"!==c.ideal||(l=["front"]),l)return i.mediaDevices.enumerateDevices().then((function(t){var i=(t=t.filter((function(e){return"videoinput"===e.kind}))).find((function(e){return l.some((function(t){return e.label.toLowerCase().includes(t)}))}));return!i&&t.length&&l.includes("back")&&(i=t[t.length-1]),i&&(e.video.deviceId=c.exact?{exact:i.deviceId}:{ideal:i.deviceId}),e.video=a(e.video),s("chrome: "+JSON.stringify(e)),r(e)}))}e.video=a(e.video)}return s("chrome: "+JSON.stringify(e)),r(e)},o=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};if(i.getUserMedia=function(e,t,n){r(e,(function(e){i.webkitGetUserMedia(e,t,(function(e){n&&n(o(e))}))}))}.bind(i),i.mediaDevices.getUserMedia){var c=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(e){return r(e,(function(e){return c(e).then((function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach((function(e){e.stop()})),new DOMException("","NotFoundError");return t}),(function(e){return Promise.reject(o(e))}))}))}}};var s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(e("../utils.js")).log},{"../utils.js":116}],107:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};i.shimRTCIceCandidate=function(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"===(void 0===e?"undefined":n(e))&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var i=new t(e),s=r.default.parseCandidate(e.candidate),a=Object.assign(i,s);return a.toJSON=function(){return{candidate:a.candidate,sdpMid:a.sdpMid,sdpMLineIndex:a.sdpMLineIndex,usernameFragment:a.usernameFragment}},a}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,o.wrapPeerConnectionEvent(e,"icecandidate",(function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t}))},i.shimMaxMessageSize=function(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var i=function(e){if(!e||!e.sdp)return!1;var t=r.default.splitSections(e.sdp);return t.shift(),t.some((function(e){var t=r.default.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))},n=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var i=parseInt(t[1],10);return i!=i?-1:i},s=function(e){var i=65536;return"firefox"===t.browser&&(i=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),i},a=function(e,i){var n=65536;"firefox"===t.browser&&57===t.version&&(n=65535);var s=r.default.matchPrefix(e.sdp,"a=max-message-size:");return s.length>0?n=parseInt(s[0].substr(19),10):"firefox"===t.browser&&-1!==i&&(n=2147483637),n},o=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){var e=this.getConfiguration(),r=e.sdpSemantics;"plan-b"===r&&Object.defineProperty(this,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(i(arguments[0])){var c=n(arguments[0]),d=s(c),l=a(arguments[0],c),h=void 0;h=0===d&&0===l?Number.POSITIVE_INFINITY:0===d||0===l?Math.max(d,l):Math.min(d,l);var p={};Object.defineProperty(p,"maxMessageSize",{get:function(){return h}}),this._sctp=p}return o.apply(this,arguments)}},i.shimSendThrowTypeError=function(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){var i=e.send;e.send=function(){var n=arguments[0],s=n.length||n.size||n.byteLength;if("open"===e.readyState&&t.sctp&&s>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return i.apply(e,arguments)}}var i=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=i.apply(this,arguments);return t(e,this),e},o.wrapPeerConnectionEvent(e,"datachannel",(function(e){return t(e.channel,e.target),e}))},i.shimConnectionState=function(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;var t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((function(e){var i=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(e){var t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;var i=new Event("connectionstatechange",e);t.dispatchEvent(i)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),i.apply(this,arguments)}}))},i.removeExtmapAllowMixed=function(e,t){if(!e.RTCPeerConnection)return;if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t.version>=605)return;var i=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){var n=t.sdp.split("\n").filter((function(e){return"a=extmap-allow-mixed"!==e.trim()})).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:n}):t.sdp=n}return i.apply(this,arguments)}},i.shimAddIceCandidateNullOrEmpty=function(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;var i=e.RTCPeerConnection.prototype.addIceCandidate;if(!i||0===i.length)return;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}};var s,a=e("sdp"),r=(s=a)&&s.__esModule?s:{default:s},o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(e("./utils"))},{"./utils":116,sdp:101}],108:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.shimGetDisplayMedia=i.shimGetUserMedia=void 0;var n=e("./getusermedia");Object.defineProperty(i,"shimGetUserMedia",{enumerable:!0,get:function(){return n.shimGetUserMedia}});var s=e("./getdisplaymedia");Object.defineProperty(i,"shimGetDisplayMedia",{enumerable:!0,get:function(){return s.shimGetDisplayMedia}}),i.shimPeerConnection=function(e,t){if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var i=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){i.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)&&Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}});e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);var n=(0,d.default)(e,t.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=(0,o.filterIceServers)(e.iceServers,t.version),r.log("ICE servers after filtering:",e.iceServers)),new n(e)},e.RTCPeerConnection.prototype=n.prototype},i.shimReplaceTrack=function(e){e.RTCRtpSender&&!("replaceTrack"in e.RTCRtpSender.prototype)&&(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)};var a,r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(e("../utils")),o=e("./filtericeservers"),c=e("rtcpeerconnection-shim"),d=(a=c)&&a.__esModule?a:{default:a}},{"../utils":116,"./filtericeservers":109,"./getdisplaymedia":110,"./getusermedia":111,"rtcpeerconnection-shim":100}],109:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.filterIceServers=function(e,t){var i=!1;return(e=JSON.parse(JSON.stringify(e))).filter((function(e){if(e&&(e.urls||e.url)){var t=e.urls||e.url;e.url&&!e.urls&&n.deprecated("RTCIceServer.url","RTCIceServer.urls");var s="string"==typeof t;return s&&(t=[t]),t=t.filter((function(e){if(0===e.indexOf("stun:"))return!1;var t=e.startsWith("turn")&&!e.startsWith("turn:[")&&e.includes("transport=udp");return t&&!i?(i=!0,!0):t&&!i})),delete e.url,e.urls=s?t[0]:t,!!t.length}}))};var n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(e("../utils"))},{"../utils":116}],110:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.shimGetDisplayMedia=function(e){if(!("getDisplayMedia"in e.navigator))return;if(!e.navigator.mediaDevices)return;if(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices)return;e.navigator.mediaDevices.getDisplayMedia=e.navigator.getDisplayMedia.bind(e.navigator)}},{}],111:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.shimGetUserMedia=function(e){var t=e&&e.navigator,i=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return i(e).catch((function(e){return Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}}(e))}))}}},{}],112:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.shimGetDisplayMedia=i.shimGetUserMedia=void 0;var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=e("./getusermedia");Object.defineProperty(i,"shimGetUserMedia",{enumerable:!0,get:function(){return s.shimGetUserMedia}});var a=e("./getdisplaymedia");Object.defineProperty(i,"shimGetDisplayMedia",{enumerable:!0,get:function(){return a.shimGetDisplayMedia}}),i.shimOnTrack=function(e){"object"===(void 0===e?"undefined":n(e))&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},i.shimPeerConnection=function(e,t){if("object"!==(void 0===e?"undefined":n(e))||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection);t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){var i=e.RTCPeerConnection.prototype[t],n=function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i;return e}({},t,(function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),i.apply(this,arguments)}));e.RTCPeerConnection.prototype[t]=n[t]}));var i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},s=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){var e=Array.prototype.slice.call(arguments),n=e[0],a=e[1],r=e[2];return s.apply(this,[n||null]).then((function(e){if(t.version<53&&!a)try{e.forEach((function(e){e.type=i[e.type]||e.type}))}catch(t){if("TypeError"!==t.name)throw t;e.forEach((function(t,n){e.set(n,Object.assign({},t,{type:i[t.type]||t.type}))}))}return e})).then(a,r)}},i.shimSenderGetStats=function(e){if("object"!==(void 0===e?"undefined":n(e))||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,i=t.apply(this,[]);return i.forEach((function(t){return t._pc=e})),i});var i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=i.apply(this,arguments);return e._pc=this,e});e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}},i.shimReceiverGetStats=function(e){if("object"!==(void 0===e?"undefined":n(e))||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,i=t.apply(this,[]);return i.forEach((function(t){return t._pc=e})),i});r.wrapPeerConnectionEvent(e,"track",(function(e){return e.receiver._pc=e.srcElement,e})),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}},i.shimRemoveStream=function(e){if(!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype)return;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;r.deprecated("removeStream","removeTrack"),this.getSenders().forEach((function(i){i.track&&e.getTracks().includes(i.track)&&t.removeTrack(i)}))}},i.shimRTCDataChannel=function(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)},i.shimAddTransceiver=function(e){if("object"!==(void 0===e?"undefined":n(e))||!e.RTCPeerConnection)return;var t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var e=arguments[1],i=e&&"sendEncodings"in e;i&&e.sendEncodings.forEach((function(e){if("rid"in e){if(!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));var n=t.apply(this,arguments);if(i){var s=n.sender,a=s.getParameters();(!("encodings"in a)||1===a.encodings.length&&0===Object.keys(a.encodings[0]).length)&&(a.encodings=e.sendEncodings,s.sendEncodings=e.sendEncodings,this.setParametersPromises.push(s.setParameters(a).then((function(){delete s.sendEncodings})).catch((function(){delete s.sendEncodings}))))}return n})},i.shimGetParameters=function(e){if("object"!==(void 0===e?"undefined":n(e))||!e.RTCRtpSender)return;var t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){var e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})},i.shimCreateOffer=function(e){if("object"!==(void 0===e?"undefined":n(e))||!e.RTCPeerConnection)return;var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){var e=this,i=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((function(){return t.apply(e,i)})).finally((function(){e.setParametersPromises=[]})):t.apply(this,arguments)}},i.shimCreateAnswer=function(e){if("object"!==(void 0===e?"undefined":n(e))||!e.RTCPeerConnection)return;var t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){var e=this,i=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((function(){return t.apply(e,i)})).finally((function(){e.setParametersPromises=[]})):t.apply(this,arguments)}};var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(e("../utils"))},{"../utils":116,"./getdisplaymedia":113,"./getusermedia":114}],113:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.shimGetDisplayMedia=function(e,t){if(e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices)return;if(!e.navigator.mediaDevices)return;e.navigator.mediaDevices.getDisplayMedia=function(i){if(!i||!i.video){var n=new DOMException("getDisplayMedia without video constraints is undefined");return n.name="NotFoundError",n.code=8,Promise.reject(n)}return!0===i.video?i.video={mediaSource:t}:i.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(i)}}},{}],114:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};i.shimGetUserMedia=function(e,t){var i=e&&e.navigator,a=e&&e.MediaStreamTrack;if(i.getUserMedia=function(e,t,n){s.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(e).then(t,n)},!(t.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){var r=function(e,t,i){t in e&&!(i in e)&&(e[i]=e[t],delete e[t])},o=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(e){return"object"===(void 0===e?"undefined":n(e))&&"object"===n(e.audio)&&(e=JSON.parse(JSON.stringify(e)),r(e.audio,"autoGainControl","mozAutoGainControl"),r(e.audio,"noiseSuppression","mozNoiseSuppression")),o(e)},a&&a.prototype.getSettings){var c=a.prototype.getSettings;a.prototype.getSettings=function(){var e=c.apply(this,arguments);return r(e,"mozAutoGainControl","autoGainControl"),r(e,"mozNoiseSuppression","noiseSuppression"),e}}if(a&&a.prototype.applyConstraints){var d=a.prototype.applyConstraints;a.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"===(void 0===e?"undefined":n(e))&&(e=JSON.parse(JSON.stringify(e)),r(e,"autoGainControl","mozAutoGainControl"),r(e,"noiseSuppression","mozNoiseSuppression")),d.apply(this,[e])}}}};var s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(e("../utils"))},{"../utils":116}],115:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};i.shimLocalStreamsAPI=function(e){if("object"!==(void 0===e?"undefined":n(e))||!e.RTCPeerConnection)return;"getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams});if(!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){var i=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((function(n){return t.call(i,n,e)})),e.getVideoTracks().forEach((function(n){return t.call(i,n,e)}))},e.RTCPeerConnection.prototype.addTrack=function(e){for(var i=this,n=arguments.length,s=Array(n>1?n-1:0),a=1;a<n;a++)s[a-1]=arguments[a];return s&&s.forEach((function(e){i._localStreams?i._localStreams.includes(e)||i._localStreams.push(e):i._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._localStreams||(this._localStreams=[]);var i=this._localStreams.indexOf(e);if(-1!==i){this._localStreams.splice(i,1);var n=e.getTracks();this.getSenders().forEach((function(e){n.includes(e.track)&&t.removeTrack(e)}))}})},i.shimRemoteStreamsAPI=function(e){if("object"!==(void 0===e?"undefined":n(e))||!e.RTCPeerConnection)return;"getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]});if(!("onaddstream"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var t=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach((function(e){if(t._remoteStreams||(t._remoteStreams=[]),!t._remoteStreams.includes(e)){t._remoteStreams.push(e);var i=new Event("addstream");i.stream=e,t.dispatchEvent(i)}}))})}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((function(t){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(t)>=0)){e._remoteStreams.push(t);var i=new Event("addstream");i.stream=t,e.dispatchEvent(i)}}))}),t.apply(e,arguments)}}},i.shimCallbacksAPI=function(e){if("object"!==(void 0===e?"undefined":n(e))||!e.RTCPeerConnection)return;var t=e.RTCPeerConnection.prototype,i=t.createOffer,s=t.createAnswer,a=t.setLocalDescription,r=t.setRemoteDescription,o=t.addIceCandidate;t.createOffer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],s=i.apply(this,[n]);return t?(s.then(e,t),Promise.resolve()):s},t.createAnswer=function(e,t){var i=arguments.length>=2?arguments[2]:arguments[0],n=s.apply(this,[i]);return t?(n.then(e,t),Promise.resolve()):n};var c=function(e,t,i){var n=a.apply(this,[e]);return i?(n.then(t,i),Promise.resolve()):n};t.setLocalDescription=c,c=function(e,t,i){var n=r.apply(this,[e]);return i?(n.then(t,i),Promise.resolve()):n},t.setRemoteDescription=c,c=function(e,t,i){var n=o.apply(this,[e]);return i?(n.then(t,i),Promise.resolve()):n},t.addIceCandidate=c},i.shimGetUserMedia=function(e){var t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){var i=t.mediaDevices,n=i.getUserMedia.bind(i);t.mediaDevices.getUserMedia=function(e){return n(a(e))}}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,i,n){t.mediaDevices.getUserMedia(e).then(i,n)}.bind(t))},i.shimConstraints=a,i.shimRTCIceServerUrls=function(e){if(!e.RTCPeerConnection)return;var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,i){if(e&&e.iceServers){for(var n=[],a=0;a<e.iceServers.length;a++){var r=e.iceServers[a];!r.hasOwnProperty("urls")&&r.hasOwnProperty("url")?(s.deprecated("RTCIceServer.url","RTCIceServer.urls"),(r=JSON.parse(JSON.stringify(r))).urls=r.url,delete r.url,n.push(r)):n.push(e.iceServers[a])}e.iceServers=n}return new t(e,i)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})},i.shimTrackEventTransceiver=function(e){"object"===(void 0===e?"undefined":n(e))&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},i.shimCreateOfferLegacy=function(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var i=this.getTransceivers().find((function(e){return"audio"===e.receiver.track.kind}));!1===e.offerToReceiveAudio&&i?"sendrecv"===i.direction?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":"recvonly"===i.direction&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):!0!==e.offerToReceiveAudio||i||this.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var n=this.getTransceivers().find((function(e){return"video"===e.receiver.track.kind}));!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video")}return t.apply(this,arguments)}},i.shimAudioContext=function(e){if("object"!==(void 0===e?"undefined":n(e))||e.AudioContext)return;e.AudioContext=e.webkitAudioContext};var s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(e("../utils"));function a(e){return e&&void 0!==e.video?Object.assign({},e,{video:s.compactObject(e.video)}):e}},{"../utils":116}],116:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};i.extractVersion=r,i.wrapPeerConnectionEvent=function(e,t,i){if(!e.RTCPeerConnection)return;var n=e.RTCPeerConnection.prototype,s=n.addEventListener;n.addEventListener=function(e,n){if(e!==t)return s.apply(this,arguments);var a=function(e){var t=i(e);t&&(n.handleEvent?n.handleEvent(t):n(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(n,a),s.apply(this,[e,a])};var a=n.removeEventListener;n.removeEventListener=function(e,i){if(e!==t||!this._eventMap||!this._eventMap[t])return a.apply(this,arguments);if(!this._eventMap[t].has(i))return a.apply(this,arguments);var n=this._eventMap[t].get(i);return this._eventMap[t].delete(i),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,a.apply(this,[e,n])},Object.defineProperty(n,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})},i.disableLog=function(e){if("boolean"!=typeof e)return new Error("Argument type: "+(void 0===e?"undefined":n(e))+". Please use a boolean.");return s=e,e?"adapter.js logging disabled":"adapter.js logging enabled"},i.disableWarnings=function(e){if("boolean"!=typeof e)return new Error("Argument type: "+(void 0===e?"undefined":n(e))+". Please use a boolean.");return a=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled")},i.log=function(){if("object"===("undefined"==typeof window?"undefined":n(window))){if(s)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},i.deprecated=function(e,t){if(!a)return;console.warn(e+" is deprecated, please use "+t+" instead.")},i.detectBrowser=function(e){var t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;var i=e.navigator;if(i.mozGetUserMedia)t.browser="firefox",t.version=r(i.userAgent,/Firefox\/(\d+)\./,1);else if(i.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)t.browser="chrome",t.version=r(i.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(i.mediaDevices&&i.userAgent.match(/Edge\/(\d+).(\d+)$/))t.browser="edge",t.version=r(i.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!i.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=r(i.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t},i.compactObject=function e(t){if(!o(t))return t;return Object.keys(t).reduce((function(i,n){var s=o(t[n]),a=s?e(t[n]):t[n],r=s&&!Object.keys(a).length;return void 0===a||r?i:Object.assign(i,function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i;return e}({},n,a))}),{})},i.walkStats=c,i.filterStats=function(e,t,i){var n=i?"outbound-rtp":"inbound-rtp",s=new Map;if(null===t)return s;var a=[];return e.forEach((function(e){"track"===e.type&&e.trackIdentifier===t.id&&a.push(e)})),a.forEach((function(t){e.forEach((function(i){i.type===n&&i.trackId===t.id&&c(e,i,s)}))})),s};var s=!0,a=!0;function r(e,t,i){var n=e.match(t);return n&&n.length>=i&&parseInt(n[i],10)}function o(e){return"[object Object]"===Object.prototype.toString.call(e)}function c(e,t,i){t&&!i.has(t.id)&&(i.set(t.id,t),Object.keys(t).forEach((function(n){n.endsWith("Id")?c(e,e.get(t[n]),i):n.endsWith("Ids")&&t[n].forEach((function(t){c(e,e.get(t),i)}))})))}},{}],117:[function(e,t,i){const n=e("./plugins/MultiTouchEvents"),s=e("./plugins/ButtonsEvents"),a=e("./plugins/Fullscreen"),r=e("./plugins/Clipboard"),o=e("./plugins/StreamBitrate"),c=e("./plugins/Screencast"),d=e("./plugins/StreamResolution"),l=e("./plugins/CoordinateUtils"),h=e("./plugins/KeyboardEvents"),p=e("./plugins/MouseEvents"),u=e("./plugins/PeerConnectionStats"),m=e("./plugins/Gamepad"),g=e("./plugins/Camera"),f=e("./plugins/GPS"),v=e("./plugins/FileUpload"),b=e("./plugins/Battery"),C=e("./plugins/Identifiers"),y=e("./plugins/Network"),S=e("./plugins/Phone"),E=e("./plugins/BasebandRIL"),T=e("./plugins/IOThrottling"),I=e("./plugins/GamepadManager"),k=e("./plugins/FingerPrint"),w=e("./plugins/MediaManager"),{generateUID:R}=e("./utils/helpers"),P=e("loglevel");P.setDefaultLevel("debug"),t.exports=class{constructor(e,t){this.timeoutCallbacks=[],this.videoBackupStyleBackground="",this.options=t,this.initialized=!1,this.reconnecting=!1,this.keyboardEventsEnabled=!1,this.touchEventsEnabled=!1,this.mouseEventsEnabled=!1,this.gamepadEventsEnabled=!1,this.webRTCWebsocket=null,this.useWebsocketAsDataChannel=!1,this.root=e,this.video=this.getChildByClass(this.root,"gm-video"),this.wrapper=this.getChildByClass(this.root,"gm-wrapper"),this.videoWrapper=this.getChildByClass(this.root,"gm-video-wrapper"),this.stream=null,this.callbacks={},this.allListeners=[],this.peerConnection=null,this.signalingDataChannel=null,this.cameraSender=null,this.microphoneSender=null,this.sdpConstraints={offerToReceiveAudio:!0,offerToReceiveVideo:!0},this.x=0,this.y=0,this.clickHandlerCloseOverlay=e=>{null!==e.target.closest(".gm-overlay")||e.target.classList.contains("gm-icon-button")||e.target.classList.contains("gm-dont-close")||this.emit("close-overlays")},this.addListener(document,"click",this.clickHandlerCloseOverlay)}addCustomPlugins(){return[{enabled:this.options.touch,class:n},{enabled:this.options.fullscreen,class:a},{enabled:this.options.clipboard,class:r,params:[this.options.i18n]},{enabled:this.options.streamBitrate,class:o,params:[this.options.i18n]},{enabled:this.options.camera,class:g,params:[this.options.i18n],dependencies:[w]},{enabled:this.options.battery,class:b,params:[this.options.i18n]},{enabled:this.options.gps,class:f,params:[this.options.i18n,this.options.gpsSpeedSupport]},{enabled:this.options.capture,class:c,params:[this.options.i18n]},{enabled:this.options.streamResolution,class:d},{enabled:this.options.buttons,class:s,params:[this.options.i18n,this.options.translateHomeKey]},{enabled:this.options.touch||this.options.mouse,class:l},{enabled:this.options.keyboard,class:h},{enabled:this.options.mouse,class:p},{enabled:this.options.gamepad,class:m,params:[this.options.i18n],dependencies:[I]},{enabled:this.options.fileUpload,class:v,params:[this.options.i18n]},{enabled:this.options.identifiers,class:C,params:[this.options.i18n]},{enabled:this.options.network,class:y,params:[this.options.i18n]},{enabled:this.options.phone,class:S,params:[this.options.i18n]},{enabled:this.options.baseband,class:E,params:[this.options.i18n,this.options.baseband]},{enabled:this.options.diskIO,class:T,params:[this.options.i18n]},{enabled:this.options.biometrics,class:k},{enabled:this.options.microphone,class:w}]}dispatchEvent(e,t){window.dispatchEvent(new CustomEvent(e,{detail:t}))}getChildByClass(e,t){for(let i=0;i<e.childNodes.length;i++){const n=e.childNodes[i];if(n.classList&&n.classList.contains(t))return n;const s=this.getChildByClass(n,t);if(s)return s}return null}registerEventCallback(e,t){this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(t)}emit(e,t){this.callbacks[e]&&this.callbacks[e].forEach(e=>{e(t)})}isWebsocketOpen(e){return e&&e instanceof WebSocket&&e.readyState===e.OPEN}onWebRTCReady(){this.webRTCConnectionRetryCount=0,this.openWebRTCConnection()}openWebRTCConnection(){this.webRTCWebsocket&&(this.disconnect(),this.reconnecting=!0),this.webRTCWebsocket=new WebSocket(this.options.webRTCUrl,this.webRTCWebsocketName),this.webRTCWebsocket.onopen=this.sendAuthenticationToken.bind(this),this.webRTCWebsocket.onmessage=this.onWebSocketMessage.bind(this),this.webRTCWebsocket.onerror=this.onWebSocketMessage.bind(this),this.webRTCWebsocket.binaryType="arraybuffer",this.webRTCConnectionRetryCount<=13?this.onConnectionClosed():P.error("Unable to establish connection to your instance.")}onConnectionClosed(){this.webRTCWebsocket.onclose=e=>{switch(this.store.dispatch({type:"WEBRTC_CONNECTION_READY",payload:!1}),this.video.style.background=this.videoBackupStyleBackground,this.initialized=!1,P.debug("Error! Maybe your VM is not available yet? ("+e.code+") "+e.reason),e.code){case 1e3:case 1001:case 1005:P.debug("Closing websocket"),this.dispatchEvent("closeConnection",{msg:"Closing connection"});break;case 1002:case 1003:case 1006:case 1007:case 1008:case 1009:case 1010:case 1011:case 1012:case 1013:case 1014:case 1015:{this.dispatchEvent("closeConnectionUnavailable",{msg:"Can't connect to the WebSocket"}),P.debug("Retrying in 3 seconds...");const e=setTimeout(()=>{this.openWebRTCConnection()},3e3);this.timeoutCallbacks.push(e),this.webRTCConnectionRetryCount++;break}case 4242:this.dispatchEvent("closeWrongToken",{msg:"Wrong token, can't establish connection"});break;case 4243:this.dispatchEvent("closeNoLongerValidToken",{msg:"The token provided is no longer valid"});break;case 4244:this.dispatchEvent("closeServerShutdown",{msg:"Server is shutting down..."});break;default:this.dispatchEvent("defaultCloseConnection",{msg:"Default close connection"})}}}sendAuthenticationToken(){const e={type:"token",token:this.options.token};this.isWebsocketOpen(this.webRTCWebsocket)&&this.webRTCWebsocket.send(JSON.stringify(e))}disconnect(){var e;if(this.initialized=!1,null===(e=this.mediaManager)||void 0===e||e.disconnect(),this.webRTCWebsocket&&(this.webRTCWebsocket.close(),this.webRTCWebsocket=null,this.timeoutCallbacks.forEach(e=>{clearTimeout(e)}),this.timeoutCallbacks=[]),this.peerConnection&&(this.peerConnection.close(),this.peerConnection=null),this.signalingDataChannel&&(this.signalingDataChannel.close(),this.signalingDataChannel=null),void 0!==this.fileUpload){const e={type:"close"};this.fileUpload.loaderWorker.postMessage(e)}}sendEvent(e){e=JSON.stringify(e),this.useWebsocketAsDataChannel?this.isWebsocketOpen(this.webRTCWebsocket)&&this.webRTCWebsocket.send(e):this.signalingDataChannel&&"open"===this.signalingDataChannel.readyState?this.signalingDataChannel.send(e):P.warn("cannot send event, signaling data channel closed")}async renegotiateWebRTCConnection(){/^((?!chrome|android).)*safari/i.test(navigator.userAgent)&&(this.peerConnection.addTransceiver("audio"),this.peerConnection.addTransceiver("video"));try{const e=await this.peerConnection.createOffer(this.sdpConstraints);this.setLocalDescription(e)}catch(e){return this.onWebRTCConnectionError(e),!1}return!0}createPeerConnection(){P.debug("Creating peer connection");const e=[];Array.isArray(this.options.stun)?this.options.stun.forEach(t=>{e.push(t)}):Object.keys(this.options.stun).length>0&&e.push(this.options.stun),Array.isArray(this.options.turn)?this.options.turn.forEach(t=>{e.push(t)}):Object.keys(this.options.turn).length>0&&e.push(this.options.turn);const t={iceServers:e};if(this.peerConnection)P.debug("Peer connection already exists");else try{this.peerConnection=new RTCPeerConnection(t)}catch(e){P.warn("Failed to create PeerConnection, exception:",e.message)}void 0!==this.peerConnection.createDataChannel?this.createDataChannels():this.useWebsocketAsDataChannel=!0,this.peerConnection.onicecandidate=e=>{void 0!==e.candidate&&(e.candidate?this.sendIceCandidate(e.candidate):P.debug("All candidates ready"))},this.peerConnection.ontrack=e=>{if(P.debug("Received track:",e.track.kind),"video"!==e.track.kind)return;P.debug("Added remote video track using ontrack"),this.video.srcObject=e.streams[0],this.video.setAttribute("playsinline",!0),this.stream=e.streams[0],new u(this,this.peerConnection,3e3),this.videoBackupStyleBackground=this.video.style.background,this.video.style.background="transparent",this.touchEventsEnabled&&this.touchEvents.addTouchCallbacks(),this.mouseEventsEnabled&&this.mouseEvents.addMouseCallbacks(),this.keyboardEventsEnabled&&this.keyboardEvents.addKeyboardCallbacks(),this.gamepadEventsEnabled&&this.gamepadManager.addGamepadCallbacks();const t=this.video.play();t&&t.then(()=>{P.debug("Playing video with sound enabled"),this.dispatchEvent("video",{msg:"play automatically allowed with sound"})}).catch(()=>{P.debug("Can't play video with sound enabled"),this.dispatchEvent("video",{msg:"play with sound denied"}),this.video.muted=!0;this.video.play().then(()=>{P.debug("Playing video with sound disabled"),this.dispatchEvent("video",{msg:"play automatically allowed without sound"});const e=document.createElement("div");e.classList.add("gm-click-to-unmute"),e.innerHTML=this.options.i18n.UNMUTE_INVITE||"By default, the sound has been turned off, please click anywhere to re-enable audio",this.videoWrapper.prepend(e);this.removeAddSoundListener=this.addListener(window,["click","touchend"],()=>{this.video.muted=!1,this.removeAddSoundListener(),this.dispatchEvent("video",{msg:"sound manually allowed by click"}),e.remove(),P.debug("Playing video with sound enabled has been authorized due to user click")})}).catch(()=>{P.debug("Can't play video, even with sound disabled"),this.dispatchEvent("video",{msg:"play denied even without sound"});const e=document.createElement("div");this.classList.add("gm-click-to-display"),this.classList.add("gm-video-overlay"),this.videoWrapper.prepend(e);this.removeAllowPlayListener=this.addListener(e,["click","touchend"],()=>{this.removeAllowPlayListener(),this.video.play(),e.remove(),this.dispatchEvent("video",{msg:"play manually allowed by click"}),P.debug("Playing video with sound disabled has been authorized due to user click")})})})},this.peerConnection.oniceconnectionstatechange=()=>{const e=this.peerConnection?this.peerConnection.iceConnectionState:"No peerConnection";if(P.debug("iceConnectionState: ",e),this.dispatchEvent("iceConnectionState",{msg:e}),"failed"!==e)return;let t='<div class="gm-error-text">Aw, snap!<br/>Connection failed.<p>Check your internet connection & firewall rules.{DOC_AVAILABLE}</p></div>';const i=document.createElement("div");if(i.classList.add("gm-overlay-cant-connect"),i.classList.add("gm-video-overlay"),this.videoWrapper.prepend(i),this.options.connectionFailedURL){t=t.replace("{DOC_AVAILABLE}",'</br>See <a href="">help</a> to setup TURN configuration.');const e=()=>{this.removeOpenDocListener(),this.dispatchEvent("iceConnectionStateDocumentation",{msg:"clicked"}),i.remove(),window.open(this.options.connectionFailedURL,"_blank")};this.removeOpenDocListener=this.addListener(i,["click","touchend"],e)}else t=t.replace("{DOC_AVAILABLE}","");i.innerHTML=t},this.onConnectionStateChange=()=>{P.debug("ConnectionState changed:",this.peerConnection.iceConnectionState),"disconnected"===this.peerConnection.iceConnectionState&&this.onWebRTCReady()},this.addListener(this.peerConnection,"connectionstatechange",this.onConnectionStateChange),this.peerConnection.onnegotiationneeded=()=>{P.debug("on Negotiation needed")},this.renegotiateWebRTCConnection()}createDataChannels(){this.signalingDataChannel=this.peerConnection.createDataChannel("events",{ordered:!0}),this.signalingDataChannel.onerror=e=>{P.warn("Data Channel Error:",e)},this.signalingDataChannel.onmessage=e=>{P.debug("Got Data Channel Message:",e.data)},this.signalingDataChannel.onopen=()=>{this.store.dispatch({type:"WEBRTC_CONNECTION_READY",payload:!0}),P.debug("Data Channel opened")},this.signalingDataChannel.onclose=()=>{P.debug("The Data Channel is Closed")},this.peerConnection.ondatachannel=e=>{e.channel.onmessage=this.onDataChannelMessage.bind(this)}}sendIceCandidate(e){this.isWebsocketOpen(this.webRTCWebsocket)&&this.webRTCWebsocket.send(JSON.stringify(e))}setLocalDescription(e){const t=[...e.sdp.matchAll(/a=rtpmap:(\d+) opus\/48000\/2/g)][0];t&&(e.sdp=e.sdp.replace(new RegExp(`(a=fmtp:${t[1]}) ?(.*)(\r?\n)`,"g"),(e,t,i,n,s,a)=>`${i?`${t} ${i};`:t+" "}stereo=1;maxplaybackrate=48000;maxaveragebitrate=256000${n}`)),this.peerConnection.setLocalDescription(e),this.isWebsocketOpen(this.webRTCWebsocket)&&this.webRTCWebsocket.send(JSON.stringify(e))}onWebSocketMessage(e){let t=null;try{t=JSON.parse(e.data)}catch(e){return}if(t)if(t.sdp)try{const e=new RTCSessionDescription(t);this.peerConnection.setRemoteDescription(e,this.onWebRTCConnectionEstablished.bind(this),this.onWebRTCConnectionError.bind(this))}catch(e){P.warn("Failed to create SDP ",e.message)}else if(t.candidate){if("end-of-candidates"===t.candidate)return void P.debug("End of ICE candidates received");try{const e=new RTCIceCandidate(t);this.peerConnection.addIceCandidate(e)}catch(e){P.warn("Failed to create ICE ",e.message)}}else t.connection?this.createPeerConnection():this.handleMessage(t)}onWebRTCConnectionEstablished(){if(P.debug("WebRTC connection success"),!this.initialized&&(this.initialized=!0,this.reconnecting?this.reconnecting=!1:this.dispatchEvent("successConnection",{msg:"Connection established"}),this.fileUpload)){const e={type:"address",fileUploadAddress:this.options.fileUploadUrl,token:this.options.token};this.fileUpload.loaderWorker&&this.fileUpload.loaderWorker.postMessage(e)}}onWebRTCConnectionError(e){P.debug("Failure callback:",e)}onDataChannelMessage(e){const t=JSON.parse(e.data);this.handleMessage(t)}handleMessage(e){if("USERS"===e.type)"SUCCESS"===e.code&&this.dispatchEvent("userListUpdated",{msg:e.message});else if("VERSION"===e.type){if("SUCCESS"===e.code){const t=this.getChildByClass(this.root,"gm-version-number");t&&(t.innerHTML=e.message)}}else"CAPABILITIES"===e.type&&[{widget:this.battery,capability:e.message.battery},{widget:this.camera,capability:e.message.camera},{widget:this.gps,capability:e.message.gps},{widget:this.identifiers,capability:e.message.identifiers},{widget:this.network,capability:e.message.network},{widget:this.network,capability:e.message.mobileThrottling,enable:e=>{e.enableMobileThrottling()},disable:e=>{e.disableMobileThrottling()}},{widget:this.network,capability:e.message.enable5G,enable:e=>{e.enable5G()},disable:e=>{e.disable5G()}},{widget:this.phone,capability:e.message.phone},{widget:this.baseband,capability:e.message.phone},{widget:this.diskIO,capability:e.message.diskIO},{widget:this.buttonsEvents,capability:e.message.accelerometer,enable:e=>{e.enableRotation()},disable:e=>{e.disableRotation()}},{widget:this.fileUpload,capability:e.message.systemPatcher,enable:e=>{e.setAvailability(!0)},disable:e=>{e.setAvailability(!1)}},{widget:this.fingerprint,capability:e.message.biometrics}].forEach(e=>{void 0!==e.widget&&(!0===e.capability?e.enable?e.enable(e.widget):e.widget.enable():e.disable?e.disable(e.widget):e.widget.disable())});"SUCCESS"===e.code&&this.emit(e.type,e.message)}addListener(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const s=Array.isArray(t)?t:[t],a=R();return s.forEach(t=>{e.addEventListener(t,i,n),this.allListeners.push({id:a,object:e,event:t,handler:i,options:n})}),()=>{this.allListeners=this.allListeners.filter(t=>t.id!==a||(e.removeEventListener(t.event,t.handler,t.options),!1))}}removeAllListeners(){this.allListeners.forEach(e=>{let{object:t,event:i,handler:n,options:s}=e;t.removeEventListener(i,n,s)}),this.allListeners.length=0}destroy(){var e;0!==this.webRTCWebsocket.readyState&&(this.removeAllListeners(),this.disconnect(),null===(e=this.peerConnectionStats)||void 0===e||e.destroy(),delete this.peerConnectionStats,delete this.video,delete this.wrapper,delete this.videoWrapper,delete this.root,delete this.stream)}}},{"./plugins/BasebandRIL":120,"./plugins/Battery":121,"./plugins/ButtonsEvents":122,"./plugins/Camera":123,"./plugins/Clipboard":124,"./plugins/CoordinateUtils":125,"./plugins/FileUpload":126,"./plugins/FingerPrint":127,"./plugins/Fullscreen":128,"./plugins/GPS":129,"./plugins/Gamepad":130,"./plugins/GamepadManager":131,"./plugins/IOThrottling":132,"./plugins/Identifiers":133,"./plugins/KeyboardEvents":134,"./plugins/MediaManager":135,"./plugins/MouseEvents":136,"./plugins/MultiTouchEvents":137,"./plugins/Network":138,"./plugins/PeerConnectionStats":139,"./plugins/Phone":140,"./plugins/Screencast":141,"./plugins/StreamBitrate":142,"./plugins/StreamResolution":143,"./utils/helpers":151,loglevel:99}],118:[function(e,t,i){const n=e("./DeviceRenderer"),s=e("lodash/defaultsDeep"),a=e("./store"),r=e("loglevel");r.setDefaultLevel("debug");const o={template:"renderer",touch:!0,mouse:!0,volume:!0,rotation:!0,navbar:!0,power:!0,keyboard:!0,fullscreen:!0,camera:!0,microphone:!1,fileUpload:!0,streamBitrate:!1,clipboard:!0,battery:!0,gps:!0,gpsSpeedSupport:!1,capture:!0,identifiers:!0,network:!0,mobilethrottling:!1,baseband:!1,phone:!0,streamResolution:!0,diskIO:!0,gamepad:!1,biometrics:!0,translateHomeKey:!1,token:"",i18n:{},stun:{urls:["stun:stun-eu.genymotion.com:80","stun:stun-eu.genymotion.com:443","stun:stun-eu.genymotion.com:3478","stun:stun-eu.genymotion.com:5349","stun:stun-na.genymotion.com:80","stun:stun-na.genymotion.com:443","stun:stun-na.genymotion.com:3478","stun:stun-na.genymotion.com:5349"]},connectionFailedURL:"",turn:{},giveFeedbackLink:"https://github.com/orgs/Genymobile/discussions"};t.exports=class{constructor(){this.instances=[],this.templates={bootstrap:{html:'<div class="gm-wrapper">    <div style="text-align: center" class="gm-video-wrapper embed-responsive embed-responsive-16by9">        <video class="gm-video embed-responsive-item" autoplay preload="none">            Your browser does not support the VIDEO tag        </video>    </div>    <div class="gm-toolbars">        <div class="gm-toolbar">            <ul>            </ul>        </div>    </div></div>',css:".gm_bootstrap .gm-video {    background: transparent;    background-size: contain;    background-position: center;    width: 99%}.gm_bootstrap {    background-color: black;}.gm_bootstrap .gm-toolbars {    position: absolute;    width: 47px;    height: 100%;    top: 0;    right: 0;    margin: 0;}.gm_bootstrap .gm-toolbar {    position: absolute;    top: 5%;    right: 0;    margin: 0;}.gm_bootstrap li img {    margin: auto}@media (min-width: 1200px) {    .gm_bootstrap li img {        width: 85%;    }}"},fullscreen:{html:'<a class="gm-fullscreen-message" href="#"></a><div class="gm-wrapper hide">    <div class="gm-video-wrapper">        <video class="gm-video" autoplay preload="none">            Your browser does not support the VIDEO tag        </video>    </div>    <div class="gm-toolbars">        <div class="gm-toolbar">            <ul>            </ul>        </div>    </div></div><p class="gm-layout-fullwindow" hidden></p>',js:"",css:".gm-fullscreen {    position: absolute;    top: 0;    left: 0;    margin: 0;    padding: 0;    display: block;    width: 100%;    height: 97%;    background-color: black;}.gm-fullscreen .gm-fullscreen-message {    display: block;    padding: 0;    margin: 0;    height: 100%;    width: 100%;    background: white;    background-size: cover;}.gm-video .hide {    display: none;}.gm-fullscreen .gm-video {    background: transparent;    position: absolute;    top: 0;    left: 0;    width: 95%;    height: 100%;    padding: 0;}.gm-toolbars {    position: absolute;    top: 0;    right: 0;}"},fullwindow:{html:'<div class="gm-wrapper">    <div class="gm-video-wrapper">        <video class="gm-video" autoplay preload="none">            Your browser does not support the VIDEO tag        </video>    </div>    <div class="gm-toolbar">        <ul>        </ul>    </div></div><p class="gm-layout-fullwindow" hidden></p>',js:"",css:".gm_fullwindow {    position: absolute;    top: 0;    left: 0;    margin: 0;    padding: 0;    display: block;    width: 100%;    height: 97%;    min-height: 560px;    background-color: black;}.gm_fullwindow .gm-video {    background: transparent;    position: absolute;    top: 0;    left: 0;    width: calc(95% - 50px);    height: 100%;    padding: 0;}.gm_fullwindow .toolbar {    position: absolute;    top: 10px;    right: 0;    padding-right: 10px;    margin: 0;    width: 50px;}"},renderer:{html:'<div class="gm-wrapper">    <div class="device-renderer">        <div class="gm-video-wrapper">            <video class="gm-video" autoplay preload="none">                Your browser does not support the VIDEO tag            </video>        </div>        <div class="gm-toolbars">            <div class="gm-toolbar">                <ul>                </ul>            </div>        </div>    </div></div>',js:"",css:'.gm-template-renderer .device-renderer {    position: relative;    border-collapse: separate;    border-radius: 3px;    padding: 40px 10px 40px 10px;    margin-left: auto;    margin-right: auto;    background-color: black;}.gm-template-renderer .gm-video {    background: transparent url("data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz48c3ZnIHdpZHRoPScxMjJweCcgaGVpZ2h0PScxMjJweCcgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB2aWV3Qm94PSIwIDAgMTAwIDEwMCIgcHJlc2VydmVBc3BlY3RSYXRpbz0ieE1pZFlNaWQiIGNsYXNzPSJ1aWwtcmluZyI+PHJlY3QgeD0iMCIgeT0iMCIgd2lkdGg9IjEwMCIgaGVpZ2h0PSIxMDAiIGZpbGw9Im5vbmUiIGNsYXNzPSJiayI+PC9yZWN0PjxjaXJjbGUgY3g9IjUwIiBjeT0iNTAiIHI9IjQ1IiBzdHJva2UtZGFzaGFycmF5PSIxNTUuNTA4ODM2MzUyNjk0NzcgMTI3LjIzNDUwMjQ3MDM4NjYyIiBzdHJva2U9IiNFNjE5NUUiIGZpbGw9Im5vbmUiIHN0cm9rZS13aWR0aD0iMTAiPjxhbmltYXRlVHJhbnNmb3JtIGF0dHJpYnV0ZU5hbWU9InRyYW5zZm9ybSIgdHlwZT0icm90YXRlIiB2YWx1ZXM9IjAgNTAgNTA7MTgwIDUwIDUwOzM2MCA1MCA1MDsiIGtleVRpbWVzPSIwOzAuNTsxIiBkdXI9IjFzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSIgYmVnaW49IjBzIj48L2FuaW1hdGVUcmFuc2Zvcm0+PC9jaXJjbGU+PC9zdmc+") no-repeat center;    width: 1024px;    height: 600px;    margin-right: 60px;}.gm-template-renderer .gm-toolbars {    position: absolute;    top: 0;    right: 0;    width: 60px;}'},renderer_minimal:{html:'<div class="gm-wrapper">    <div class="gm-video-wrapper">        <video class="gm-video" autoplay preload="none">            Your browser does not support the VIDEO tag        </video>    </div>    <div class="gm-toolbar">        <ul>        </ul>    </div>    <span class="gm-version-number"></span></div>',js:"",css:'.gm-template-renderer_minimal {    position: absolute;    top: 0;    left: 0;    margin: 0;    padding: 0;    display: block;    width: 100%;    height: 100%;    min-height: 560px;    background-color: black;}.gm-template-renderer_minimal .gm-video {    position: fixed;    top: 0;    left: 0;    width: calc(100vw - 57px);    height: 100vh;    padding: 0;    margin: 0;    background: transparent url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NCA2NCIgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0IiBmaWxsPSJ3aGl0ZSI+CiAgPGNpcmNsZSB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxNiAxNikiIGN4PSIwIiBjeT0iMTYiIHI9IjAiPiAKICAgIDxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9InIiIHZhbHVlcz0iMDsgNDsgMDsgMCIgZHVyPSIxLjJzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSIgYmVnaW49IjAiCiAgICAgIGtleXRpbWVzPSIwOzAuMjswLjc7MSIga2V5U3BsaW5lcz0iMC4yIDAuMiAwLjQgMC44OzAuMiAwLjYgMC40IDAuODswLjIgMC42IDAuNCAwLjgiIGNhbGNNb2RlPSJzcGxpbmUiIC8+CiAgPC9jaXJjbGU+CiAgPGNpcmNsZSB0cmFuc2Zvcm09InRyYW5zbGF0ZSgzMiAxNikiIGN4PSIwIiBjeT0iMTYiIHI9IjAiPiAKICAgIDxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9InIiIHZhbHVlcz0iMDsgNDsgMDsgMCIgZHVyPSIxLjJzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSIgYmVnaW49IjAuMyIKICAgICAga2V5dGltZXM9IjA7MC4yOzAuNzsxIiBrZXlTcGxpbmVzPSIwLjIgMC4yIDAuNCAwLjg7MC4yIDAuNiAwLjQgMC44OzAuMiAwLjYgMC40IDAuOCIgY2FsY01vZGU9InNwbGluZSIgLz4KICA8L2NpcmNsZT4KICA8Y2lyY2xlIHRyYW5zZm9ybT0idHJhbnNsYXRlKDQ4IDE2KSIgY3g9IjAiIGN5PSIxNiIgcj0iMCI+IAogICAgPGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgdmFsdWVzPSIwOyA0OyAwOyAwIiBkdXI9IjEuMnMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIiBiZWdpbj0iMC42IgogICAgICBrZXl0aW1lcz0iMDswLjI7MC43OzEiIGtleVNwbGluZXM9IjAuMiAwLjIgMC40IDAuODswLjIgMC42IDAuNCAwLjg7MC4yIDAuNiAwLjQgMC44IiBjYWxjTW9kZT0ic3BsaW5lIiAvPgogIDwvY2lyY2xlPgo8L3N2Zz4K") center no-repeat;    background-size: 40%;}.gm-template-renderer_minimal .gm-toolbar {    position: absolute;    top: 10px;    right: 0;    padding-right: 5px;    margin: 0;    width: 50px;}.gm-template-renderer_minimal .gm-version-number {    position: fixed;    right: 5px;    bottom: 5px;    z-index: 2;    color: white;}'},renderer_no_toolbar:{html:'<div class="gm-wrapper">    <div class="gm-video-wrapper">        <video class="gm-video" autoplay poster="src/assets/images/loader.svg" disablePictureInPicture>            Your browser does not support the VIDEO tag        </video>    </div></div>',js:"",css:'.gm-template-renderer_no_toolbar {    position: absolute;    top: 0;    left: 0;    margin: 0;    padding: 0;    display: block;    width: 100%;    height: 100%;    min-height: 560px;    background-color: black;}.gm-template-renderer_no_toolbar .gm-video {    position: fixed;    top: 0;    left: 0;    width: 100%;    height: 100%;    padding: 0;    background: transparent url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NCA2NCIgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0IiBmaWxsPSJ3aGl0ZSI+CiAgPGNpcmNsZSB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxNiAxNikiIGN4PSIwIiBjeT0iMTYiIHI9IjAiPiAKICAgIDxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9InIiIHZhbHVlcz0iMDsgNDsgMDsgMCIgZHVyPSIxLjJzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSIgYmVnaW49IjAiCiAgICAgIGtleXRpbWVzPSIwOzAuMjswLjc7MSIga2V5U3BsaW5lcz0iMC4yIDAuMiAwLjQgMC44OzAuMiAwLjYgMC40IDAuODswLjIgMC42IDAuNCAwLjgiIGNhbGNNb2RlPSJzcGxpbmUiIC8+CiAgPC9jaXJjbGU+CiAgPGNpcmNsZSB0cmFuc2Zvcm09InRyYW5zbGF0ZSgzMiAxNikiIGN4PSIwIiBjeT0iMTYiIHI9IjAiPiAKICAgIDxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9InIiIHZhbHVlcz0iMDsgNDsgMDsgMCIgZHVyPSIxLjJzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSIgYmVnaW49IjAuMyIKICAgICAga2V5dGltZXM9IjA7MC4yOzAuNzsxIiBrZXlTcGxpbmVzPSIwLjIgMC4yIDAuNCAwLjg7MC4yIDAuNiAwLjQgMC44OzAuMiAwLjYgMC40IDAuOCIgY2FsY01vZGU9InNwbGluZSIgLz4KICA8L2NpcmNsZT4KICA8Y2lyY2xlIHRyYW5zZm9ybT0idHJhbnNsYXRlKDQ4IDE2KSIgY3g9IjAiIGN5PSIxNiIgcj0iMCI+IAogICAgPGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgdmFsdWVzPSIwOyA0OyAwOyAwIiBkdXI9IjEuMnMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIiBiZWdpbj0iMC42IgogICAgICBrZXl0aW1lcz0iMDswLjI7MC43OzEiIGtleVNwbGluZXM9IjAuMiAwLjIgMC40IDAuODswLjIgMC42IDAuNCAwLjg7MC4yIDAuNiAwLjQgMC44IiBjYWxjTW9kZT0ic3BsaW5lIiAvPgogIDwvY2lyY2xlPgo8L3N2Zz4K") center no-repeat;    background-size: 40%;}'},renderer_partial:{html:'<div class="gm-wrapper">    <div class="gm-video-wrapper">        <video class="gm-video" autoplay preload="none">            Your browser does not support the VIDEO tag        </video>    </div>    <div class="gm-toolbar">        <ul>        </ul>    </div>    <span class="gm-version-number"></span></div>',js:"",css:'.gm-template-renderer_partial {    top: 0;    left: 0;    margin: 0;    padding: 0;    display: block;    min-height: 800px;    height: 100%;    background-color: black;}.gm-template-renderer_partial .gm-wrapper {    top: 0;    left: 0;    margin: 0;    padding: 0;    display: block;    width: 100%;    height: 100%;}.gm-template-renderer_partial .gm-video-wrapper {    position: relative;    top: 0;    left: 0;    margin: 0;    padding: 0;    display: block;    width: 100%;    height: 100%;}.gm-template-renderer_partial .gm-video {    position: relative;    top: 0;    left: 0;    width: calc(95% - 50px);    height: 100%;    padding: 0;    background: transparent url("data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA2NCA2NCIgd2lkdGg9IjY0IiBoZWlnaHQ9IjY0IiBmaWxsPSJ3aGl0ZSI+CiAgPGNpcmNsZSB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxNiAxNikiIGN4PSIwIiBjeT0iMTYiIHI9IjAiPiAKICAgIDxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9InIiIHZhbHVlcz0iMDsgNDsgMDsgMCIgZHVyPSIxLjJzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSIgYmVnaW49IjAiCiAgICAgIGtleXRpbWVzPSIwOzAuMjswLjc7MSIga2V5U3BsaW5lcz0iMC4yIDAuMiAwLjQgMC44OzAuMiAwLjYgMC40IDAuODswLjIgMC42IDAuNCAwLjgiIGNhbGNNb2RlPSJzcGxpbmUiIC8+CiAgPC9jaXJjbGU+CiAgPGNpcmNsZSB0cmFuc2Zvcm09InRyYW5zbGF0ZSgzMiAxNikiIGN4PSIwIiBjeT0iMTYiIHI9IjAiPiAKICAgIDxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9InIiIHZhbHVlcz0iMDsgNDsgMDsgMCIgZHVyPSIxLjJzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSIgYmVnaW49IjAuMyIKICAgICAga2V5dGltZXM9IjA7MC4yOzAuNzsxIiBrZXlTcGxpbmVzPSIwLjIgMC4yIDAuNCAwLjg7MC4yIDAuNiAwLjQgMC44OzAuMiAwLjYgMC40IDAuOCIgY2FsY01vZGU9InNwbGluZSIgLz4KICA8L2NpcmNsZT4KICA8Y2lyY2xlIHRyYW5zZm9ybT0idHJhbnNsYXRlKDQ4IDE2KSIgY3g9IjAiIGN5PSIxNiIgcj0iMCI+IAogICAgPGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iciIgdmFsdWVzPSIwOyA0OyAwOyAwIiBkdXI9IjEuMnMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIiBiZWdpbj0iMC42IgogICAgICBrZXl0aW1lcz0iMDswLjI7MC43OzEiIGtleVNwbGluZXM9IjAuMiAwLjIgMC40IDAuODswLjIgMC42IDAuNCAwLjg7MC4yIDAuNiAwLjQgMC44IiBjYWxjTW9kZT0ic3BsaW5lIiAvPgogIDwvY2lyY2xlPgo8L3N2Zz4K") center no-repeat;    background-size: 40%;}.gm-template-renderer_partial .gm-toolbar {    position: absolute;    top: 10px;    right: 0;    padding-right: 5px;    margin: 0;    width: 50px;}.gm-template-renderer_partial .gm-version-number {    position: fixed;    right: 5px;    bottom: 5px;    z-index: 2;    color: white;}@media only screen and (max-width: 650px)  {    .gm-overlay {        left: auto;        width: calc(100vw - 100px);        right: 55px;        min-height: 0;    }}@media only screen and (min-width: 475px)  {    .gm-click-to-unmute {        left: calc(50% - 190px) !important;    }}'}}}setupRenderer(e,t,i){let c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n;"string"==typeof e&&(e=document.getElementById(e)),void 0===i&&(i={}),(i=s(i,o)).webRTCUrl=t,i.buttons=i.volume||i.rotation||i.navbar||i.power,r.debug("Creating genymotion display on "+t),e.classList.add("device-renderer-instance"),e.classList.add("gm-template-"+i.template),document.body.classList.add("gm-template-"+i.template+"-body"),this.loadTemplate(e,this.templates[i.template],i);const d=new c(e,i);return a(d),this.instances.push(d),this.addPlugins(d),d.onWebRTCReady(),d}loadTemplate(e,t,i){const n=document.getElementsByTagName("head")[0],s="device-renderer-js-"+i.template,a="device-renderer-css-"+i.template;if(!document.getElementById(s)){const e=document.createElement("script");e.id=s,e.text=t.js,n.appendChild(e)}if(!document.getElementById(a)){const e=document.createElement("style");e.id=a,e.appendChild(document.createTextNode(t.css)),n.appendChild(e)}e.innerHTML=t.html}addPlugins(e){const t=[];if("function"==typeof e.addCustomPlugins){const i=e.addCustomPlugins();Array.isArray(i)&&t.push(...i)}const i=[];t.forEach(t=>{const n=t.params||[];t.enabled&&(t.dependencies&&t.dependencies.forEach(t=>{-1===i.indexOf(t.name)&&(new t(e),i.push(t.name))}),new t.class(e,...n))})}}},{"./DeviceRenderer":117,"./store":150,"lodash/defaultsDeep":81,loglevel:99}],119:[function(e,t,i){const n=e("./DeviceRenderer"),s=e("./DeviceRendererFactory"),a=e("./plugins/CoordinateUtils"),r=e("./plugins/KeyboardEvents"),o=e("./plugins/MouseEvents"),c=e("./plugins/MediaManager");t.exports={DeviceRenderer:n,DeviceRendererFactory:s,CoordinateUtils:a,KeyboardEvents:r,MouseEvents:o,MediaManager:c}},{"./DeviceRenderer":117,"./DeviceRendererFactory":118,"./plugins/CoordinateUtils":125,"./plugins/KeyboardEvents":134,"./plugins/MediaManager":135,"./plugins/MouseEvents":136}],120:[function(e,t,i){const n=e("./util/OverlayPlugin");t.exports=class extends n{constructor(e,t,i){super(e),this.instance=e,this.instance.baseband=this,this.i18n=t||{},this.basebandEnabled=i,this.renderToolbarButton(),this.renderWidget(),this.instance.registerEventCallback("baseband",e=>{this.handleBasebandEvent(e)})}handleBasebandEvent(e){const t=e.split(" ");t.length<3||("network"===t[0]&&"operator"===t[1]&&(this.networkOperatorMMC.value=t[2]),"network"===t[0]&&"operator_name"===t[1]&&(this.networkOperatorName.value=t.slice(2).join(" ")),"sim"===t[0]&&"operator"===t[1]&&(this.simOperatorMMC.value=t[2]),"sim"===t[0]&&"operator_name"===t[1]&&(this.simOperatorName.value=t.slice(2).join(" ")),"sim"===t[0]&&"imsi_id"===t[1]&&(this.simMSIN.value=t[2]),"sim"===t[0]&&"phone_number"===t[1]&&(this.simOperatorPhoneNumber.value=t[2]))}renderToolbarButton(){const e=this.instance.getChildByClass(this.instance.root,"gm-toolbar");if(!e)return;const t=e.children[0];this.toolbarBtn=document.createElement("li"),this.toolbarBtnImage=document.createElement("div"),this.toolbarBtnImage.className="gm-icon-button gm-sim-button",this.toolbarBtnImage.title=this.i18n.BASEBAND_TITLE||"Baseband",this.toolbarBtn.appendChild(this.toolbarBtnImage),this.toolbarBtn.onclick=this.toggleWidget.bind(this),t.appendChild(this.toolbarBtn)}renderWidget(){this.widget=document.createElement("div"),this.form=document.createElement("form");const e=document.createElement("div");if(e.className="gm-title",e.innerHTML=this.i18n.BASEBAND_TITLE||"Baseband",this.form.appendChild(e),this.basebandEnabled){this.networkOperator=document.createElement("div");const e=document.createElement("div");e.className="gm-section";const t=document.createElement("label");t.innerHTML=this.i18n.NETWORK_OPERATOR||"Network Operator",e.appendChild(t);const i=document.createElement("div");i.className="gm-fields";const n=document.createElement("label");n.innerHTML="MCC/MNC",this.networkOperatorMMC=document.createElement("input"),this.networkOperatorMMC.className="gm-network-network-mmc",this.networkOperatorMMC.placeholder="eg: 20814",this.networkOperatorMMC.pattern="[0-9]{5,6}",this.networkOperatorMMC.title="Operator MCC/MNC",i.appendChild(n),i.appendChild(this.networkOperatorMMC);const s=document.createElement("div");s.className="gm-fields";const a=document.createElement("label");a.innerHTML="Name",this.networkOperatorName=document.createElement("input"),this.networkOperatorName.className="gm-network-network-name",this.networkOperatorName.placeholder="eg: Verizon",this.networkOperatorName.title="Operator Name",s.appendChild(a),s.appendChild(this.networkOperatorName),this.networkOperator.appendChild(e),this.networkOperator.appendChild(i),this.networkOperator.appendChild(s),this.simOperator=document.createElement("div");const r=document.createElement("div");r.className="gm-section";const o=document.createElement("label");o.innerHTML=this.i18n.NETWORK_SIM_OPERATOR||"SIM Operator",r.appendChild(o);const c=document.createElement("div");c.className="gm-fields";const d=document.createElement("label");d.innerHTML="MCC/MNC",this.simOperatorMMC=document.createElement("input"),this.simOperatorMMC.className="gm-network-sim-mmc",this.simOperatorMMC.placeholder="eg: 20814",this.simOperatorMMC.pattern="[0-9]{5,6}",this.simOperatorMMC.title="SIM Operator MCC/MNC",this.instance.addListener(this.simOperatorMMC,"keyup",this.checkSimImsiErrors.bind(this)),c.appendChild(d),c.appendChild(this.simOperatorMMC);const l=document.createElement("div");l.className="gm-fields";const h=document.createElement("label");h.innerHTML="Name",this.simOperatorName=document.createElement("input"),this.simOperatorName.className="gm-network-sim-name",this.simOperatorName.placeholder="eg: AT&T",this.simOperatorName.title="SIM Operator Name",l.appendChild(h),l.appendChild(this.simOperatorName);const p=document.createElement("div");p.className="gm-fields";const u=document.createElement("label");u.innerHTML="MSIN",this.simMSIN=document.createElement("input"),this.simMSIN.className="gm-network-sim-msin",this.simMSIN.placeholder="eg: 2176510739",this.simMSIN.pattern="[0-9]{9,10}",this.simMSIN.title="SIM MSIN",this.instance.addListener(this.simMSIN,"keyup",this.checkSimImsiErrors.bind(this)),p.appendChild(u),p.appendChild(this.simMSIN);const m=document.createElement("div");m.className="gm-fields";const g=document.createElement("label");g.innerHTML="Phone Number",this.simOperatorPhoneNumber=document.createElement("input"),this.simOperatorPhoneNumber.className="gm-network-sim-phone",this.simOperatorPhoneNumber.placeholder="eg: 8004337300",this.simOperatorPhoneNumber.pattern="[0-9]*",this.simOperatorPhoneNumber.title="Phone Number",m.appendChild(g),m.appendChild(this.simOperatorPhoneNumber),this.simOperator.appendChild(r),this.simOperator.appendChild(c),this.simOperator.appendChild(p),this.simOperator.appendChild(l),this.simOperator.appendChild(m)}this.submitBtn=document.createElement("button"),this.submitBtn.className="gm-network-update",this.submitBtn.innerHTML=this.i18n.NETWORK_UPDATE||"Update",this.submitBtn.onclick=this.sendDataToInstance.bind(this),this.basebandEnabled&&(this.form.appendChild(this.networkOperator),this.form.appendChild(this.simOperator)),this.form.appendChild(this.submitBtn),this.widget.className="gm-overlay gm-baseband-plugin gm-hidden";const t=document.createElement("div");t.className="gm-close-btn",t.onclick=this.toggleWidget.bind(this),this.widget.appendChild(t),this.widget.appendChild(this.form),this.overlays.push(this.widget),this.instance.root.appendChild(this.widget)}toggleWidget(){this.widget.classList.contains("gm-hidden")?(this.instance.emit("close-overlays"),this.instance.emit("keyboard-disable")):this.instance.emit("keyboard-enable"),this.widget.classList.toggle("gm-hidden"),this.toolbarBtnImage.classList.toggle("gm-active")}checkSimImsiErrors(){this.simMSIN.setCustomValidity(""),this.simOperatorMMC.value.length>0&&this.simMSIN.value.length>0&&(6===this.simOperatorMMC.value.length&&9!==this.simMSIN.value.length?this.simMSIN.setCustomValidity("Should be 9"):5===this.simOperatorMMC.value.length&&10!==this.simMSIN.value.length&&this.simMSIN.setCustomValidity("Should be 10"))}sendDataToInstance(e){if(e.preventDefault(),!this.form.checkValidity())return;const t=[];if(this.basebandEnabled&&(this.networkOperatorMMC.value&&t.push("network operator "+this.networkOperatorMMC.value),this.networkOperatorName.value&&t.push("network operator_name "+this.networkOperatorName.value),this.simOperatorMMC.value&&t.push("sim operator "+this.simOperatorMMC.value),this.simOperatorName.value&&t.push("sim operator_name "+this.simOperatorName.value),this.simMSIN.value&&t.push("sim imsi_id "+this.simMSIN.value),this.simOperatorPhoneNumber.value&&t.push("sim phone_number "+this.simOperatorPhoneNumber.value),t.length>0)){const e={channel:"baseband",messages:t};this.instance.sendEvent(e)}this.toggleWidget()}}},{"./util/OverlayPlugin":144}],121:[function(e,t,i){const n=e("./util/OverlayPlugin");t.exports=class extends n{constructor(e,t){super(e),this.instance=e,this.i18n=t||{},this.instance.battery=this,this.instance.registerEventCallback("BATTERY_STATUS",e=>{this.updateUIBatteryChargingState("false"!==e)}),this.renderToolbarButton(),this.renderWidget(),this.instance.registerEventCallback("BATTERY_LEVEL",this.onBatteryLevelChange.bind(this)),this.instance.registerEventCallback("battery",e=>{const t=e.split(" ").splice(-2);2===t.length&&(this.updateUIBatteryChargingState("discharging"!==t[0]),this.onBatteryLevelChange(t[1]))})}renderToolbarButton(){const e=this.instance.getChildByClass(this.instance.root,"gm-toolbar");if(!e)return;const t=e.children[0];this.toolbarBtn=document.createElement("li"),this.toolbarBtnImage=document.createElement("div"),this.toolbarBtnImage.className="gm-icon-button gm-battery-button",this.toolbarBtnImage.title=this.i18n.BATTERY_TITLE||"Battery",this.toolbarBtn.appendChild(this.toolbarBtnImage),this.toolbarBtn.onclick=this.toggleWidget.bind(this),t.appendChild(this.toolbarBtn)}renderWidget(){this.widget=document.createElement("div"),this.container=document.createElement("div");const e=document.createElement("div");e.className="gm-title",e.innerHTML=this.i18n.BATTERY_TITLE||"Battery",this.container.appendChild(e);const t=document.createElement("div");t.className="gm-inputs";const i=this.i18n.BATTERY_CHARGE_LEVEL||"Charge level";t.innerHTML="<label>"+i+"</label>",t.appendChild(this.createLevelSection());const n=document.createElement("label");n.innerHTML=this.i18n.BATTERY_CHARGE_STATE||"State of charge",t.appendChild(n),t.appendChild(this.createChargingSection()),this.container.appendChild(t),this.widget.className="gm-overlay gm-battery-plugin gm-hidden";const s=document.createElement("div");s.onclick=this.toggleWidget.bind(this),s.className="gm-close-btn",this.widget.appendChild(s),this.widget.appendChild(this.container),this.overlays.push(this.widget),this.instance.root.appendChild(this.widget)}createChargingSection(){const e=document.createElement("div");return this.chargingInput=document.createElement("input"),this.chargingStatus=document.createElement("div"),e.className="gm-charging-group",this.chargingInput.type="checkbox",this.chargingInput.className="gm-charging-checkbox",this.chargingInput.onchange=this.toggleChargingState.bind(this),this.chargingInput.checked=!0,this.chargingStatus.className="gm-charging-status",this.chargingStatus.innerHTML="Discharging",e.appendChild(this.chargingInput),e.appendChild(this.chargingStatus),e}createLevelSection(){const e=document.createElement("div");e.className="gm-charge-level-group";const t=document.createElement("div");this.chargeInput=document.createElement("input");const i=document.createElement("span");i.innerHTML="%",this.chargeInput.className="gm-charge-input",this.chargeInput.type="number",this.chargeInput.value=50,this.chargeInput.max=100,this.chargeInput.min=0,this.chargeInput.step=1,this.chargeInput.oninput=this.onBatteryLevelChangeEvent.bind(this),t.appendChild(this.chargeInput),t.appendChild(i),e.appendChild(t);const n=document.createElement("div");this.chargeSlider=document.createElement("input"),this.chargeSlider.className="gm-charge-slider",this.chargeSlider.type="range",this.chargeSlider.orient="vertical",this.chargeSlider.max=100,this.chargeSlider.min=0,this.chargeSlider.step=1,this.chargeSlider.value=50,this.chargeSlider.onchange=this.onBatteryLevelChangeEvent.bind(this),n.appendChild(this.chargeSlider),e.appendChild(n);const s=document.createElement("div");return this.chargeImage=document.createElement("div"),this.chargeImageOverlay=document.createElement("div"),this.chargeImage.className="gm-charge-image",this.chargeImageOverlay.className="gm-charge-image-overlay",this.chargeImageOverlay.style.cssText="height: 40%;",s.appendChild(this.chargeImage),this.chargeImage.appendChild(this.chargeImageOverlay),e.appendChild(s),e}toggleWidget(){this.widget.classList.contains("gm-hidden")?(this.instance.emit("close-overlays"),this.instance.emit("keyboard-disable")):this.instance.emit("keyboard-enable"),this.widget.classList.toggle("gm-hidden"),this.toolbarBtnImage.classList.toggle("gm-active")}toggleChargingState(){this.chargingStatus.classList.toggle("charging");const e=this.i18n.BATTERY_CHARGING||"Charging",t=this.i18n.BATTERY_DISCHARGING||"Discharging";this.chargingStatus.innerHTML=this.chargingInput.checked?e:t,this.sendDataToInstance()}updateUIBatteryChargingState(e){this.chargingInput.checked=e,this.chargingStatus.classList[e?"add":"remove"]("charging");const t=this.i18n.BATTERY_CHARGING||"Charging",i=this.i18n.BATTERY_DISCHARGING||"Discharging";this.chargingStatus.innerHTML=e?t:i}onBatteryLevelChangeEvent(e){const t=Number(e.target.value);this.onBatteryLevelChange(t)&&this.sendDataToInstance()}onBatteryLevelChange(e){return e=Number(e),!Number.isNaN(e)&&(e=Math.min(Math.max(0,e),100),this.chargeSlider.value=e,this.chargeInput.value=e,this.chargeImageOverlay.style.cssText="height: "+(.7*e+4)+"%;",!0)}sendDataToInstance(){const e={channel:"battery",messages:["set state level "+Number(this.chargeInput.value),"set state status "+(this.chargingInput.checked?"charging":"discharging")]};this.instance.sendEvent(e)}}},{"./util/OverlayPlugin":144}],122:[function(e,t,i){t.exports=class{constructor(e,t,i){this.instance=e,this.translateHomeKey=i,this.instance.buttonsEvents=this,this.instance.options.rotation&&this.renderToolbarButton("gm-rotation","gm-rotate",t.BUTTONS_ROTATE||"Rotate",!1),this.instance.options.volume&&(this.renderToolbarButton("0x01000070","gm-sound-down",t.BUTTONS_SOUND_DOWN||"Sound down",!1),this.renderToolbarButton("0x01000072","gm-sound-up",t.BUTTONS_SOUND_UP||"Sound up",!1)),this.instance.options.navbar&&(this.renderToolbarButton("0x010000be","gm-recent",t.BUTTONS_RECENT_APPS||"Recent applications",!0),this.renderToolbarButton("0x01000010","gm-home",t.BUTTONS_HOME||"Home",!0),this.renderToolbarButton("0x01000061","gm-back",t.BUTTONS_BACK||"Back",!0)),this.instance.options.power&&this.renderToolbarButton("0x0100010b","gm-power",t.BUTTONS_POWER||"Power",!0);const n=document.getElementsByClassName("gm-icon-button");for(let e=0;e<n.length;e++){const t=n[e];t.onmousedown=this.mouseButtonPressEvent.bind(this),t.onmouseup=this.mouseButtonReleaseEvent.bind(this)}}keyPressEvent(e,t){const i={type:"KEYBOARD_PRESS",keychar:t,keycode:e};this.instance.sendEvent(i)}keyReleaseEvent(e,t){const i={type:"KEYBOARD_RELEASE",keychar:t,keycode:e};this.instance.sendEvent(i)}mouseButtonPressEvent(e){const t=e.target.classList[1];if(t)if("0x01000010"===t&&this.translateHomeKey)this.keyPressEvent(parseInt("0x01000022"),""),this.keyPressEvent(parseInt("0x01000005"),"");else if("0x"===t.substring(0,2)){const e=parseInt(t,16);this.keyPressEvent(e,"0\n")}}mouseButtonReleaseEvent(e){const t=e.target.classList[1];if(t)if("0x01000010"===t&&this.translateHomeKey)this.keyReleaseEvent(parseInt("0x01000005"),""),this.keyReleaseEvent(parseInt("0x01000022"),"");else if("gm-rotation"===t){const e={type:"ROTATE"};this.instance.sendEvent(e)}else if("0x"===t.substring(0,2)){const e=parseInt(t,16);this.keyReleaseEvent(e,"0\n")}}getButtonState(e){const t=this.instance.getChildByClass(this.instance.root,e),i=t.parentNode;return{image:{className:t.className},button:{className:i.className,onclick:i.onclick}}}setButtonState(e,t){const i=this.instance.getChildByClass(this.instance.root,e),n=i.parentNode;i.className=t.image.className,n.className=t.button.className,n.onclick=t.button.onclick}disableRotation(){if(!this.instance.getChildByClass(this.instance.root,"gm-rotate"))return;this.savedRotationState||(this.savedRotationState=this.getButtonState("gm-rotate"));const e=this.instance.getChildByClass(this.instance.root,"gm-rotate"),t=e.parentNode;t.className+=" gm-disabled-widget-pop-up",e.className+=" gm-disabled-widget-icon",t.onclick=null}enableRotation(){this.instance.getChildByClass(this.instance.root,"gm-rotate")&&this.savedRotationState&&(this.setButtonState("gm-rotate",this.savedRotationState),this.savedRotationState=null)}renderToolbarButton(e,t,i,n){const s=this.instance.getChildByClass(this.instance.root,"gm-toolbar");if(!s)return;const a=s.children[0],r=document.createElement("li"),o=document.createElement("div");o.classList.add("gm-icon-button"),o.classList.add(e),o.classList.add(t),o.title=i,r.appendChild(o),n?a.appendChild(r):a.insertBefore(r,a.firstChild)}}},{}],123:[function(e,t,i){const n=e("webrtc-adapter"),s=e("./util/OverlayPlugin");e("loglevel").setDefaultLevel("debug"),t.exports=class extends s{constructor(e,t){super(e),this.instance=e,this.i18n=t||{},this.instance.camera=this,this.renderToolbarButton()}renderToolbarButton(){const e=this.instance.getChildByClass(this.instance.root,"gm-toolbar");if(!e)return;const t=e.children[0];if(this.toolbarBtn=document.createElement("li"),this.toolbarBtnImage=document.createElement("div"),this.instance.options.microphone?(this.toolbarBtnImage.className="gm-icon-button gm-camera-mic-button",this.toolbarBtnImage.title=this.i18n.CAMERA_TITLE||"Camera and microphone injection"):(this.toolbarBtnImage.className="gm-icon-button gm-camera-button",this.toolbarBtnImage.title=this.i18n.CAMERA_TITLE||"Camera injection"),this.toolbarBtn.appendChild(this.toolbarBtnImage),t.appendChild(this.toolbarBtn),"safari"===n.default.browserDetails.browser)this.toolbarBtn.className+=" gm-disabled-widget-pop-up",this.toolbarBtnImage.className+=" gm-disabled-widget-icon";else{const e=()=>this.instance.mediaManager.toggleVideoStreaming();this.instance.addListener(this.toolbarBtn,"click",e)}}}},{"./util/OverlayPlugin":144,loglevel:99,"webrtc-adapter":102}],124:[function(e,t,i){const n=e("./util/OverlayPlugin"),s=e("loglevel");s.setDefaultLevel("debug"),t.exports=class extends n{constructor(e,t){super(e),this.instance=e,this.i18n=t||{},this.instance.clipboard=this,this.clipboard="",this.renderToolbarButton(),this.renderWidget(),this.instance.registerEventCallback("framework",e=>{const t=e.split(" ");if(3===t.length&&"clipboard"===t[0])try{this.clipboard=decodeURIComponent(escape(window.atob(t[2])))}catch(e){s.warn("Malformed clipboard content")}}),this.instance.registerEventCallback("CLIPBOARD",e=>{this.clipboard=e})}renderToolbarButton(){const e=this.instance.getChildByClass(this.instance.root,"gm-toolbar");if(!e)return;const t=e.children[0];this.toolbarBtn=document.createElement("li"),this.toolbarBtnImage=document.createElement("div"),this.toolbarBtnImage.className="gm-icon-button gm-clipboard-button",this.toolbarBtnImage.title=this.i18n.CLIPBOARD_TITLE||"Clipboard",this.toolbarBtn.appendChild(this.toolbarBtnImage),this.toolbarBtn.onclick=this.toggleWidget.bind(this),t.appendChild(this.toolbarBtn)}renderWidget(){this.widget=document.createElement("div"),this.container=document.createElement("div");const e=document.createElement("div");e.className="gm-title",e.innerHTML=this.i18n.CLIPBOARD_TITLE||"Device Clipboard",this.container.appendChild(e),this.clipboardInput=document.createElement("textarea"),this.clipboardInput.className="gm-clipboard-input",this.container.appendChild(this.clipboardInput),this.widget.className="gm-overlay gm-clipboard-plugin gm-hidden";const t=document.createElement("div");t.className="gm-close-btn",t.onclick=this.toggleWidget.bind(this),this.widget.appendChild(t),this.widget.appendChild(this.container),this.widget.onclose=()=>{this.clipboard=this.clipboardInput.value,this.sendDataToInstance()},this.overlays.push(this.widget),this.instance.root.appendChild(this.widget)}toggleWidget(){this.widget.classList.contains("gm-hidden")?(this.instance.emit("close-overlays"),this.instance.emit("keyboard-disable"),this.clipboardInput.value=this.clipboard):(this.instance.emit("keyboard-enable"),this.widget.onclose()),this.widget.classList.toggle("gm-hidden"),this.toolbarBtnImage.classList.toggle("gm-active")}copyInstanceClipboardToClient(e,t){try{navigator.clipboard.writeText(this.clipboardInput.value)}catch(t){e.focus(),e.select(),document.execCommand("copy")}t.classList.remove("gm-invisible"),t.classList.remove("gm-hidden"),setTimeout(()=>{t.classList.add("gm-invisible"),setTimeout(()=>{t.classList.add("gm-hidden")},500)},2e3)}sendDataToInstance(){const e={channel:"framework",messages:["set_device_clipboard "+window.btoa(unescape(encodeURIComponent(this.clipboard)))]};this.instance.sendEvent(e)}}},{"./util/OverlayPlugin":144,loglevel:99}],125:[function(e,t,i){t.exports=class{constructor(e){this.instance=e,this.instance.coordinateUtils=this,this.video=this.instance.video}setVideoElement(){this.video=this.instance.video}hasLeftAndRightBorders(){return this.video.offsetWidth/this.video.offsetHeight>this.video.videoWidth/this.video.videoHeight}hasSameOrientation(){return this.video.videoWidth/this.video.videoHeight>1&&this.video.offsetWidth/this.video.offsetHeight>1||this.video.videoWidth/this.video.videoHeight<1&&this.video.offsetWidth/this.video.offsetHeight<1}getCumulativeOffset(e){let t=0,i=0;do{t+=e.offsetTop||0,i+=e.offsetLeft||0,e=e.offsetParent}while(e);return{top:t,left:i}}getRawXCoordinateFromEvent(e){return void 0!==e.pageX?void 0!==e.offsetX?e.offsetX:e.pageX-this.getCumulativeOffset(this.video).left:e.clientX-this.getCumulativeOffset(this.video).left}getRawYCoordinateFromEvent(e){return void 0!==e.pageY?void 0!==e.offsetY?e.offsetY:e.pageY-this.getCumulativeOffset(this.video).top:e.clientY-this.getCumulativeOffset(this.video).top}getXCoordinate(e){this.instance.root.focus(),this.setVideoElement();const t=this.getRawXCoordinateFromEvent(e)-this.getLeftBorder();return Math.round(t*this.getXRatio())}getYCoordinate(e){this.setVideoElement();const t=this.getRawYCoordinateFromEvent(e)-this.getTopBorder();return Math.round(t*this.getYRatio())}getXRatio(){let e;if(this.hasSameOrientation())return this.hasLeftAndRightBorders()?(e=this.video.videoWidth/this.video.videoHeight*this.video.offsetHeight,this.video.videoWidth/e):this.video.videoWidth/this.video.offsetWidth;if(this.hasLeftAndRightBorders())return e=this.video.videoWidth/this.video.videoHeight*this.video.offsetHeight,this.video.videoWidth/e;const t=this.video.videoHeight/this.video.videoWidth*this.video.offsetWidth;return this.video.videoHeight/t}getYRatio(){let e,t;return this.hasSameOrientation()?this.hasLeftAndRightBorders()?this.video.videoHeight/this.video.offsetHeight:(t=this.video.videoHeight/this.video.videoWidth*this.video.offsetWidth,this.video.videoHeight/t):this.hasLeftAndRightBorders()?(e=this.video.videoWidth/this.video.videoHeight*this.video.offsetHeight,this.video.videoWidth/e):(t=this.video.videoHeight/this.video.videoWidth*this.video.offsetWidth,this.video.videoHeight/t)}getTopBorder(){if(this.setVideoElement(),this.hasLeftAndRightBorders())return 0;const e=this.video.videoHeight/this.video.videoWidth*this.video.offsetWidth;return(this.video.offsetHeight-e)/2}getLeftBorder(){if(this.setVideoElement(),!this.hasLeftAndRightBorders())return 0;const e=this.video.videoWidth/this.video.videoHeight*this.video.offsetHeight;return(this.video.offsetWidth-e)/2}}},{}],126:[function(e,t,i){const n=e("./util/OverlayPlugin"),s=2*Math.PI,a=Math.PI/2;t.exports=class extends n{constructor(t,i){if(super(t),this.instance=t,this.i18n=i||{},this.instance.fileUpload=this,this.root=this.instance.videoWrapper,this.stepper={},this.currentStep="homeScreen",this.isUploading=!1,this.hasError=!1,this.flashing=!1,this.canvasContext=null,this.opengappsInstalled=!1,this.capabilityAvailable=!1,window.Worker){let t=e("../worker/FileUploaderWorker");t=t.toString().match(/^\s*function\s*\(\s*\)\s*\{(([\s\S](?!\}$))*[\s\S])/)[1];const i=new Blob([t],{type:"application/javascript"});this.loaderWorker=new Worker(URL.createObjectURL(i)),this.loaderWorker.onmessage=e=>{const t=e.data;switch(t.code){case"SUCCESS":this.onUploadSuccess();break;case"FAIL":this.onUploadFailure();break;case"PROGRESS":this.setUploadProgress(t.value)}}}this.root.ondragenter=e=>{e.stopPropagation(),e.preventDefault()},this.root.ondragover=e=>{e.stopPropagation(),e.preventDefault()},this.root.ondragleave=e=>{e.stopPropagation(),e.preventDefault()},this.root.ondrop=e=>{e.stopPropagation(),e.preventDefault(),this.isUploading||this.upload(e.dataTransfer.files)},this.createStepper(),this.renderToolbarButton(),this.renderWidget(),this.instance.registerEventCallback("SYSTEM_PATCHER_STATUS",this.onSystemPatcherStatusEvent.bind(this)),this.instance.registerEventCallback("SYSTEM_PATCHER_LAST_RESULT",this.onSystemPatcherLastResultEvent.bind(this)),this.instance.registerEventCallback("systempatcher",e=>{const t=e.split(/ (.+)/);"status"===t[0]?this.onSystemPatcherStatusEvent(t[1]):"last_result"===t[0]&&this.onSystemPatcherLastResultEvent(t[1])})}renderToolbarButton(){const e=this.instance.getChildByClass(this.instance.root,"gm-toolbar");if(!e)return;const t=e.children[0],i=document.createElement("li");this.toolbarBtnImage=document.createElement("div"),this.toolbarBtnImage.className="gm-icon-button gm-uploader-button",this.toolbarBtnImage.title=this.i18n.UPLOADER_TITLE||"File upload",i.appendChild(this.toolbarBtnImage),i.onclick=this.toggleWidget.bind(this),t.appendChild(i)}renderWidget(){this.widget=document.createElement("div"),this.container=document.createElement("div"),this.title=document.createElement("div"),this.title.className="gm-upload-title",this.container.appendChild(this.title),this.inputs=document.createElement("div"),this.inputs.className="gm-uploader-content",this.container.appendChild(this.inputs),this.widget.className="gm-overlay gm-uploader-plugin gm-hidden";const e=document.createElement("div");e.className="gm-close-btn",e.onclick=this.toggleWidget.bind(this),this.widget.appendChild(e),this.widget.appendChild(this.container),this.overlays.push(this.widget),this.instance.root.appendChild(this.widget)}toggleWidget(){if(this.widget.classList.contains("gm-hidden")){if(this.instance.emit("close-overlays"),this.instance.emit("keyboard-disable"),this.displayStep(this.currentStep),"uploadScreen"===this.currentStep){const e={channel:"systempatcher",messages:["notify status"]};this.instance.sendEvent(e)}}else"successScreen"!==this.currentStep&&"errorScreen"!==this.currentStep||(this.currentStep="homeScreen"),this.instance.emit("keyboard-enable");this.widget.classList.toggle("gm-hidden"),this.toolbarBtnImage.classList.toggle("gm-active")}upload(e){if(e.length<=0)return;this.createUploadProgressCanvas(),this.setUploadProgress(0);const t={type:"upload",file:e[0]};this.loaderWorker.postMessage(t),this.isUploading=!0,this.hasError=!1}onUploadSuccess(){this.isUploading=!1,this.canvasContext.putImageData(this.canvasImageData,0,0),this.canvasContext.fillText("✓",30,80),this.canvasContext.stroke(),setTimeout(()=>{this.canvasContext.putImageData(this.canvasImageData,0,0)},750)}onUploadFailure(){this.isUploading=!1,this.hasError=!0}setUploadProgress(e,t){this.hasError||this.drawProgress(e,t)}onSystemPatcherStatusEvent(e){const t=document.getElementsByClassName("gm-upload-in-progress-txt-percent")[0],i=document.getElementsByClassName("gm-upload-in-progress-txt-progress")[0],n=document.getElementsByClassName("gm-upload-in-progress-percent")[0],s=e.split(" ");if("downloading"===s[0]&&s.length>=3&&t&&i&&n){const e=parseInt(s[1]),a=parseInt(s[2]);if(0===a||Number.isNaN(a))return;const r=Math.round(100*e/a);t.innerHTML=r+"%",n.style.width=r+"%";const o=1048576,c="Downloading "+Math.round(10*e/o)/10+" Mb/"+Math.round(10*a/o)/10+" Mb";i.innerHTML=c}else if("installing"===s[0]&&i)i.innerHTML=this.i18n.UPLOADER_INSTALLING||"Installing...";else if("ready"===s[0]&&s.length>=2){if(-1!==s[1].indexOf("opengapps")&&this.updateOpenGAppsStatus(!0),!this.flashing)return;const e={channel:"systempatcher",messages:["notify last_result"]};this.instance.sendEvent(e)}}onSystemPatcherLastResultEvent(e){switch(e){case"success":this.displayStep("successScreen"),this.flashing&&this.widget.classList.contains("gm-hidden")&&this.toggleWidget(),this.flashing=!1;break;case"unavailable":case"network_error":case"corrupted_archive":case"install_error":this.displayStep("errorScreen"),this.flashing&&this.widget.classList.contains("gm-hidden")&&this.toggleWidget(),this.flashing=!1}}createUploadProgressCanvas(){if(this.canvasContext)return;const e=document.createElement("canvas");e.classList.add("gm-upload-progress"),e.width=120,e.height=120,this.instance.wrapper.insertBefore(e,this.instance.wrapper.firstChild),this.canvasContext=e.getContext("2d"),this.canvasImageData=null,this.canvasContext.beginPath(),this.canvasContext.strokeStyle="#E6195E",this.canvasContext.fillStyle="#E6195E",this.canvasContext.lineCap="square",this.canvasContext.font="bold 60px Arial",this.canvasContext.lineWidth=10,this.canvasContext.closePath(),this.canvasContext.fill(),this.canvasImageData=this.canvasContext.getImageData(0,0,120,120)}drawProgress(e,t){t=void 0!==t?t:"#E6195E",this.canvasContext.strokeStyle=t,this.canvasContext.fillStyle=t,this.canvasContext.putImageData(this.canvasImageData,0,0),this.canvasContext.beginPath(),this.canvasContext.arc(60,60,55,-a,s*e-a,!1);const i=100!==(e=Math.round(100*e))?e:"99";this.canvasContext.fillText(i,25,80),this.canvasContext.stroke()}createStepper(){this.stepper.homeScreen=this.createHomeScreen.bind(this),this.stepper.disclaimerScreen=this.createDisclaimerScreen.bind(this),this.stepper.uploadScreen=this.createUploadScreen.bind(this),this.stepper.successScreen=this.createSuccessStep.bind(this),this.stepper.errorScreen=this.createErrorStep.bind(this)}displayStep(e){this.currentStep=e,this.inputs.innerHTML="";const t=this.stepper[e]();this.title.innerHTML=t.title,this.inputs.appendChild(t.body)}setAvailability(e){this.capabilityAvailable=e}createHomeScreen(){const e=document.createElement("div"),t=document.createElement("div");t.className="gm-upload-main",t.appendChild(this.createIconDiv("gm-upload-main-img")),t.appendChild(this.createTextDiv("gm-upload-main-txt","<p>You can install Open GApps, or upload a file: APK files will be installed, flashable archives will be flashed, and other files types will be pushed to the /sdcard/download folder on the device.</p>")),e.appendChild(t),this.uploader=document.createElement("input"),this.uploader.className="gm-uploader-file",this.uploader.type="file",this.uploader.setAttribute("gm-hidden",""),e.appendChild(this.uploader),this.uploader.onchange=()=>{this.isUploading||(this.toggleWidget(),this.upload(this.uploader.files))};const i=document.createElement("div");i.className="gm-upload-main-bottom-buttons";const n=this.createButtonsGroup("Install Open GApps",e=>{e.preventDefault(),!1===this.opengappsInstalled&&this.capabilityAvailable&&this.displayStep("disclaimerScreen")},"Browse",e=>{e.preventDefault(),this.uploader.click()});return this.installButton=n[0],this.updateOpenGAppsStatus(this.opengappsInstalled),i.appendChild(n[0]),i.appendChild(n[1]),e.appendChild(i),{body:e,title:this.i18n.UPLOADER_HOME_TITLE||"Upload file to the virtual device"}}updateOpenGAppsStatus(e){if(this.opengappsInstalled=e,this.installButton)return this.capabilityAvailable?void(e?(this.installButton.className="gm-upload-main-bottom-buttons-left gm-dont-close gm-uploader-install-opengapps gm-upload-main-bottom-buttons-disabled",this.installButton.innerHTML="Open GApps installed",this.installButton.title="Open GApps are already installed"):(this.installButton.className="gm-upload-main-bottom-buttons-left gm-dont-close gm-uploader-install-opengapps",this.installButton.innerHTML="Install Open GApps",this.installButton.title="Install Open GApps")):(this.installButton.className="gm-upload-main-bottom-buttons-left gm-dont-close gm-uploader-install-opengapps gm-upload-main-bottom-buttons-disabled",this.installButton.innerHTML="Install Open GApps",void(this.installButton.title="Open GApps are not available for this virtual device"))}createDisclaimerScreen(){const e=document.createElement("div"),t=document.createElement("div");t.className="gm-upload-disclaimer",t.appendChild(this.createTextDiv("gm-upload-disclaimer-txt","<p>PLEASE NOTE<br/>        GENYMOBILE INC., ASSUMES NO LIABILITY WHATSOEVER RESULTING FROM THE DOWNLOAD,        INSTALL AND USE OF GOOGLE PLAY SERVICES WITHIN YOUR VIRTUAL DEVICES. YOU ARE        SOLELY RESPONSIBLE FOR THE USE AND ASSUME ALL LIABILITY RELATED THERETO.        MOREOVER        <br/><br/>        GENYMOBILE INC. DISCLAIMS ANY WARRANTIES OF ANY KIND, EITHER EXPRESS OR IMPLIED,        INCLUDING, WITHOUT LIMITATION, IMPLIED WARRANTIES OF MERCHANTABILITY, OR FITNESS        FOR A PARTICULAR PURPOSE REGARDING THE COMPATIBILITY OF THE OPENGAPPS PACKAGES        WITH ANY VERSION OF GENYMOTION. IN NO EVENT SHALL GENYMOBILE INC. OR ITS AFFILIATES,        OR THEIR RESPECTIVE OFFICERS, DIRECTORS, EMPLOYEES, OR AGENTS BE LIABLE WITH RESPECT        TO YOUR DOWNLOAD OR USE OF THE GOOGLE PLAY SERVICES AND YOU RELEASE GENYMOBILE INC.        FROM ANY LIABILITY RELATED THERETO. YOU AGREE TO DEFEND, INDEMNIFY AND HOLD HARMLESS        GENYMOBILE INC. FOR ANY CLAIMS OR COSTS RELATED TO YOUR USE OR DOWNLOAD OF THE GOOGLE        PLAY SERVICES.            </p>")),e.appendChild(t);const i=document.createElement("div");i.className="gm-upload-main-bottom-buttons";const n=this.createButtonsGroup("Back",e=>{e.preventDefault(),this.flashing=!1,this.displayStep("homeScreen")},"Install",e=>{e.preventDefault(),this.flashing=!0;this.instance.sendEvent({channel:"systempatcher",messages:["install opengapps"]}),this.displayStep("uploadScreen")});return i.appendChild(n[0]),i.appendChild(n[1]),e.appendChild(i),{body:e,title:this.i18n.UPLOADER_DISCLAIMER||"You are about to install Open GApps on your virtual device"}}createUploadScreen(){const e=document.createElement("div"),t=document.createElement("div");t.className="gm-upload-in-progress";const i=this.createTextDiv("gm-upload-in-progress-txt-progress",""),n=this.createTextDiv("gm-upload-in-progress-txt-percent",""),s=this.createTextDiv("gm-upload-in-progress-bg-percent",""),a=this.createTextDiv("gm-upload-in-progress-percent","");a.style.width="0%",s.appendChild(a),t.appendChild(i),t.appendChild(n),t.appendChild(s),e.appendChild(t);const r=document.createElement("div");r.className="gm-upload-main-bottom-buttons";const o=this.createButtonsGroup(null,null,"Cancel",e=>{e.preventDefault();this.instance.sendEvent({channel:"systempatcher",messages:["cancel"]}),this.displayStep("disclaimerScreen")});return r.appendChild(o[1]),e.appendChild(r),{body:e,title:this.i18n.UPLOADER_INPROGRESS||"Downloading"}}createSuccessStep(){const e=document.createElement("div"),t=document.createElement("div");return t.className="gm-upload-success",t.appendChild(this.createIconDiv("gm-upload-success-img")),t.appendChild(this.createTextDiv("gm-upload-success-caption","Congratulation!")),t.appendChild(this.createTextDiv("gm-upload-success-txt","<p>Open GApps have been successfully             installed on the virtual device.<br/>Please restart the virtual device to complete the installation.<br/>            You will be redirected to the Open GApps website.</p>")),t.appendChild(this.createButton("gm-upload-success-button","Reboot device",e=>{e.preventDefault();this.instance.sendEvent({channel:"systempatcher",messages:["reboot"]}),this.toggleWidget()})),e.appendChild(t),{body:e,title:this.i18n.UPLOADER_SUCCESS||"Open GApps successfully installed"}}createErrorStep(){const e=document.createElement("div"),t=document.createElement("div");return t.className="gm-upload-error",t.appendChild(this.createIconDiv("gm-upload-error-img")),t.appendChild(this.createTextDiv("gm-upload-error-caption","Failed to install Open GApps")),e.appendChild(t),{body:e,title:this.i18n.UPLOADER_FAILURE||"We've got a problem…"}}createButtonsGroup(e,t,i,n){const s=[null,null];return e&&(s[0]=this.createButton("gm-upload-main-bottom-buttons-left gm-dont-close",e,t)),i&&(s[1]=this.createButton("gm-upload-main-bottom-buttons-right gm-dont-close",i,n)),s}createButton(e,t,i){const n=document.createElement("div");return n.className=e,n.innerHTML=t,n.onclick=i,n}createIconDiv(e){const t=document.createElement("span");return t.className="gm-upload-icon "+e,t}createTextDiv(e,t){const i=document.createElement("div");return i.className=e,i.innerHTML=t,i}}},{"../worker/FileUploaderWorker":152,"./util/OverlayPlugin":144}],127:[function(e,t,i){const n=e("./util/OverlayPlugin"),{switchButton:s}=e("./util/components");e("loglevel").setDefaultLevel("debug");const a={SCAN_RECOGNIZED:"scan recognized",SCAN_UNRECOGNIZED:"scan unrecognized",SCAN_DIRTY:"scan dirty",SCAN_TOO_FAST:"scan too_fast",SCAN_PARTIAL:"scan partial",SCAN_INSUFFICIENT:"scan insufficient",SET_AUTO_RECOGNIZE_FALSE:"set auto_recognize false",SET_AUTO_RECOGNIZE_TRUE:"set auto_recognize true",NOTIFY_ALL:"notify all"},r={SCAN_ERROR:"scan error",SCAN_ERROR_TIMEOUT:"scan error timeout",SCAN_ERROR_CANCELED:"scan error canceled",CURRENT_STATUS_IDLE:"current_status idle",CURRENT_STATUS_SCANNING:"current_status scanning",CURRENT_STATUS_ENROLLING:"current_status enrolling",SCAN_START:"scan start",SCAN_SUCCESS:"scan success",AUTO_RECOGNIZE_FALSE:"auto_recognize false",AUTO_RECOGNIZE_TRUE:"auto_recognize true"};t.exports=class extends n{constructor(e,t){if(super(e),this.instance=e,this.i18n=t||{},this.instance.fingerprint=this,this.state=new Proxy({isScanStart:!1,isRecognizedFPByDefault:!1,isEnrolling:!1,isScanning:!1},{set:(e,t,i)=>{const n=e[t];e[t]=i,!e.isEnrolling&&!e.isScanning||e.isRecognizedFPByDefault?this.disableBody():this.enableBody();const s=document.querySelector(".gm-fingerprint-dialog-auth-required-status");switch(t){case"isScanStart":case"isEnrolling":case"isScanning":e.isScanStart&&(e.isEnrolling||e.isScanning)?(s.classList.add("active"),s.setAttribute("data-text",this.i18n.yes||"Yes"),this.toolbarBtnImage.classList.add("fingerprint-require")):(s.classList.remove("active"),s.setAttribute("data-text",this.i18n.no||"No"),this.toolbarBtnImage.classList.remove("fingerprint-require"));break;case"isRecognizedFPByDefault":i!==n&&(i?this.sendDataToInstance(a.SET_AUTO_RECOGNIZE_TRUE):this.sendDataToInstance(a.SET_AUTO_RECOGNIZE_FALSE)),i?this.toolbarBtnImage.classList.add("fingerprint-autoValidation"):this.toolbarBtnImage.classList.remove("fingerprint-autoValidation"),document.querySelector(".gm-fingerprint-dialog-recognized-fp-by-default-status").setState(i)}return!0}}),this.renderToolbarButton(),this.renderWidget(),this.instance.registerEventCallback("fingerprint",e=>this.handleFingerprintEvent(e)),this.instance.store.getState().isWebRTCConnectionReady)this.sendDataToInstance(a.NOTIFY_ALL);else{const e=this.instance.store.subscribe(t=>{let{isWebRTCConnectionReady:i}=t;i&&(this.sendDataToInstance(a.NOTIFY_ALL),e())})}}renderToolbarButton(){const e=this.instance.getChildByClass(this.instance.root,"gm-toolbar");if(!e)return;const t=e.children[0];this.toolbarBtn=document.createElement("li"),this.toolbarBtnImage=document.createElement("div"),this.toolbarBtnImage.className="gm-icon-button gm-fingerprint-button",this.toolbarBtnImage.title=this.i18n.FINGERPRINT_TITLE||"Biometrics",this.toolbarBtn.onclick=()=>this.toggleWidget(),this.toolbarBtn.appendChild(this.toolbarBtnImage),t.appendChild(this.toolbarBtn)}renderWidget(){this.widget=document.createElement("div"),this.container=document.createElement("div"),this.container.className="gm-fingerprint-container";const e=document.createElement("div");e.className="gm-title",e.innerHTML=this.i18n.FINGERPRINT_TITLE||"Biometrics",this.container.appendChild(e);const t=document.createElement("div");t.classList.add("gm-fingerprint-dialog-header");const i=document.createElement("div");i.classList.add("gm-fingerprint-dialog-auth-required");const n=document.createElement("label");n.innerHTML=this.i18n.FINGERPRINT_AUTH_REQUIRED_LABEL||"Authentification required";const r=document.createElement("div");r.classList.add("gm-fingerprint-dialog-auth-required-status"),r.classList.add(this.state.isScanStart?"active":"inactive"),r.classList.remove(this.state.isScanStart?"active":"inactive"),r.setAttribute("data-text",this.state.isScanStart?this.i18n.yes||"Yes":this.i18n.no||"No"),i.appendChild(n),i.appendChild(r);const o=document.createElement("div");o.classList.add("gm-fingerprint-dialog-recognized-fp-by-default");const c=document.createElement("label");c.innerHTML=this.i18n.FINGERPRINT_RECOGNIZED_FP_BY_DEFAULT_LABEL||"Recognized by default";const d=s.createSwitch({onChange:e=>{this.state.isRecognizedFPByDefault=e}});d.classList.add("gm-fingerprint-dialog-recognized-fp-by-default-status"),o.appendChild(c),o.appendChild(d),t.appendChild(i),t.appendChild(o),this.container.appendChild(t),this.container.appendChild(document.createElement("hr"));const l=document.createElement("div");l.classList.add("gm-fingerprint-dialog-body");const h=document.createElement("div");h.classList.add("gm-fingerprint-dialog-buttons");[{cmd:"recognized",message:a.SCAN_RECOGNIZED,onclick:e=>{e.classList.add("gm-loader")}},{cmd:"unrecognized",message:a.SCAN_UNRECOGNIZED},{cmd:"dirty",message:a.SCAN_DIRTY},{cmd:"too-fast",message:a.SCAN_TOO_FAST},{cmd:"partial",message:a.SCAN_PARTIAL},{cmd:"insufficient",message:a.SCAN_INSUFFICIENT}].forEach(e=>{this.createFingerprintButton(e,h)}),l.appendChild(h),this.container.appendChild(l),this.container.appendChild(document.createElement("hr"));const p=document.createElement("div");p.classList.add("gm-fingerprint-dialog-footer");const u=document.createElement("div");u.classList.add("gm-fingerprint-dialog-give-feedback");const m=document.createElement("a");m.href=this.instance.options.giveFeedbackLink,m.innerHTML=this.i18n.FINGERPRINT_GIVE_FEEDBACK_LABEL||"Give feedback",m.target="_blank",m.rel="noopener noreferrer",u.appendChild(m),p.appendChild(u),this.container.appendChild(p),this.widget.className="gm-overlay gm-fingerprint-plugin gm-hidden";const g=document.createElement("div");g.className="gm-close-btn",g.onclick=()=>this.closeWidget(),this.widget.appendChild(g),this.widget.appendChild(this.container),this.overlays.push(this.widget),this.instance.root.appendChild(this.widget),this.disableBody()}toggleWidget(){this.widget.classList.contains("gm-hidden")?(this.instance.emit("close-overlays"),this.instance.emit("keyboard-disable")):this.instance.emit("keyboard-enable"),this.widget.classList.toggle("gm-hidden"),this.toolbarBtnImage.classList.toggle("gm-active")}closeWidget(){this.instance.emit("keyboard-enable"),this.widget.classList.add("gm-hidden"),this.toolbarBtnImage.classList.remove("gm-active")}createFingerprintButton(e,t){let{cmd:i,message:n,onclick:s}=e;const a=document.createElement("div");a.classList.add("gm-fingerprint-dialog-button");const r=document.createElement("div");r.className=`gm-${i}-fingerprint-image`;const o=document.createElement("label");o.innerHTML=this.i18n[`FINGERPRINT_${i.toUpperCase()}_LABEL`]||i,a.onclick=()=>{this.sendDataToInstance(n),s&&s(a)},a.appendChild(r),a.appendChild(o),t.appendChild(a)}disableBody(){document.querySelectorAll(".gm-fingerprint-dialog-body .gm-fingerprint-dialog-button").forEach(e=>{e.classList.add("disabled")})}enableBody(){document.querySelectorAll(".gm-fingerprint-dialog-body .gm-fingerprint-dialog-button").forEach(e=>{e.classList.remove("disabled")})}handleFingerprintEvent(e){switch(e){case r.SCAN_START:this.state.isScanStart=!0;break;case r.SCAN_SUCCESS:case r.SCAN_ERROR_TIMEOUT:case r.SCAN_ERROR_CANCELED:case r.SCAN_ERROR:this.state.isEnrolling=!1,this.state.isScanning=!1,this.state.isScanStart=!1,Array.from(document.querySelectorAll(".gm-fingerprint-dialog-button")).forEach(e=>{e.classList.remove("gm-loader")}),this.closeWidget();break;case r.CURRENT_STATUS_SCANNING:this.state.isScanning=!0;break;case r.CURRENT_STATUS_ENROLLING:this.state.isEnrolling=!0,this.state.isScanning=!1;break;case r.AUTO_RECOGNIZE_FALSE:this.state.isRecognizedFPByDefault=!1;break;case r.AUTO_RECOGNIZE_TRUE:this.state.isRecognizedFPByDefault=!0}}sendDataToInstance(e){const t={channel:"fingerprint",messages:[e]};this.instance.sendEvent(t)}}},{"./util/OverlayPlugin":144,"./util/components":145,loglevel:99}],128:[function(e,t,i){t.exports=class{constructor(e){this.instance=e,document.addEventListener&&(this.instance.addListener(document,"webkitfullscreenchange",this.onFullscreenEvent.bind(this),!1),this.instance.addListener(document,"fullscreenchange",this.onFullscreenEvent.bind(this),!1)),this.renderToolbarButton()}renderToolbarButton(){const e=this.instance.getChildByClass(this.instance.root,"gm-toolbar");if(!e)return;const t=e.children[0];if(this.isTemplateFullscreen()){const e=this.instance.getChildByClass(this.instance.root,"gm-fullscreen-message");e.onclick=()=>{e.classList.add("hide"),this.instance.wrapper.classList.remove("hide"),this.goFullscreen(this.instance.root)}}else this.button=document.createElement("li"),this.image=document.createElement("div"),this.image.className="gm-icon-button gm-fullscreen-button",this.image.title="Fullscreen",this.button.appendChild(this.image),t.appendChild(this.button),this.button.onclick=()=>{this.fullscreenEnabled()?this.exitFullscreen():this.goFullscreen(this.instance.root)}}goFullscreen(e){this.instance.wrapper.classList.add("gm-fullscreen"),this.image.classList.add("gm-active"),e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen()}fullscreenEnabled(){return document.fullscreenElement||document.webkitFullscreenElement}exitFullscreen(){this.instance.wrapper.classList.remove("gm-fullscreen"),this.image.classList.remove("gm-active"),this.fullscreenEnabled()&&(document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen&&document.webkitExitFullscreen())}isTemplateFullscreen(){return Boolean(this.instance.getChildByClass(this.instance.root,"gm-fullscreen-message"))}onFullscreenEvent(){this.fullscreenEnabled()||this.exitFullscreen()}}},{}],129:[function(e,t,i){const n=e("./util/OverlayPlugin"),s=e("loglevel");s.setDefaultLevel("debug"),t.exports=class extends n{constructor(e,t,i){super(e),this.instance=e,this.i18n=t||{},this.instance.gps=this,this.fields=["altitude","longitude","latitude","accuracy","bearing"],i&&this.fields.push("speed"),this.map=null,"undefined"!=typeof google?this.elevationService=new google.maps.ElevationService:this.elevationService=!1,this.markers=[],this.mapLat=65.9667,this.mapLng=-18.5333,this.elevation=15.04444408,this.minimumZoomLevel=8,this.renderToolbarButton(),this.renderGPSForm(),this.renderMapView(),this.instance.registerEventCallback("gps",e=>{const t=e.split(" ");this.fields.includes(t[0])&&t.length>=2&&this.setFieldValue("gm-gps-"+t[0],t[1])})}renderToolbarButton(){const e=this.instance.getChildByClass(this.instance.root,"gm-toolbar");if(!e)return;const t=e.children[0];this.toolbarBtn=document.createElement("li"),this.toolbarBtnImage=document.createElement("div"),this.toolbarBtnImage.className="gm-icon-button gm-gps-button",this.toolbarBtnImage.title=this.i18n.GPS_TITLE||"GPS",this.toolbarBtn.appendChild(this.toolbarBtnImage),this.toolbarBtn.onclick=this.toggleForm.bind(this),t.appendChild(this.toolbarBtn)}renderMapView(){this.mapWidget=document.createElement("div"),this.mapview=document.createElement("div");const e=document.createElement("button");e.innerHTML=this.i18n.GPS_CAPTURE||"Capture",e.className="gm-gps-mapview-capture",e.onclick=this.onMapClicked.bind(this);const t=document.createElement("button");t.innerHTML=this.i18n.GPS_CANCEL||"Cancel",t.className="gm-gps-mapview-cancel",t.onclick=this.onHideMapButtonClicked.bind(this),this.mapview.className="gm-mapview",this.mapWidget.className="gm-overlay gm-gps-mapview gm-hidden",this.mapWidget.appendChild(this.mapview),this.mapWidget.appendChild(e),this.mapWidget.appendChild(t),this.overlays.push(this.mapWidget),this.instance.root.appendChild(this.mapWidget)}loadMap(){const e=this.getLocationInfo();"undefined"!=typeof google&&(this.map=new google.maps.Map(this.mapview,{center:{lat:e.latitude,lng:e.longitude},zoom:this.minimumZoomLevel}),this.addMapMarker(e.latitude,e.longitude),this.map.addListener("click",e=>{this.clearMarkers(),this.addMapMarker(e.latLng.lat(),e.latLng.lng())}))}toggleMapview(){this.mapWidget.classList.toggle("gm-hidden")}generateInput(e,t,i,n,s){const a=document.createElement("div"),r=document.createElement("label");r.innerHTML=t,a.appendChild(r);const o=document.createElement("input");return o.type="number",o.defaultValue=i,o.min=n,o.max=s,o.className="gm-gps-"+e,o.step="any",this.instance.addListener(o,"keyup",this.checkErrors.bind(this)),a.appendChild(o),a}checkErrors(){let e=!1;this.fields.forEach(t=>{const i=this.instance.getChildByClass(this.instance.root,"gm-gps-"+t);!1===i.checkValidity()?(i.classList.add("gm-error"),e=!0):i.classList.remove("gm-error")}),this.instance.getChildByClass(this.instance.root,"gm-gps-submit").disabled=e}renderGPSForm(){this.formWidget=document.createElement("div"),this.form=document.createElement("form");const e=document.createElement("div"),t=document.createElement("div");t.className="gm-title",t.innerHTML=this.i18n.GPS_TITLE||"GPS",this.form.appendChild(t);const i=document.createElement("div");i.className="gm-col";const n=this.i18n.GPS_LATITUDE||"Latitude (°)";i.appendChild(this.generateInput("latitude",n,this.mapLat,-90,90));const s=this.i18n.GPS_LONGITUDE||"Longitude (°)";i.appendChild(this.generateInput("longitude",s,this.mapLng,-180,180));const a=this.i18n.GPS_ALTITUDE||"Altitude (m)";i.appendChild(this.generateInput("altitude",a,this.elevation,-1e4,1e4));const r=this.i18n.GPS_ACCURACY||"Accuracy (m)";i.appendChild(this.generateInput("accuracy",r,0,0,200));const o=this.i18n.GPS_BEARING||"Bearing (°)";if(i.appendChild(this.generateInput("bearing",o,0,0,360)),this.fields.includes("speed")){const e=this.i18n.GPS_SPEED||"Speed (m/s)";i.appendChild(this.generateInput("speed",e,0,0,399.99))}const c=document.createElement("div"),d=document.createElement("div"),l=document.createElement("button");this.rightGeolocWrap=document.createElement("div"),this.geolocBtn=document.createElement("button"),c.className="gm-col",d.className="map-wrap",l.className="map",l.innerHTML=this.i18n.GPS_MAP||"MAP",l.onclick=this.onOpenMapButtonClicked.bind(this),this.elevationService||(l.disabled=!0),this.rightGeolocWrap.className="gm-geoloc-wrap",this.geolocBtn.className="gm-gps-geoloc",this.geolocBtn.innerHTML=this.i18n.GPS_GEOLOC||"My position",this.geolocBtn.onclick=this.onGeolocButtonClicked.bind(this),d.appendChild(l),this.rightGeolocWrap.appendChild(this.geolocBtn),c.appendChild(d),c.appendChild(this.rightGeolocWrap),e.className="gm-wrap",e.appendChild(i),e.appendChild(c),this.form.appendChild(e);const h=document.createElement("button");h.innerHTML=this.i18n.GPS_SUBMIT||"Submit",h.className="gm-gps-submit",h.onclick=this.sendDataToInstance.bind(this),this.form.appendChild(h),this.formWidget.className="gm-overlay gm-gps-controls gm-hidden";const p=document.createElement("div");p.className="gm-close-btn",p.onclick=this.toggleForm.bind(this),this.formWidget.appendChild(p),this.formWidget.appendChild(this.form),this.overlays.push(this.formWidget),this.instance.root.appendChild(this.formWidget)}toggleForm(){this.formWidget.classList.contains("gm-hidden")?(this.instance.emit("close-overlays"),this.instance.emit("keyboard-disable")):this.instance.emit("keyboard-enable"),this.checkForGeolocation(),this.formWidget.classList.toggle("gm-hidden"),this.mapWidget.classList.add("gm-hidden"),this.toolbarBtnImage.classList.toggle("gm-active")}setGeolocButtonAvailability(e){this.geolocBtn.disabled=!e,this.rightGeolocWrap.title=e?this.i18n.GPS_GEOLOC_TOOLTIP||"Get my position from browser location":this.i18n.GPS_NOGEOLOC_TOOLTIP||"Geolocation not supported"}onOpenMapButtonClicked(e){e.preventDefault(),this.toggleMapview(),this.loadMap()}onGeolocButtonClicked(e){e.preventDefault(),this.getLocation()}onMapClicked(e){e.preventDefault(),this.setFieldValue("gm-gps-latitude",this.mapLat),this.setFieldValue("gm-gps-longitude",this.mapLng),this.setFieldValue("gm-gps-altitude",this.elevation),this.toggleMapview()}onHideMapButtonClicked(e){e.preventDefault(),this.mapWidget.classList.add("gm-hidden")}sendDataToInstance(e){e.preventDefault();const t=this.buildEventJson();t.messages.length&&this.instance.sendEvent(t),this.toggleForm()}getLocation(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(e=>{if(e&&e.coords&&(this.fields.forEach(t=>{e.coords[t]&&this.setFieldValue("gm-gps-"+t,e.coords[t])}),!e.coords.altitude&&this.elevationService&&e.coords.latitude&&e.coords.longitude)){const t=new google.maps.LatLng(e.coords.latitude,e.coords.longitude);this.elevationService.getElevationForLocations({locations:[t]},(e,t)=>{"OK"===t&&e[0]&&this.setFieldValue("gm-gps-altitude",e[0].elevation)})}})}checkForGeolocation(){"geolocation"in navigator?navigator.geolocation.getCurrentPosition(()=>{this.setGeolocButtonAvailability(!0)},()=>{this.setGeolocButtonAvailability(!1)}):this.setGeolocButtonAvailability(!1)}setFieldValue(e,t){if(t=Number(t),Number.isNaN(t))return;const i=this.instance.getChildByClass(this.instance.root,e);i&&(i.max&&(t=Math.min(t,i.max)),i.min&&(t=Math.max(t,i.min)),i.value=t)}getLocationInfo(){const e={};return this.fields.forEach(t=>{const i=this.instance.getChildByClass(this.instance.root,"gm-gps-"+t);if(!i)return void s.debug(t+" field not found.");let n=Number(i.value);Number.isNaN(n)||(i.max&&(n=Math.min(n,i.max)),i.min&&(n=Math.max(n,i.min)),e[t]=n)}),e}buildEventJson(){const e={channel:"gps",messages:[]},t=this.getLocationInfo();return this.fields.forEach(i=>{e.messages.push("set "+i+" "+t[i])}),e.messages.length&&e.messages.push("enable"),e}addMapMarker(e,t){this.mapLat=e,this.mapLng=t;const i=new google.maps.Marker({position:{lat:this.mapLat,lng:this.mapLng},map:this.map});if(this.markers.push(i),this.map&&this.map.getZoom()<this.minimumZoomLevel&&(this.map.setCenter(i.getPosition()),this.map.setZoom(this.minimumZoomLevel)),this.elevationService){const i=new google.maps.LatLng(e,t);this.elevationService.getElevationForLocations({locations:[i]},(e,t)=>{"OK"===t&&e[0]&&(this.elevation=e[0].elevation)})}}clearMarkers(){this.markers.forEach(e=>{e.setMap(null)}),this.markers=[]}}},{"./util/OverlayPlugin":144,loglevel:99}],130:[function(e,t,i){const n=e("loglevel");n.setDefaultLevel("debug");const s=e("./util/OverlayPlugin");t.exports=class extends s{constructor(e,t){super(e),this.instance=e,this.i18n=t||{},this.instance.gamepad=this,this.instance.addListener(window,"gm-gamepadButtonPressed",this.onGamepadButtonPressed.bind(this)),this.instance.addListener(window,"gm-gamepadButtonReleased",this.onGamepadButtonReleased.bind(this)),this.instance.addListener(window,"gm-gamepadAxis",this.onGamepadAxisChanged.bind(this)),this.instance.registerEventCallback("vinput",this.handleConfirmation.bind(this)),this.renderToolbarButton(),this.renderWidget()}renderToolbarButton(){const e=this.instance.getChildByClass(this.instance.root,"gm-toolbar");if(!e)return;const t=e.children[0];this.toolbarBtn=document.createElement("li"),this.toolbarBtnImage=document.createElement("div"),this.toolbarBtnImage.className="gm-icon-button gm-gamepad-button",this.toolbarBtnImage.title=this.i18n.GAMEPAD_TITLE||"Gamepad",this.toolbarBtn.appendChild(this.toolbarBtnImage),this.toolbarBtn.onclick=this.toggleWidget.bind(this),t.appendChild(this.toolbarBtn)}renderWidget(){this.widget=document.createElement("div"),this.container=document.createElement("div");const e=document.createElement("div");e.className="gm-title",e.innerHTML=this.i18n.GAMEPAD_TITLE||"Gamepad",this.container.appendChild(e),this.content=document.createElement("div"),this.container.appendChild(this.content),this.generateContent(),this.instance.addListener(window,"gm-gamepadConnected",this.handleGamepadPlugged.bind(this)),this.instance.addListener(window,"gm-gamepadDisconnected",this.handleGamepadUnplugged.bind(this)),this.widget.className="gm-overlay gm-gamepad-plugin gm-hidden";const t=document.createElement("div");t.onclick=this.toggleWidget.bind(this),t.className="gm-close-btn",this.widget.appendChild(t),this.widget.appendChild(this.container),this.overlays.push(this.widget),this.instance.root.appendChild(this.widget)}generateContent(){this.content.replaceChildren();const e=this.instance.gamepadManager.getGamepads();if(0===e.length)this.content.innerHTML="No gamepad detected, please plug one or press a button";else{const t=document.createElement("ul");for(const i of e)if("plugged"===i.state){const e=document.createElement("li");e.innerHTML=i.name,t.appendChild(e)}this.content.appendChild(t)}}handleGamepadPlugged(e){n.debug("Gamepad plugged");const t=e.detail;n.debug(t),n.debug(t.hostIndex),this.generateContent(),this.sendGamepadPlugEvent(t.hostIndex,t.name.split(" ").join("_"),t.vendorID,t.productID)}handleGamepadUnplugged(e){n.debug("Gamepad unplugged");const t=e.detail;this.generateContent(),this.sendGamepadUnplugEvent(t.guestIndex)}sendGamepadPlugEvent(e,t,i,n){const s={channel:"vinput",messages:["gamepad_plugin "+e+" "+t+" "+i+" "+n]};this.instance.sendEvent(s)}sendGamepadUnplugEvent(e){const t={channel:"vinput",messages:["gamepad_plugout "+e]};this.instance.sendEvent(t)}toggleWidget(){this.widget.classList.contains("gm-hidden")?(this.instance.emit("close-overlays"),this.instance.emit("keyboard-disable")):this.instance.emit("keyboard-enable"),this.widget.classList.toggle("gm-hidden"),this.toolbarBtnImage.classList.toggle("gm-active")}handleConfirmation(e){const t=e.split(" ");"gamepad_plugin_confirmation"===t[0]&&3===t.length&&this.instance.gamepadManager.listenForInputs(parseInt(t[1]),parseInt(t[2]))}onGamepadButtonPressed(e){n.debug("button pressed");const t={channel:"vinput",messages:["gamepad_press "+e.detail.gamepadIndex+" "+e.detail.buttonIndex]};this.instance.sendEvent(t)}onGamepadButtonReleased(e){n.debug("button released");const t={channel:"vinput",messages:["gamepad_release "+e.detail.gamepadIndex+" "+e.detail.buttonIndex]};this.instance.sendEvent(t)}onGamepadAxisChanged(e){n.debug("Axis changed");const t={channel:"vinput",messages:["gamepad_axis "+e.detail.gamepadIndex+" "+e.detail.axisIndex+" "+e.detail.value]};this.instance.sendEvent(t)}}},{"./util/OverlayPlugin":144,loglevel:99}],131:[function(e,t,i){const n=e("loglevel");n.setDefaultLevel("debug");const s=Object.freeze({Xbox360:Symbol("Xbox360"),XboxOne:Symbol("XboxOne"),Dualshock4:Symbol("DualShock4")});t.exports=class{constructor(e){this.instance=e,this.instance.gamepadManager=this,this.instance.gamepadEventsEnabled=!0,this.isRunning=!1,this.gamepadInfos=[["GPD Win 2 X-Box Controller",s.Xbox360,121,6356],["Thrustmaster Gamepad GP XID",s.Xbox360,1103,45862],["Xbox 360 Controller",s.Xbox360,1118,654],["Xbox 360 Controller v2",s.Xbox360,1118,655],["Xbox 360 Wireless Dongle",s.Xbox360,1118,657],["Xbox 360 Big Button IR",s.Xbox360,1118,672],["Xbox 360 Controller",s.Xbox360,1118,673],["Xbox One Controller (1537)",s.XboxOne,1118,733],["Xbox One Controller (Firmware 2015)",s.XboxOne,1103,45862],["Xbox One S Controller (Bluetooth)",s.XboxOne,1118,736],["Xbox One Elite Controller",s.XboxOne,1118,739],["Xbox One S Controller (1708)",s.XboxOne,1118,746],["Xbox One S Controller (1708) (Bluetooth)",s.XboxOne,1118,765],["Xbox One Controller",s.XboxOne,1118,767],["Xbox One Elite Series 2",s.XboxOne,1118,2816],["Xbox 360 Wireless Receiver",s.Xbox360,1118,1817],["Xbox Series X/S Controller",s.XboxOne,1118,2834],["Xbox Series X/S Controller",s.XboxOne,1118,2835],["Logitech Gamepad F310",s.Xbox360,1133,49693],["Logitech Gamepad F510",s.Xbox360,1133,49694],["Logitech Gamepad F710",s.Xbox360,1133,49695],["Logitech Chillstream Controller",s.Xbox360,1133,49730],["HORI Pad Switch",s.Xbox360,3853,193],["HORI Pokken Tournament DX Pro Pad",s.Xbox360,3853,146],["HORI Wireless Switch Pad",s.Xbox360,3853,246],["HORI Battle Pad",s.Xbox360,3853,220],["PowerA Wired Controller Plus/PowerA Wired Gamecube Controller",s.Xbox360,8406,42769],["PDP Wired Fight Pad Pro for Nintendo Switch",s.Xbox360,3695,389],["PDP Faceoff Wired Pro Controller for Nintendo Switch",s.Xbox360,3695,384],["PDP Faceoff Deluxe Wired Pro Controller for Nintendo Switch",s.Xbox360,3695,385],["Nintendo Switch Pro Controller",s.Xbox360,1406,8201],["PlayStation 3 Controller",s.Dualshock4,1356,616],["PlayStation 3 Controller",s.Dualshock4,2341,5],["PlayStation 3 Controller",s.Dualshock4,34952,776],["Afterglow PS3",s.Dualshock4,6708,2102],["HORI horipad4 PS3",s.Dualshock4,3853,110],["HORI horipad4 PS4",s.Dualshock4,3853,102],["HORI Fighting commander PS3",s.Dualshock4,3853,95],["HORI Fighting commander PS4",s.Dualshock4,3853,94],["Madcats Fightpad Pro PS4",s.Dualshock4,1848,33360],["Venom Arcade Stick",s.Dualshock4,121,6170],["PC Twin Shock Controller",s.Dualshock4,121,6],["Digiflip GP006",s.Dualshock4,9571,1315],["SRXJ-PH2400",s.Dualshock4,4607,13105],["ShanWan PS3",s.Dualshock4,8380,21760],["Firestorm Dual Analog 3",s.Dualshock4,1103,45845],["Horipad 3",s.Dualshock4,3853,77],["HORI BDA GP1",s.Dualshock4,3853,9],["Green Asia",s.Dualshock4,3727,8],["Real Arcade Pro 4",s.Dualshock4,3853,106],["Rock Candy PS4",s.Dualshock4,3695,286],["Afterglow PS3",s.Dualshock4,3695,532],["JC-U4113SBK",s.Dualshock4,1390,8211],["Madcatz Fightstick Pro",s.Dualshock4,1848,34872],["Afterglow PS3",s.Dualshock4,6708,2102],["Quanba Q1 fight stick",s.Dualshock4,3888,4352],["HORI fighting mini stick",s.Dualshock4,3853,135],["BTP 2163",s.Dualshock4,33664,3],["PS2 ACME GA-D5",s.Dualshock4,4933,4096],["SpeedLink Strike FX",s.Dualshock4,3727,12405],["Rock Candy PS3",s.Dualshock4,3695,296],["Quanba Drone",s.Dualshock4,11298,8192],["Cyborg V3",s.Dualshock4,1699,63010],["Thrustmaster wireless 3-1",s.Dualshock4,1103,53255],["Gioteck vx2",s.Dualshock4,9712,33731],["JC-U3412SBK",s.Dualshock4,1464,4102],["Power A PS3",s.Dualshock4,8406,22381],["PDP Afterglow Wireless PS3 Controller",s.Dualshock4,3695,4884],["Mad Catz Alpha PS3 mode",s.Dualshock4,1848,12672],["Mad Catz Alpha PS4 mode",s.Dualshock4,1848,33152],["Victrix Pro FS",s.Dualshock4,3695,515],["PlayStation 4 Controller",s.Dualshock4,1356,1476],["PlayStation 4 Controller V2",s.Dualshock4,1356,2508],["PlayStation 4 Wireless Dongle",s.Dualshock4,1356,2976],["PS5 DualSense Controller",s.Dualshock4,1356,3302],["HORI Real Arcade Pro 4",s.Dualshock4,3853,138],["HORIPAD 4 FPS",s.Dualshock4,3853,85],["HORIPAD 4 FPS Plus",s.Dualshock4,3853,102],["HORIPAD 4 FPS Plus",s.Dualshock4,1848,33668],["Mad Catz FightPad Pro PS4",s.Dualshock4,1848,33360],["Mad Catz Fightstick TE S+",s.Dualshock4,1848,33668],["Armor Armor 3 Pad PS4",s.Dualshock4,3090,3600],["EMIO PS4 Elite Controller",s.Dualshock4,3090,7414],["Razer Raiju PS4 Controller",s.Dualshock4,5426,4096],["Razer Panthera PS4 Controller",s.Dualshock4,5426,1025],["STRIKEPAD PS4 Grip Add-on",s.Dualshock4,1356,1477],["Nacon Revolution Pro Controller",s.Dualshock4,5227,3329],["Nacon Revolution Pro Controller V2",s.Dualshock4,5227,3330],["HORI TAC4",s.Dualshock4,3853,160],["HORI TAC PRO",s.Dualshock4,3853,156],["Hitbox Arcade Stick",s.Dualshock4,3090,3830],["Venom Arcade Stick",s.Dualshock4,121,6171],["Mad Catz FightPad PRO",s.Dualshock4,1848,12880],["HORI mini wired gamepad",s.Dualshock4,3853,238],["Mad Catz FightStick TE 2+ PS4",s.Dualshock4,1848,33921],["Mad Catz FightStick TE 2",s.Dualshock4,1848,33920],["Armor 3, Level Up Cobra",s.Dualshock4,30021,260],["Razer Raiju 2 Tournament Edition (USB)",s.Dualshock4,5426,4103],["Razer Raiju 2 Tournament Edition (BT)",s.Dualshock4,5426,4106],["Razer Raiju 2 Ultimate Edition (USB)",s.Dualshock4,5426,4100],["Razer Raiju 2 Ultimate Edition (BT)",s.Dualshock4,5426,4105],["Razer Panthera Evo Fightstick",s.Dualshock4,5426,4104],["Astro C40",s.Dualshock4,39046,37],["Game:Pad 4",s.Dualshock4,3090,3605],["PS4 Fun Controller",s.Dualshock4,16385,260],["Elecom JC-U3613M",s.Xbox360,1390,8196],["Saitek P3600",s.Xbox360,1699,62746],["Mad Catz Wired Xbox 360 Controller",s.Xbox360,1848,18198],["Mad Catz Street Fighter IV FightStick SE",s.Xbox360,1848,18200],["Mad Catz Xbox 360 Controller",s.Xbox360,1848,18214],["Mad Catz Street Fighter IV FightPad",s.Xbox360,1848,18216],["Mad Catz MicroCon Gamepad",s.Xbox360,1848,18230],["Mad Catz Wired Xbox 360 Controller (SFIV)",s.Xbox360,1848,18232],["Mad Catz Beat Pad",s.Xbox360,1848,18240],["Mad Catz FightStick TE 2",s.XboxOne,1848,18945],["Mad Catz Xbox controller - MW2",s.Xbox360,1848,46886],["Mad Catz JOYTECH NEO SE Advanced GamePad",s.Xbox360,1848,48879],["Saitek Cyborg Rumble Pad - PC/Xbox 360",s.Xbox360,1848,51970],["Saitek P3200 Rumble Pad - PC/Xbox 360",s.Xbox360,1848,51971],["Super SFIV FightStick TE S",s.Xbox360,1848,63288],["HSM3 Xbox360 dancepad",s.Xbox360,3695,261],["Afterglow AX.1 Gamepad for Xbox 360",s.Xbox360,3695,275],["Rock Candy Gamepad Wired Controller",s.Xbox360,3695,287],["Xbox 360 Wired Controller",s.Xbox360,3695,307],["Afterglow Prismatic Wired Controller",s.XboxOne,3695,313],["PDP Xbox One Controller",s.XboxOne,3695,314],["Rock Candy Wired Controller for Xbox One",s.XboxOne,3695,326],["PDP Marvel Xbox One Controller",s.XboxOne,3695,327],["PDP Xbox One Arcade Stick",s.XboxOne,3695,348],["PDP Xbox One Controller",s.XboxOne,3695,353],["PDP Xbox One Controller",s.XboxOne,3695,354],["PDP Xbox One Controller",s.XboxOne,3695,355],["PDP Battlefield One",s.XboxOne,3695,356],["PDP Titanfall 2",s.XboxOne,3695,357],["Pelican PL-3601 'TSZ' Wired Xbox 360 Controller",s.Xbox360,3695,513],["Afterglow Gamepad for Xbox 360",s.Xbox360,3695,531],["Rock Candy Gamepad for Xbox 360",s.Xbox360,3695,543],["Rock Candy Gamepad for Xbox One 2015",s.XboxOne,3695,582],["Logic3 Controller",s.Xbox360,3695,769],["Rock Candy Gamepad for Xbox One 2016",s.XboxOne,3695,838],["Logic3 Controller",s.Xbox360,3695,1025],["Afterglow AX.1 Gamepad for Xbox 360",s.Xbox360,3695,1043],["PDP Xbox 360 Controller",s.Xbox360,3695,1281],["PDP Afterglow AX.1",s.Xbox360,3695,63744],["Hori Co. DOA4 FightStick",s.Xbox360,3853,10],["Hori PadEX Turbo",s.Xbox360,3853,12],["Hori Fighting Stick EX2",s.Xbox360,3853,13],["Hori Real Arcade Pro.EX",s.Xbox360,3853,22],["Hori Real Arcade Pro VX",s.Xbox360,3853,27],["Hori Real Arcade Pro Hayabusa (USA) Xbox One",s.XboxOne,3853,99],["HORIPAD ONE",s.XboxOne,3853,103],["Hori Real Arcade Pro V Kai Xbox One",s.XboxOne,3853,120],["Nacon GC-100XF",s.Xbox360,4553,22e3],["Honey Bee Xbox360 dancepad",s.Xbox360,4779,4],["PDP AFTERGLOW AX.1",s.Xbox360,4779,769],["Mortal Kombat Klassic FightStick",s.Xbox360,4779,771],["RedOctane Guitar Hero X-plorer",s.Xbox360,5168,18248],["RedOctane Controller",s.Xbox360,5168,63489],["BigBen Interactive XBOX 360 Controller",s.Xbox360,5227,1537],["Razer Sabertooth",s.Xbox360,5426,55],["Razer Atrox Arcade Stick",s.XboxOne,5426,2560],["Razer Wildcat",s.XboxOne,5426,2563],["Power A Mini Pro Elite",s.Xbox360,5604,16128],["Xbox Airflo wired controller",s.Xbox360,5604,16138],["Batarang Xbox 360 controller",s.Xbox360,5604,16144],["Joytech Neo-Se Take2",s.Xbox360,5678,48879],["Razer Onza Tournament Edition",s.Xbox360,5769,64768],["Razer Onza Classic Edition",s.Xbox360,5769,64769],["Razer Sabertooth",s.Xbox360,5769,65024],["Harmonix Rock Band Guitar",s.Xbox360,7085,2],["Harmonix Rock Band Drumkit",s.Xbox360,7085,3],["Mad Catz Xbox 360 Controller",s.Xbox360,7085,61462],["Mad Catz Street Fighter IV SE Fighting Stick",s.Xbox360,7085,61464],["Mad Catz Brawlstick for Xbox 360",s.Xbox360,7085,61465],["Mad Cats Ghost Recon FS GamePad",s.Xbox360,7085,61473],["MLG Pro Circuit Controller (Xbox)",s.Xbox360,7085,61475],["Mad Catz Call Of Duty",s.Xbox360,7085,61477],["Mad Catz FPS Pro",s.Xbox360,7085,61479],["Street Fighter IV FightPad",s.Xbox360,7085,61480],["Mad Catz Fightpad",s.Xbox360,7085,61486],["Mad Catz MicroCon GamePad Pro",s.Xbox360,7085,61494],["Street Fighter IV FightStick TE",s.Xbox360,7085,61496],["Mad Catz MvC2 TE",s.Xbox360,7085,61497],["Mad Catz SFxT Fightstick Pro",s.Xbox360,7085,61498],["Street Fighter IV Arcade Stick TE - Chun Li",s.Xbox360,7085,61501],["Mad Catz MLG FightStick TE",s.Xbox360,7085,61502],["Mad Catz FightStick SoulCaliber",s.Xbox360,7085,61503],["Mad Catz FightStick TES+",s.Xbox360,7085,61506],["Mad Catz FightStick TE2",s.Xbox360,7085,61568],["HoriPad EX2 Turbo",s.Xbox360,7085,62721],["Hori Real Arcade Pro.VX SA",s.Xbox360,7085,62722],["Hori Fighting Stick VX",s.Xbox360,7085,62723],["Hori Real Arcade Pro. EX",s.Xbox360,7085,62724],["Hori Fighting Stick EX2B",s.Xbox360,7085,62725],["Hori Real Arcade Pro.EX Premium VLX",s.Xbox360,7085,62726],["Harmonix Xbox 360 Controller",s.Xbox360,7085,63744],["Gamestop Xbox 360 Controller",s.Xbox360,7085,63745],["Tron Xbox 360 controller",s.Xbox360,7085,63747],["PDP Versus Fighting Pad",s.Xbox360,7085,63748],["MortalKombat FightStick",s.Xbox360,7085,63750],["MadCatz GamePad",s.Xbox360,7085,64001],["Razer Onza TE",s.Xbox360,7085,64768],["Razer Onza",s.Xbox360,7085,64769],["Razer Atrox Arcade Stick",s.Xbox360,9414,20480],["PowerA MINI PROEX Controller",s.Xbox360,9414,21248],["Xbox Airflo wired controller",s.Xbox360,9414,21251],["Xbox 360 Pro EX Controller",s.Xbox360,9414,21258],["PowerA Pro Ex",s.Xbox360,9414,21274],["FUS1ON Tournament Controller",s.Xbox360,9414,21399],["PowerA Xbox One Mini Wired Controller",s.XboxOne,9414,21530],["Xbox ONE spectra",s.XboxOne,9414,21546],["PowerA Xbox One wired controller",s.XboxOne,9414,21562],["Hori XBOX 360 EX 2 with Turbo",s.Xbox360,9414,21760],["Hori Real Arcade Pro VX-SA",s.Xbox360,9414,21761],["Hori Fighting Stick VX Alt",s.Xbox360,9414,21762],["Hori Fighting Edge",s.Xbox360,9414,21763],["Hori SOULCALIBUR V Stick",s.Xbox360,9414,21766],[" GEM Xbox controller",s.Xbox360,9414,21773],["Hori Real Arcade Pro V Kai 360",s.Xbox360,9414,21774],["PowerA FUSION Pro Controller",s.XboxOne,9414,21786],["PowerA FUSION Controller",s.XboxOne,9414,22042],["Thrustmaster",s.Xbox360,9414,23298],["Thrustmaster Ferrari 458 Racing Wheel",s.Xbox360,9414,23299],["Razer Sabertooth",s.Xbox360,9414,23812],["Rock Candy Gamepad for Xbox 360",s.Xbox360,9414,64254],["Stadia Controller",s.Xbox360,6353,37888]],this.currentGamepads=[]}addGamepadCallbacks(){this.instance.addListener(window,"gamepadconnected",this.onGamepadConnected.bind(this)),this.instance.addListener(window,"gamepaddisconnected",this.onGamepadDisconnected.bind(this))}onGamepadConnected(e){const t=new CustomEvent("gm-gamepadConnected",{detail:this.parseGamepad(e.gamepad)});window.dispatchEvent(t)}onGamepadDisconnected(e){const t=new CustomEvent("gm-gamepadDisconnected",{detail:this.parseGamepad(e.gamepad)});window.dispatchEvent(t),this.stopListeningInputs(e.gamepad.index)}getRawGamepads(){return navigator.getGamepads()}getGamepads(){const e=[],t=this.getRawGamepads();for(let i=0;i<t.length;i++)t[i]&&e.push(this.parseGamepad(t[i]));return e}getByGuestIndex(e){for(let t=0;t<this.currentGamepads.length;t++)if(this.currentGamepads[t].guestIndex===e)return this.getGamepads()[t]}getRawGamepadByGuestIndex(e){for(let t=0;t<this.currentGamepads.length;t++)if(this.currentGamepads[t].guestIndex===e)return this.getRawGamepads()[t]}getInfosFromID(e,t){return this.gamepadInfos.find(i=>i[2]===e&&i[3]===t)}listenForInputs(e,t){this.currentGamepads[e]={guestIndex:t,buttons:[],axes:[]},this.isRunning||this.loop()}stopListeningInputs(e){this.currentGamepads.splice(e,1)}computeValueInNewRange(e,t,i,n,s){const a=Math.abs(t-e);if(0===a)return i;return(s-e)*Math.abs(n-i)/a+i}loop(){if(0===this.currentGamepads.length)return void(this.isRunning=!1);this.isRunning=!0;const e=this.getRawGamepads();for(const t of e)if(t&&this.currentGamepads[t.index]){for(let e=0;e<t.buttons.length;e++){const i=this.currentGamepads[t.index].buttons.indexOf(e);if(!t.buttons[e].pressed||-1!==i&&6!==e&&7!==e){if(!t.buttons[e].pressed&&-1!==i){this.currentGamepads[t.index].buttons.splice(i,1);const n=new CustomEvent("gm-gamepadButtonReleased",{detail:{gamepadIndex:this.currentGamepads[t.index].guestIndex,buttonIndex:e,value:t.buttons[e].value}});window.dispatchEvent(n)}}else{-1===i&&this.currentGamepads[t.index].buttons.push(e);const n=new CustomEvent("gm-gamepadButtonPressed",{detail:{gamepadIndex:this.currentGamepads[t.index].guestIndex,buttonIndex:e,value:t.buttons[e].value}});window.dispatchEvent(n)}}for(let e=0;e<t.axes.length;e++)if(t.axes[e]!==this.currentGamepads[t.index].axes[e]){this.currentGamepads[t.index].axes[e]=t.axes[e];const i=new CustomEvent("gm-gamepadAxis",{detail:{gamepadIndex:this.currentGamepads[t.index].guestIndex,axisIndex:e,value:t.axes[e]}});window.dispatchEvent(i)}}window.requestAnimationFrame(this.loop.bind(this))}parseGamepad(e){var t;const i=-1!==navigator.userAgent.indexOf("Firefox"),n={hostIndex:e.index,name:e.id,power:"unknown",controllerType:s.Xbox360,vendor:"Default",vendorID:0,productID:0,state:e.connected?"plugged":"undefined",guestIndex:null===(t=this.currentGamepads[e.index])||void 0===t?void 0:t.guestIndex};if(i){const t=/^([0-9a-f]{1,4})-([0-9a-f]{1,4})-\s*(.*)\s*$/i,i=e.id.match(t);i&&(n.vendorID=Number("0x"+i[1]),n.productID=Number("0x"+i[2]),n.name=i[3])}else{const t=/(.+) \(((.+) )?Vendor: (.+) Product: (.+)\)/i,i=e.id.match(t);i&&(n.name=i[1],n.vendor=i[2],n.vendorID=Number("0x"+i[i.length-2]),n.productID=Number("0x"+i[i.length-1]))}const a=this.instance.gamepadManager.getInfosFromID(n.vendorID,n.productID);return a&&(n.name=a[0]+" ("+n.name+")",n.controllerType=a[1]),n}vibration(e,t,i){const s=this.getRawGamepadByGuestIndex(e);if(s)if(s.vibrationActuator){const a=s.vibrationActuator;if(a.playEffect){const e=this.computeValueInNewRange(0,255,0,1,t.toFixed(1)),n=this.computeValueInNewRange(0,255,0,1,i.toFixed(1));a.playEffect("dual-rumble",{startDelay:0,duration:200,weakMagnitude:e,strongMagnitude:n})}else n.error("could not use vibration actuator for controller "+e),n.debug(s)}else if(s.hapticActuators&&s.hapticActuators[0]){const t=s.hapticActuators[0];t.pulse?t.pulse(i,200):(n.error("could not use haptic actuator for controller "+e),n.debug(s))}else n.error("no vibration actuator for controller "+e)}}},{loglevel:99}],132:[function(e,t,i){const n=e("./util/OverlayPlugin"),s=e("./util/iothrottling-profiles");t.exports=class extends n{constructor(e,t){super(e),this.instance=e,this.i18n=t||{},this.instance.diskIO=this,this.fields={},this.renderToolbarButton(),this.renderWidget(),this.instance.registerEventCallback("BLK",this.setActive.bind(this)),this.instance.registerEventCallback("diskio",e=>{const t=e.split(" ");"readbyterate"===t[0]&&2===t.length&&this.updateDiskIOValues(t[1]/1048576)})}renderToolbarButton(){const e=this.instance.getChildByClass(this.instance.root,"gm-toolbar");if(!e)return;const t=e.children[0];this.toolbarBtn=document.createElement("li"),this.toolbarBtnImage=document.createElement("div"),this.toolbarBtnImage.className="gm-icon-button gm-iothrottling-button",this.toolbarBtnImage.title=this.i18n.IOTHROTTLING_TITLE||"Disk I/O",this.toolbarBtn.appendChild(this.toolbarBtnImage),this.toolbarBtn.onclick=this.toggleWidget.bind(this),t.appendChild(this.toolbarBtn)}renderWidget(){this.widget=document.createElement("div"),this.form=document.createElement("form");const e=document.createElement("div");e.className="gm-title",e.innerHTML=this.i18n.IOTHROTTLING_TITLE||"Disk I/O",this.form.appendChild(e);const t=document.createElement("div");t.className="gm-inputs";const i=this.i18n.IOTHROTTLING_PROFILE||"Profile";t.innerHTML="<label>"+i+"</label>",this.select=document.createElement("select"),this.select.className="gm-iothrottling-select";const n=new Option(this.i18n.IOTHROTTLING_PROFILE_NONE||"None");this.select.add(n),this.select.onchange=this.changeProfile.bind(this),t.appendChild(this.select),s.forEach(e=>{const t=new Option(e.label,e.name);this.select.add(t)}),this.readByteRateDiv=document.createElement("div"),this.readByteRateDiv.classList.add("gm-fields");const a=document.createElement("label");a.innerHTML=this.i18n.IOTHROTTLING_READ_BYTERATE||"Read speed limit:",this.readByteRate=document.createElement("input"),this.readByteRate.className="gm-iothrottling-readbyterate",this.readByteRate.placeholder=this.i18n.IOTHROTTLING_READ_BYTERATE_EXAMPLE||"eg: 100",this.readByteRate.title=this.i18n.READ_BYTE_RATE||"Read speed limit",this.readByteRate.required=!0,this.readByteRate.pattern="[0-9]*",this.readByteRateDiv.appendChild(a);const r=document.createElement("label");r.innerHTML=this.i18n.IOTHROTTLING_BYTERATE_UNIT||"MiB per sec",r.classList.add("gm-units"),this.readByteRateDiv.appendChild(r),this.readByteRateDiv.appendChild(this.readByteRate),this.submitBtn=document.createElement("button"),this.submitBtn.className="gm-iothrottling-update",this.submitBtn.innerHTML=this.i18n.IOTHROTTLING_UPDATE||"Update",this.submitBtn.onclick=this.sendDataToInstance.bind(this),this.clearCacheBtn=document.createElement("button"),this.clearCacheBtn.className="gm-iothrottling-clearcache",this.clearCacheBtn.innerHTML=this.i18n.IOTHROTTLING_CLEAR_CACHE||"Clear cache",this.clearCacheBtn.onclick=this.clearCache.bind(this);const o=document.createElement("div");o.appendChild(this.clearCacheBtn),this.form.appendChild(t),this.form.appendChild(this.readByteRateDiv),this.form.appendChild(o),this.form.appendChild(this.submitBtn),this.setFieldsReadOnly(!0),this.resetFields("0"),this.displayFields(!1),this.widget.className="gm-overlay gm-iothrottling-plugin gm-hidden";const c=document.createElement("div");c.className="gm-close-btn",c.onclick=this.toggleWidget.bind(this),this.widget.appendChild(c),this.widget.appendChild(this.form),this.overlays.push(this.widget),this.instance.root.appendChild(this.widget)}setFieldsReadOnly(e){this.readByteRate.readOnly=e}resetFields(e){e=void 0!==e?e:"",this.readByteRate.value=e}displayFields(e){e?this.readByteRateDiv.classList.remove("gm-hidden"):this.readByteRateDiv.classList.add("gm-hidden")}toggleWidget(){this.widget.classList.contains("gm-hidden")?(this.instance.emit("close-overlays"),this.instance.emit("keyboard-disable")):this.instance.emit("keyboard-enable"),this.widget.classList.toggle("gm-hidden"),this.toolbarBtnImage.classList.toggle("gm-active")}sendDataToInstance(e){if(e.preventDefault(),this.form.checkValidity()){const e={channel:"diskio",messages:["set readbyterate "+1048576*this.readByteRate.value,"clearcache"]};this.instance.sendEvent(e),this.toggleWidget()}}clearCache(e){e.preventDefault();this.instance.sendEvent({channel:"diskio",messages:["clearcache"]})}changeProfile(){const e=s.find(e=>e.name===this.select.value);e&&"Custom"!==e.name?(this.loadDetails(e),this.displayFields(!0)):e&&"Custom"===e.name?(this.setFieldsReadOnly(!1),this.displayFields(!0)):(this.resetFields("0"),this.displayFields(!1))}updateDiskIOValues(e){if(e=Number(e),Number.isNaN(e)||e<=0)return this.select.value=this.i18n.IOTHROTTLING_PROFILE_NONE||"None",this.resetFields("0"),void this.displayFields(!1);this.readByteRate.value=e;const t=s.find(t=>t.readByteRate===e);t&&"Custom"!==t.name?(this.select.value=t.name,this.loadDetails(t),this.displayFields(!0)):(this.select.value="Custom",this.setFieldsReadOnly(!1),this.displayFields(!0))}loadDetails(e){"Custom"!==e.name&&(this.setFieldsReadOnly(!0),this.readByteRate.value=e.readByteRate)}setActive(e){this.updateDiskIOValues(Number(e)/1024)}}},{"./util/OverlayPlugin":144,"./util/iothrottling-profiles":146}],133:[function(e,t,i){const n=e("./util/OverlayPlugin"),s="0123456789abcdef";t.exports=class extends n{constructor(e,t){super(e),this.instance=e,this.i18n=t||{},this.instance.identifiers=this,this.invalidAndroidId=!1,this.invalidDeviceId=!1,this.renderToolbarButton(),this.renderWidget(),this.instance.registerEventCallback("ANDROID_ID",e=>{this.androidInput.value=e}),this.instance.registerEventCallback("IMEI",e=>{this.deviceInput.value=e}),this.instance.registerEventCallback("settings",e=>{const t=e.split(" ");if("parameter"!==t[0]||t.length<2)return;const i=t[1].match(/(device_id:)(\w+)/);i&&(this.deviceInput.value=i[2]);const n=t[1].match(/(android_id:)(\w+)/);n&&(this.androidInput.value=n[2])})}renderToolbarButton(){const e=this.instance.getChildByClass(this.instance.root,"gm-toolbar");if(!e)return;const t=e.children[0];this.toolbarBtn=document.createElement("li"),this.toolbarBtnImage=document.createElement("div"),this.toolbarBtnImage.className="gm-icon-button gm-identifiers-button",this.toolbarBtnImage.title=this.i18n.IDENTIFIERS_TITLE||"Identifiers",this.toolbarBtn.appendChild(this.toolbarBtnImage),this.toolbarBtn.onclick=this.toggleWidget.bind(this),t.appendChild(this.toolbarBtn)}renderWidget(){this.widget=document.createElement("div"),this.container=document.createElement("div");const e=document.createElement("div");e.className="gm-title",e.innerHTML=this.i18n.IDENTIFIERS_TITLE||"Identifiers",this.container.appendChild(e);const t=document.createElement("div");t.className="gm-inputs";const i=this.generateInput("android","Android ID","",this.generateRandomAndroidId.bind(this),this.validateAndroidId.bind(this)),n=this.generateInput("device","Device ID","(IMEI/MEID)",this.generateRandomDeviceId.bind(this),this.validateDeviceId.bind(this));t.appendChild(i),t.appendChild(n),this.submitBtn=document.createElement("button"),this.submitBtn.innerHTML=this.i18n.IDENTIFIERS_UPDATE||"Update",this.submitBtn.className="gm-action gm-identifiers-update",t.appendChild(this.submitBtn),this.submitBtn.onclick=this.sendDataToInstance.bind(this),this.container.appendChild(t),this.widget.className="gm-overlay gm-identifiers-plugin gm-hidden";const s=document.createElement("div");s.className="gm-close-btn",s.onclick=this.toggleWidget.bind(this),this.widget.appendChild(s),this.widget.appendChild(this.container),this.overlays.push(this.widget),this.instance.root.appendChild(this.widget)}toggleWidget(){this.widget.classList.contains("gm-hidden")?(this.instance.emit("close-overlays"),this.instance.emit("keyboard-disable")):this.instance.emit("keyboard-enable"),this.widget.classList.toggle("gm-hidden"),this.toolbarBtnImage.classList.toggle("gm-active")}sendDataToInstance(e){e.preventDefault();const t=this.androidInput.value,i=this.deviceInput.value;if(t&&this.androidInput.checkValidity()){const e={channel:"framework",messages:["set parameter android_id:"+t]};this.instance.sendEvent(e)}if(i&&this.deviceInput.checkValidity()){const e={channel:"settings",messages:["set parameter device_id:"+i]};this.instance.sendEvent(e)}this.toggleWidget()}generateRandomAndroidId(e){e&&e.preventDefault(),this.androidInput.value=this.generateHash(16,s),this.invalidAndroidId=!1,this.checkErrors()}validateAndroidId(){this.invalidAndroidId=!this.androidInput.checkValidity(),this.checkErrors()}generateRandomDeviceId(e){e&&e.preventDefault(),this.deviceInput.value=this.generateHash(15,"0123456789"),this.invalidDeviceId=!1,this.checkErrors()}validateDeviceId(){this.invalidDeviceId=!this.deviceInput.checkValidity(),this.checkErrors()}checkErrors(){this.androidInput.classList[this.invalidAndroidId?"add":"remove"]("gm-error"),this.deviceInput.classList[this.invalidDeviceId?"add":"remove"]("gm-error"),this.submitBtn.disabled=this.invalidAndroidId||this.invalidDeviceId}generateInput(e,t,i,n,a){const r=document.createElement("div"),o=document.createElement("div"),c=document.createElement("input"),d=document.createElement("button");return o.className="gm-input-group",c.className="gm-identifier-"+e+"-input",c.type="text",c.required=!0,this.instance.addListener(c,"keyup",a),o.appendChild(c),"device"===e?(c.maxLength=15,c.pattern="["+s+"]{14,15}"):"android"===e&&(c.maxLength=16,c.pattern="["+s+"]{16}"),d.className="gm-identifier-"+e+"-generate",d.innerHTML=this.i18n.IDENTIFIERS_GENERATE||"Generate",d.onclick=n,o.appendChild(d),r.className="gm-identifier-"+e,r.innerHTML="<label>"+t+'<i class="gm-description">'+i+"</i></label>",r.appendChild(o),this[e+"Input"]=c,this[e+"Gen"]=d,r}generateHash(e,t){let i="";for(let n=0;n<e;n++)i+=t.charAt(Math.floor(Math.random()*t.length));return i}}},{"./util/OverlayPlugin":144}],134:[function(e,t,i){const n={8:"0x01000003",9:"0x01000001",13:"0x01000005",16:"0x01000020",17:"0x01000021",18:"0x01000023",20:"0x01000024",27:"0x01000000",32:"0x20",33:"0x01000016",34:"0x01000017",35:"0x01000011",36:"0x01000010",37:"0x01000012",38:"0x01000013",39:"0x01000014",40:"0x01000015",45:"0x01000006",46:"0x01000007"},s={67:"0x010000cf",86:"0x010000e2",88:"0x010000d0"};t.exports=class{constructor(e){this.instance=e,this.instance.keyboardEvents=this,this.instance.keyboardEventsEnabled=!0,this.transmitKeys=!0,this.isListenerAdded=!1,this.currentlyPressedKeys=new Map,this.instance.registerEventCallback("keyboard-disable",()=>{this.transmitKeys=!1}),this.instance.registerEventCallback("keyboard-enable",()=>{this.transmitKeys=!0})}cancelAllPressedKeys(){this.currentlyPressedKeys.forEach(e=>{const t={type:"KEYBOARD_RELEASE",keychar:"",keycode:e};this.instance.sendEvent(t)}),this.currentlyPressedKeys.clear()}onKeyPress(e){if(!this.transmitKeys)return;const t=e.charCode;let i=e.key||String.fromCharCode(t);"Spacebar"===i&&(i=" ");let n={type:"KEYBOARD_PRESS",keychar:i,keycode:t};this.instance.sendEvent(n),n={type:"KEYBOARD_RELEASE",keychar:i,keycode:t},this.instance.sendEvent(n)}onKeyDown(e){if(!this.transmitKeys)return!0;let t;if(s[e.keyCode]&&e.ctrlKey)t=parseInt(s[e.keyCode],16);else{if(s[e.keyCode]&&e.metaKey){t=parseInt(s[e.keyCode],16);let i={type:"KEYBOARD_PRESS",keychar:"",keycode:t};return this.instance.sendEvent(i),i={type:"KEYBOARD_RELEASE",keychar:"",keycode:t},this.instance.sendEvent(i),e.preventDefault(),e.stopPropagation(),e.returnValue=!1,!1}if(!n[e.keyCode])return!0;t=parseInt(n[e.keyCode],16)}const i={type:"KEYBOARD_PRESS",keychar:"",keycode:t};return this.instance.sendEvent(i),this.currentlyPressedKeys.set(t,t),e.preventDefault(),e.stopPropagation(),e.returnValue=!1,!1}onKeyUp(e){if(!this.transmitKeys)return!0;let t;if(s[e.keyCode]&&e.ctrlKey)t=parseInt(s[e.keyCode],16);else{if(!n[e.keyCode])return!0;t=parseInt(n[e.keyCode],16)}const i={type:"KEYBOARD_RELEASE",keychar:"",keycode:t};return this.instance.sendEvent(i),this.currentlyPressedKeys.delete(t),e.preventDefault(),e.stopPropagation(),e.returnValue=!1,!1}addKeyboardCallbacks(){this.instance.root.tabIndex=0,this.isListenerAdded||(this.removeBlurListener=this.instance.addListener(window,"blur",this.cancelAllPressedKeys.bind(this)),this.keyboardCallbacks||(this.keyboardCallbacks=[{event:"keypress",handler:this.onKeyPress.bind(this),removeListener:null},{event:"keydown",handler:this.onKeyDown.bind(this),removeListener:null},{event:"keyup",handler:this.onKeyUp.bind(this),removeListener:null}]),this.instance.root.focus(),this.keyboardCallbacks.forEach((e,t,i)=>{i[t].removeListener=this.instance.addListener(this.instance.root,e.event,e.handler)}),this.isListenerAdded=!0)}removeKeyboardCallbacks(){this.keyboardCallbacks&&this.isListenerAdded&&(this.removeBlurListener(),this.keyboardCallbacks.forEach(e=>{e.removeListener()}),this.isListenerAdded=!1)}}},{}],135:[function(e,t,i){const n=e("loglevel");n.setDefaultLevel("debug"),t.exports=class{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.options.microphone,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1280,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:720;if(this.instance=e,this.instance.mediaManager=this,!navigator.mediaDevices)return n.error("MediaDevices API unsupported: camera and microphone won't be available."),void(this.instance.mediaEventsEnabled=!1);this.setupPermissions(),this.instance.mediaEventsEnabled=!0,this.videoStreaming=!1,this.audioStreaming=!1,this.videoWidth=i,this.videoHeight=s,this.videoWithMicrophone=t}async setupPermissions(){if(!navigator.permissions)return!1;if(this.instance.options.microphone)try{const e=await navigator.permissions.query({name:"microphone"});n.debug("microphone "+e.state),this.microphonePermissionObject=e,this.instance.addListener(e,"change",this.onMicrophonePermissionChange.bind(this))}catch(e){return n.warn("Can't get microphone permission object",e),!1}try{const e=await navigator.permissions.query({name:"camera"});n.debug("camera "+e.state),this.cameraPermissionObject=e,this.instance.addListener(e,"change",this.onCameraPermissionChange.bind(this))}catch(e){return n.warn("Can't get camera permission object",e),!1}return!0}async toggleVideoStreaming(){return this.videoStreaming?this.stopVideoStreaming():this.startVideoStreaming()}async toggleAudioStreaming(){return this.audioStreaming?this.stopAudioStreaming():this.startAudioStreaming()}async startVideoStreaming(){if(!navigator.mediaDevices)return!1;try{const e=await navigator.mediaDevices.getUserMedia({audio:this.videoWithMicrophone,video:{width:this.videoWidth,height:this.videoHeight}});return n.debug("Client video stream ready"),this.videoStreaming=!0,this.localVideoStream=e,this.addVideoStream(e)}catch(e){return this.onVideoStreamError(e),!1}}async startAudioStreaming(){if(!navigator.mediaDevices)return!1;try{const e=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1});n.debug("Client audio stream ready"),this.audioStreaming=!0,this.localAudioStream=e;return await this.addAudioStream(e)}catch(e){return this.onAudioStreamError(e),!1}}onVideoStreamError(e){n.error("Can't start client video stream",e)}onAudioStreamError(e){n.error("Can't start client audio stream",e)}async stopVideoStreaming(){if(!this.videoStreaming)return!1;n.debug("removed local video stream");const e=await this.removeVideoStream(this.localVideoStream);return this.localVideoStream=null,this.videoStreaming=!1,e}async stopAudioStreaming(){if(!this.audioStreaming)return!1;n.debug("removed local audio stream");const e=await this.removeAudioStream(this.localAudioStream);return this.localAudioStream=null,this.audioStreaming=!1,e}onCameraPermissionChange(){window.dispatchEvent(new CustomEvent("gm-cameraPermissionChange"))}onMicrophonePermissionChange(){window.dispatchEvent(new CustomEvent("gm-microphopnePermissionChange"))}setTransceiverDirection(e,t){this.instance.peerConnection.getTransceivers().forEach(i=>{i.sender===e&&(i.direction=t)})}async addAudioStream(e){if(!this.instance.peerConnection)return n.error("Could not add audio stream: connection is not ready"),!1;try{this.instance.options.microphone&&e.getAudioTracks().length>0&&(this.microphoneSender?(n.debug("Replacing audio track on sender"),await this.microphoneSender.replaceTrack(e.getAudioTracks()[0]),this.setTransceiverDirection(this.microphoneSender,"sendrecv")):this.microphoneSender=this.instance.peerConnection.addTrack(e.getAudioTracks()[0],e))}catch(e){return n.error(e),!1}return this.instance.renegotiateWebRTCConnection()}async addVideoStream(e){return this.instance.peerConnection?(e.getVideoTracks().length>0&&(this.cameraSender?(n.debug("Replacing video track on sender"),this.cameraSender.replaceTrack(e.getVideoTracks()[0]),this.setTransceiverDirection(this.cameraSender,"sendrecv")):this.cameraSender=this.instance.peerConnection.addTrack(e.getVideoTracks()[0],e)),this.videoWithMicrophone&&e.getAudioTracks().length>0&&(this.microphoneSender?(n.debug("Replacing audio track on sender"),this.microphoneSender.replaceTrack(e.getAudioTracks()[0]),this.setTransceiverDirection(this.microphoneSender,"sendrecv")):this.microphoneSender=this.instance.peerConnection.addTrack(e.getAudioTracks()[0],e)),this.instance.renegotiateWebRTCConnection()):(n.error("Could not add video stream: connection is not ready"),!1)}async removeAudioStream(e){return this.instance.peerConnection?e instanceof MediaStream&&(e.getTracks().forEach(e=>{e.stop()}),this.microphoneSender&&this.instance.peerConnection.removeTrack(this.microphoneSender),this.instance.renegotiateWebRTCConnection()):(n.error("Could not remove audio stream: connection is not ready"),!1)}async removeVideoStream(e){return this.instance.peerConnection?e instanceof MediaStream&&(e.getTracks().forEach(e=>{e.stop()}),this.cameraSender&&this.instance.peerConnection.removeTrack(this.cameraSender),this.microphoneSender&&this.videoWithMicrophone&&this.instance.peerConnection.removeTrack(this.microphoneSender),this.instance.renegotiateWebRTCConnection()):(n.error("Could not remove video stream: connection is not ready"),!1)}disconnect(){this.audioStreaming&&this.stopAudioStreaming(),this.videoStreaming&&this.stopVideoStreaming(),this.cameraSender=null,this.microphoneSender=null}}},{loglevel:99}],136:[function(e,t,i){t.exports=class{constructor(e){this.instance=e,this.instance.mouseEvents=this,this.instance.mouseEventsEnabled=!0,this.leftButtonPressed=!1,this.boundEventListener=this.releaseAtPreviousPositionEvent.bind(this)}onMousePressEvent(e){if(this.instance.video.muted=!1,0!==e.button)return;e.preventDefault(),e.stopPropagation(),this.leftButtonPressed=!0,this.instance.x=this.instance.coordinateUtils.getXCoordinate(e),this.instance.y=this.instance.coordinateUtils.getYCoordinate(e);let t="";t=e.ctrlKey||e.metaKey?{type:"FAKE_MULTI_TOUCH_PRESS",mode:e.shiftKey?2:1,x:this.instance.x,y:this.instance.y}:{type:"MOUSE_PRESS",x:this.instance.x,y:this.instance.y},this.instance.sendEvent(t),this.removeMouseUpListener=this.instance.addListener(document,"mouseup",this.boundEventListener,!1)}onMouseReleaseEvent(e){if(0!==e.button)return;e.preventDefault(),e.stopPropagation(),this.leftButtonPressed=!1,this.instance.x=this.instance.coordinateUtils.getXCoordinate(e),this.instance.y=this.instance.coordinateUtils.getYCoordinate(e);let t="";t=e.ctrlKey||e.metaKey?{type:"FAKE_MULTI_TOUCH_RELEASE",mode:e.shiftKey?2:1,x:this.instance.x,y:this.instance.y}:{type:"MOUSE_RELEASE",x:this.instance.x,y:this.instance.y},this.instance.sendEvent(t),this.removeMouseUpListener()}releaseAtPreviousPositionEvent(e){if(0!==e.button)return;e.preventDefault(),e.stopPropagation(),this.leftButtonPressed=!1;const t={type:e.ctrlKey||e.metaKey?"FAKE_MULTI_TOUCH_RELEASE":"MOUSE_RELEASE",x:this.instance.x,y:this.instance.y};this.instance.sendEvent(t),this.instance.removeMouseUpListener()}onMouseMoveEvent(e){if(!this.leftButtonPressed)return;e.preventDefault(),e.stopPropagation(),this.instance.x=this.instance.coordinateUtils.getXCoordinate(e),this.instance.y=this.instance.coordinateUtils.getYCoordinate(e);const t={type:"MOUSE_MOVE",x:this.instance.x,y:this.instance.y};this.instance.sendEvent(t)}onMouseWheelEvent(e){e.preventDefault(),e.stopPropagation(),this.instance.x=this.instance.coordinateUtils.getXCoordinate(e),this.instance.y=this.instance.coordinateUtils.getYCoordinate(e);const t=this.getWheelDeltaPixels(e.deltaY,e.deltaMode),i={type:"WHEEL",x:this.instance.x,y:this.instance.y,delta:t};this.instance.sendEvent(i)}cancelContextMenu(e){e.preventDefault(),e.stopPropagation(),e.returnValue=!1}addMouseCallbacks(){this.instance.addListener(this.instance.videoWrapper,"mousedown",this.onMousePressEvent.bind(this),!1),this.instance.addListener(this.instance.videoWrapper,"mouseup",this.onMouseReleaseEvent.bind(this),!1),this.instance.addListener(this.instance.videoWrapper,"mousemove",this.onMouseMoveEvent.bind(this),!1),this.instance.addListener(this.instance.videoWrapper,"wheel",this.onMouseWheelEvent.bind(this),{passive:!1}),this.instance.addListener(this.instance.videoWrapper,"contextmenu",this.cancelContextMenu.bind(this),!1)}getWheelDeltaPixels(e,t){let i=1*e;return i&&t&&(i*=1===t?40:800),i}}},{}],137:[function(e,t,i){t.exports=class{constructor(e){this.instance=e,this.instance.touchEvents=this,this.instance.touchEventsEnabled=!0}onScreenTouchStart(e){e.preventDefault(),e.stopPropagation();const t={type:"MULTI_TOUCH",nb:e.targetTouches.length,mode:0,points:[]};for(let i=0;i<e.targetTouches.length;i++){const n=e.targetTouches[i];this.instance.x=this.instance.coordinateUtils.getXCoordinate(n),this.instance.y=this.instance.coordinateUtils.getYCoordinate(n),t.points.push({x:this.instance.x,y:this.instance.y})}this.instance.sendEvent(t)}onScreenTouchMove(e){e.preventDefault(),e.stopPropagation();const t={type:"MULTI_TOUCH",nb:e.targetTouches.length,mode:2,points:[]};for(let i=0;i<e.targetTouches.length;i++){const n=e.targetTouches[i];this.instance.x=this.instance.coordinateUtils.getXCoordinate(n),this.instance.y=this.instance.coordinateUtils.getYCoordinate(n),t.points.push({x:this.instance.x,y:this.instance.y})}this.instance.sendEvent(t)}onScreenTouchEnd(e){e.preventDefault(),e.stopPropagation();const t={type:"MULTI_TOUCH",nb:e.targetTouches.length,mode:1,points:[]};for(let i=0;i<e.targetTouches.length;i++){const n=e.targetTouches[i];this.instance.x=this.instance.coordinateUtils.getXCoordinate(n),this.instance.y=this.instance.coordinateUtils.getYCoordinate(n),t.points.push({x:this.instance.x,y:this.instance.y})}this.instance.sendEvent(t)}addTouchCallbacks(){this.instance.addListener(this.instance.videoWrapper,"touchstart",this.onScreenTouchStart.bind(this),!1),this.instance.addListener(this.instance.videoWrapper,"touchend",this.onScreenTouchEnd.bind(this),!1),this.instance.addListener(this.instance.videoWrapper,"touchmove",this.onScreenTouchMove.bind(this),!1)}}},{}],138:[function(e,t,i){const n=e("loglevel");n.setDefaultLevel("debug");const s=e("./util/OverlayPlugin"),a=e("./util/network-profiles"),r=e("./util/network-mobile-profiles"),o=e("./util/mobile-signal-strength");t.exports=class extends s{constructor(e,t){super(e),this.instance=e,this.instance.network=this,this.i18n=t||{},this.mobilethrottling=!1,this.fields={},this.renderToolbarButton(),this.renderWidget(),this.mobileThrottlingConfigured=!1,this.network5GConfigured=!1,this.wifiInputChecked=!0,this.mobileInputChecked=!0,this.instance.registerEventCallback("settings",this.handleSettings.bind(this)),this.instance.registerEventCallback("NETWORK",this.setActiveProfile.bind(this)),this.instance.registerEventCallback("network_profile",this.handleNetworkProfile.bind(this))}enableMobileThrottling(){if(this.mobileThrottlingConfigured)return;this.mobilethrottling=!0;const e=document.createElement("div");this.wifiInput=document.createElement("input"),this.wifiStatus=document.createElement("div"),e.className="gm-checkbox-group",this.wifiInput.type="checkbox",this.wifiInput.className="gm-checkbox",this.wifiInput.name="wifi-checkbox",this.wifiInput.onchange=this.toggleWifiState.bind(this),this.wifiInput.checked=this.wifiInputChecked,this.wifiStatus.className="gm-checkbox-label",this.wifiStatus.innerHTML="Wifi",e.appendChild(this.wifiInput),e.appendChild(this.wifiStatus),this.wifiGroupSection.className="gm-section",this.wifiGroupSection.appendChild(e);const t=document.createElement("div");this.mobileInput=document.createElement("input"),this.mobileStatus=document.createElement("div"),t.className="gm-checkbox-group",this.mobileInput.type="checkbox",this.mobileInput.className="gm-checkbox",this.mobileInput.name="mobile-checkbox",this.mobileInput.onchange=this.toggleMobileState.bind(this),this.mobileInput.checked=this.mobileInputChecked,this.mobileStatus.className="gm-checkbox-label",this.mobileStatus.innerHTML="Mobile data",t.appendChild(this.mobileInput),t.appendChild(this.mobileStatus),this.mobileGroupSection.appendChild(t);const i=document.createElement("div");i.className="input_label",i.innerHTML="Network type:",this.profileInputs.appendChild(i),this.selectMobileProfile=document.createElement("select"),this.selectMobileProfile.name="select-mobile-profile",this.selectMobileProfile.onchange=this.changeMobileProfile.bind(this),r.slice().reverse().forEach(e=>{if("5g"===e.name)return;const t=new Option(e.label,e.name);this.selectMobileProfile.add(t)}),this.profileInputs.appendChild(this.selectMobileProfile);const n=document.createElement("div");n.className="input_label",n.innerHTML="Signal strength:",this.inputMobileSignalStrength.appendChild(n),this.selectMobileSignalStrength=document.createElement("select"),this.selectMobileSignalStrength.name="select-mobile-signal-strength",this.selectMobileSignalStrength.onchange=this.changeMobileSignalStrength.bind(this),this.inputMobileSignalStrength.appendChild(this.selectMobileSignalStrength),o.slice().reverse().forEach(e=>{const t=new Option(e.label,e.name);this.selectMobileSignalStrength.add(t)}),this.updateMobileSectionStatus(),this.mobileThrottlingConfigured=!0}disableMobileThrottling(){if(this.mobileThrottlingConfigured)return;this.mobilethrottling=!1,this.selectProfile=document.createElement("select"),this.selectProfile.name="select-profile";const e=new Option(this.i18n.NETWORK_DELECT_PROFILE||"Select a profile");this.selectProfile.add(e),this.selectProfile.onchange=this.changeProfile.bind(this),a.slice().reverse().forEach(e=>{const t=new Option(e.label,e.name);this.selectProfile.add(t)}),this.profileInputs.appendChild(this.selectProfile),this.mobileThrottlingConfigured=!0}enable5G(){if(this.network5GConfigured)return;const e=r.at(0),t=new Option(e.label,e.name);this.selectMobileProfile.add(t),this.network5GConfigured=!0}disable5G(){this.network5GConfigured||(this.network5GConfigured=!0)}handleSettings(e){const t=e.split(" ");if("if"===t[0]){if(this.wifiInput&&(this.wifiInput.disabled=!1),this.mobileInput&&(this.mobileInput.disabled=!1),3!==t.length)return;const e=t[1].match(/(wifi:)(\w+)/);e&&(this.wifiInputChecked="on"===e[2]);const i=t[2].match(/(mobile:)(\w+)/);i&&(this.mobileInputChecked="on"===i[2]),this.wifiInput&&(this.wifiInput.checked=this.wifiInputChecked),this.mobileInput&&(this.mobileInput.checked=this.mobileInputChecked),this.updateMobileSectionStatus()}}handleNetworkProfile(e){const t=e.split(" ");if(!this.mobilethrottling&&(t.length<9||"phone"===t[1]))return;if(this.mobilethrottling&&(t.length<11||"wifi"===t[1]))return;const i=t[2].split(":"),n=t[3].split(":"),s=t[4].split(":"),r=t[5].split(":"),o=t[6].split(":"),c=t[7].split(":"),d=t[8].split(":");if(this.mobilethrottling){const e=t[9].split(":"),a=t[10].split(":");this.setActiveMobileProfile(e[1]),this.setActiveSignalStrength(a[1]),this.updateDetail("downSpeed",n[2]+" b/s","disabled"===n[1]||!this.mobileInput.checked),this.updateDetail("upSpeed",i[2]+"b/s","disabled"===i[1]||!this.mobileInput.checked),this.updateDetail("downDelay",r[2]+" s","disabled"===r[1]||!this.mobileInput.checked),this.updateDetail("upDelay",s[2]+" s","disabled"===s[1]||!this.mobileInput.checked),this.updateDetail("downPacketLoss",c[2]+" %","disabled"===c[1]||!this.mobileInput.checked),this.updateDetail("upPacketLoss",o[2]+" %","disabled"===o[1]||!this.mobileInput.checked),this.updateDetail("dnsDelay",d[2]+" s","disabled"===d[1]||!this.mobileInput.checked)}else{const e="enabled"===i[1]&&"enabled"===n[1]&&"enabled"===s[1]&&"enabled"===r[1]&&"enabled"===o[1]&&"enabled"===c[1]&&"enabled"===d[1],t=a.find(e=>e.downSpeed.value===parseFloat(n[2])&&e.downDelay.value===parseFloat(r[2])&&e.downPacketLoss.value===parseFloat(c[2])&&e.upSpeed.value===parseFloat(i[2])&&e.upDelay.value===parseFloat(s[2])&&e.upPacketLoss.value===parseFloat(o[2])&&e.dnsDelay.value===parseFloat(d[2]));this.selectProfile.value=t&&e?t.name:this.i18n.NETWORK_DELECT_PROFILE||"Select a profile"}}renderToolbarButton(){const e=this.instance.getChildByClass(this.instance.root,"gm-toolbar");if(!e)return;const t=e.children[0];this.toolbarBtn=document.createElement("li"),this.toolbarBtnImage=document.createElement("div"),this.toolbarBtnImage.className="gm-icon-button gm-network-button",this.toolbarBtnImage.title=this.i18n.NETWORK_TITLE||"Network",this.toolbarBtn.appendChild(this.toolbarBtnImage),this.toolbarBtn.onclick=this.toggleWidget.bind(this),t.appendChild(this.toolbarBtn)}renderWidget(){this.widget=document.createElement("div"),this.form=document.createElement("form");const e=document.createElement("div");e.className="gm-title",e.innerHTML=this.i18n.NETWORK_TITLE||"Network",this.form.appendChild(e),this.wifiGroupSection=document.createElement("div"),this.form.appendChild(this.wifiGroupSection),this.mobileGroupSection=document.createElement("div"),this.form.appendChild(this.mobileGroupSection),this.profileInputs=document.createElement("div"),this.profileInputs.className="gm-inputs",this.form.appendChild(this.profileInputs),this.inputMobileSignalStrength=document.createElement("div"),this.inputMobileSignalStrength.className="gm-inputs",this.form.appendChild(this.inputMobileSignalStrength),this.profileDetails=document.createElement("div"),this.profileDetails.className="gm-profile-details gm-hidden",this.profileDetails.appendChild(this.createDetailsSection("Download speed","downSpeed")),this.profileDetails.appendChild(this.createDetailsSection("Upload speed","upSpeed")),this.profileDetails.appendChild(this.createDetailsSection("Download delay","downDelay")),this.profileDetails.appendChild(this.createDetailsSection("Upload delay","upDelay")),this.profileDetails.appendChild(this.createDetailsSection("Download packet loss","downPacketLoss")),this.profileDetails.appendChild(this.createDetailsSection("Upload packet loss","upPacketLoss")),this.profileDetails.appendChild(this.createDetailsSection("DNS Delay","dnsDelay")),this.form.appendChild(this.profileDetails),this.widget.className="gm-overlay gm-network-plugin gm-hidden";const t=document.createElement("div");t.className="gm-close-btn",t.onclick=this.toggleWidget.bind(this),this.widget.appendChild(t),this.widget.appendChild(this.form),this.overlays.push(this.widget),this.instance.root.appendChild(this.widget)}toggleWidget(){this.widget.classList.contains("gm-hidden")?(this.instance.emit("close-overlays"),this.instance.emit("keyboard-disable")):this.instance.emit("keyboard-enable"),this.widget.classList.toggle("gm-hidden"),this.toolbarBtnImage.classList.toggle("gm-active")}changeProfile(){const e=a.find(e=>e.name===this.selectProfile.value);e?(this.loadDetails(e),this.profileDetails.classList.remove("gm-hidden"),this.sendDataToInstance()):this.profileDetails.classList.add("gm-hidden")}sendDataToInstance(){const e=a.find(e=>e.name===this.selectProfile.value);if(e){const t=[];0===e.id?t.push("disable wifi all"):(t.push("enable wifi all"),t.push("set wifi up_rate "+e.upSpeed.value),t.push("set wifi down_rate "+e.downSpeed.value),t.push("set wifi up_delay "+e.upDelay.value),t.push("set wifi down_delay "+e.downDelay.value),t.push("set wifi up_pkt_loss "+e.upPacketLoss.value),t.push("set wifi down_pkt_loss "+e.downPacketLoss.value),t.push("set wifi dns_delay "+e.dnsDelay.value));const i={channel:"network_profile",messages:t};this.instance.sendEvent(i)}}changeMobileProfile(){const e=r.find(e=>e.name===this.selectMobileProfile.value);if(e){const t=[];t.push("setprofile mobile "+e.name);const i={channel:"network_profile",messages:t};this.instance.sendEvent(i)}else n.error("Selected profile not found")}changeMobileSignalStrength(){const e=o.find(e=>e.name===this.selectMobileSignalStrength.value);if(e){const t=[];t.push("setsignalstrength mobile "+e.name);const i={channel:"network_profile",messages:t};this.instance.sendEvent(i)}else n.error("Selected signalStrength not found")}toggleWifiState(){this.wifiInput.disabled=!0;const e=[];this.wifiInput.checked?e.push("enableif wifi"):e.push("disableif wifi");const t={channel:"settings",messages:e};this.instance.sendEvent(t)}toggleMobileState(){this.mobileInput.disabled=!0,this.updateMobileSectionStatus();const e=[];this.mobileInput.checked?e.push("enableif mobile"):e.push("disableif mobile");const t={channel:"settings",messages:e};this.instance.sendEvent(t);this.instance.sendEvent({channel:"network_profile",messages:["notify phone"]})}updateMobileSectionStatus(){this.selectMobileProfile&&(this.selectMobileProfile.disabled=!this.mobileInput.checked),this.selectMobileSignalStrength&&(this.selectMobileSignalStrength.disabled=!this.mobileInput.checked)}createDetailsSection(e,t){const i=document.createElement("section");return this.fields[t]=document.createElement("span"),i.innerHTML=e+": ",i.appendChild(this.fields[t]),i}loadDetails(e){Object.entries(e).forEach(e=>{let[t,i]=e;"label"!==t&&"name"!==t&&"id"!==t&&(this.fields[t].innerHTML=i.label)})}setActiveProfile(e){const t=a.find(t=>t.id===Number(e));if(!t||!String(e).length)return;const i=this.selectProfile.getElementsByTagName("option");for(let e=0;e<i.length;e++){const n=i[e];n.value===t.name&&(n.selected="selected")}this.loadDetails(t)}setActiveMobileProfile(e){if(!e)return void n.error("setActiveMobileProfile: Error : provided profile is empty");const t=r.find(t=>t.name===e);if(!t)return void n.error("setActiveMobileProfile: Error : unknown provided profile");const i=this.selectMobileProfile.getElementsByTagName("option");for(let e=0;e<i.length;e++){const n=i[e];if(n.value===t.name){n.selected="selected";break}}}setActiveSignalStrength(e){if(!e)return void n.error("setActiveSignalStrength: Error : provided strength is empty");const t=o.find(t=>t.name===e);if(!t)return void n.error("setActiveSignalStrength: Error : unknown provided strength");const i=this.selectMobileSignalStrength.getElementsByTagName("option");for(let e=0;e<i.length;e++){const n=i[e];if(n.value===t.name){n.selected="selected";break}}}updateDetail(e,t,i){this.fields[e].innerHTML=i?"":t}}},{"./util/OverlayPlugin":144,"./util/mobile-signal-strength":147,"./util/network-mobile-profiles":148,"./util/network-profiles":149,loglevel:99}],139:[function(e,t,i){t.exports=class{constructor(e,t,i){this.instance=e,this.instance.peerConnectionStats=this,this.connection=t,this.timeoutID=setTimeout(()=>{this.connection.getStats(null).then(e=>{e.forEach(t=>{if("video"===t.kind){if("inbound-rtp"===t.type){const i=e.get(t.codecId);i&&this.logAndBroadcast("codec",i.mimeType)}"track"===t.type&&(this.logAndBroadcast("width",t.frameWidth),this.logAndBroadcast("height",t.frameHeight),this.logAndBroadcast("jitter",Math.round(t.jitterBufferDelay/t.jitterBufferEmittedCount*1e3)))}if("candidate-pair"===t.type&&"succeeded"===t.state){this.logAndBroadcast("rtt",1e3*t.currentRoundTripTime);const i=e.get(t.localCandidateId);this.hideDefaultTurnWarning(),i&&"relay"===i.candidateType?(this.logAndBroadcast("turn",!0),this.instance.options.turn.default?(this.logAndBroadcast("default",!0),this.displayDefaultTurnWarning()):this.logAndBroadcast("default",!1)):this.logAndBroadcast("turn",!1)}})})},i)}logAndBroadcast(e,t){this.instance.dispatchEvent(e,{msg:t})}displayDefaultTurnWarning(){let e="<h1><span>&#9888;</span> Using a default TURN</h1>Performance is not optimal.";const t=document.createElement("a");t.classList.add("gm-default-turn-button"),t.classList.add("gm-icon-button");const i=document.createElement("div");i.className="gm-default-turn-used gm-hidden",this.instance.options.connectionFailedURL&&(e+="<br>Click on the icon to learn more.",t.href=this.instance.options.connectionFailedURL,t.target="_blank"),i.innerHTML=e,t.appendChild(i),t.onmouseenter=()=>{i.classList.remove("gm-hidden")},t.onmouseleave=()=>{i.classList.add("gm-hidden")};this.instance.getChildByClass(this.instance.root,"gm-toolbar").appendChild(t)}hideDefaultTurnWarning(){const e=this.instance.getChildByClass(this.instance.root,"gm-default-turn-button");e&&e.remove()}destroy(){clearTimeout(this.timeoutID),delete this.connection,delete this.instance}}},{}],140:[function(e,t,i){const n=e("./util/OverlayPlugin");t.exports=class extends n{constructor(e,t){super(e),this.instance=e,this.i18n=t||{},this.instance.phone=this,this.renderToolbarButton(),this.renderWidget()}renderToolbarButton(){const e=this.instance.getChildByClass(this.instance.root,"gm-toolbar");if(!e)return;const t=e.children[0];this.toolbarBtn=document.createElement("li"),this.toolbarBtnImage=document.createElement("div"),this.toolbarBtnImage.className="gm-icon-button gm-phone-button",this.toolbarBtnImage.title=this.i18n.PHONE_TITLE||"Phone",this.toolbarBtn.appendChild(this.toolbarBtnImage),this.toolbarBtn.onclick=this.toggleWidget.bind(this),t.appendChild(this.toolbarBtn)}renderWidget(){this.widget=document.createElement("div"),this.container=document.createElement("div");const e=document.createElement("div");e.className="gm-title",e.innerHTML=this.i18n.PHONE_TITLE||"Phone",this.container.appendChild(e);const t=document.createElement("div");t.className="gm-inputs";const i=document.createElement("div");this.phoneInput=document.createElement("input"),this.phoneBtn=document.createElement("button"),this.phoneInput.type="text",this.phoneInput.className="gm-phone-number",this.phoneInput.placeholder=this.i18n.PHONE_CALL_PLACEHOLDER||"Please enter the phone number",this.instance.addListener(this.phoneInput,"keyup",this.validate.bind(this)),this.phoneBtn.className="gm-phone-call",this.phoneBtn.innerHTML=this.i18n.PHONE_CALL||"Call",this.phoneBtn.onclick=this.sendPhoneCallToInstance.bind(this),this.phoneBtn.disabled=!0;const n=this.i18n.PHONE_INCOMING||"Incoming phone number";i.innerHTML="<label>"+n+"</label>",i.className="gm-phone-group",i.appendChild(this.phoneInput),i.appendChild(this.phoneBtn),t.appendChild(i);const s=document.createElement("div");this.textInput=document.createElement("textarea"),this.textBtn=document.createElement("button"),this.textInput.className="gm-phone-message",this.textInput.placeholder=this.i18n.PHONE_MESSAGE_PLACEHOLDER||"Please enter the incoming message",this.textInput.rows=5,this.instance.addListener(this.textInput,"keyup",this.validate.bind(this)),this.textBtn.className="gm-phone-send",this.textBtn.innerHTML=this.i18n.PHONE_MESSAGE||"Send message",this.textBtn.onclick=this.sendSMSToInstance.bind(this),this.textBtn.disabled=!0;const a=this.i18n.PHONE_MESSAGE_VALUE||"Message";s.innerHTML="<label>"+a+"</label>",s.className="gm-phone-group",s.appendChild(this.textInput),s.appendChild(this.textBtn),t.appendChild(s),this.container.appendChild(t),this.widget.className="gm-overlay gm-phone-plugin gm-hidden";const r=document.createElement("div");r.className="gm-close-btn",r.onclick=this.toggleWidget.bind(this),this.widget.appendChild(r),this.widget.appendChild(this.container),this.overlays.push(this.widget),this.instance.root.appendChild(this.widget)}toggleWidget(){this.widget.classList.contains("gm-hidden")?(this.instance.emit("close-overlays"),this.instance.emit("keyboard-disable")):this.instance.emit("keyboard-enable"),this.widget.classList.toggle("gm-hidden"),this.toolbarBtnImage.classList.toggle("gm-active")}validatePhoneNumber(){return this.phoneInput.value.match(/^(\+[0-9]{1,14}|[0-9]{1,16})$/g)}sendPhoneCallToInstance(e){if(e&&e.preventDefault(),!this.validatePhoneNumber())return;const t={channel:"baseband",messages:["gsm call "+this.phoneInput.value]};this.instance.sendEvent(t),this.toggleWidget()}validateSMSText(){return this.textInput.value.length>0}sendSMSToInstance(e){if(e&&e.preventDefault(),!this.validatePhoneNumber()||!this.validateSMSText())return;const t={channel:"baseband",messages:["sms send "+this.phoneInput.value+" "+this.textInput.value]};this.instance.sendEvent(t),this.toggleWidget()}validate(){const e=this.validatePhoneNumber(),t=this.validateSMSText()&&e;return this.phoneBtn.disabled=!e,this.textBtn.disabled=!t,t}}},{"./util/OverlayPlugin":144}],141:[function(e,t,i){const n=e("./util/OverlayPlugin"),s=e("loglevel");s.setDefaultLevel("debug");t.exports=class extends n{constructor(e,t){super(e),this.instance=e,this.i18n=t||{},this.instance.screencast=this,this.renderToolbarButton(),this.renderWidget(),this.recordedBlobs=[],this.mediaRecorder=null,this.isRecording=!1,this.startTime=0,this.displayInterval=null}handleDataAvailable(e){e.data&&e.data.size>0&&this.recordedBlobs.push(e.data)}getExtensionFromMimeType(e){let t={"video/x-msvideo":".avi","video/mpeg":".mpeg","video/ogg":".ogv","video/webm":".webm","video/3gpp":".3gp","video/3gpp2":".3g2","video/mp4":".mp4","video/x-matroska":".mkv","video/x-flv":".f4v"}[e.toLowerCase()];return t||(s.warn("Unknown MIME type: ",e),t=".webm"),t}downloadScreencast(){const e=new Blob(this.recordedBlobs,{type:this.mediaRecorder.mimeType}),t=window.URL.createObjectURL(e),i=document.createElement("a");i.style.display="none",i.href=t,i.download="device"+this.getExtensionFromMimeType(this.mediaRecorder.mimeType),document.body.appendChild(i),i.click(),setTimeout(()=>{document.body.removeChild(i),window.URL.revokeObjectURL(t)},100),this.isRecording=!1}checkForMediarecorder(){"undefined"==typeof MediaRecorder&&(this.screencast.classList.add("disabled"),this.screencastBtn.title=this.i18n.SCREENCAST_NOMEDIARECORDER_TOOLTIP||"Screencast not supported")}displayTimer(){this.timer.classList.contains("gm-timer-hidden")&&(this.timer.classList.remove("gm-timer-hidden"),this.displayInterval=setInterval(this.displayTimer.bind(this),1e3));let e=new Date-this.startTime;e/=1e3;const t=Math.round(e%60);e=Math.floor(e/60);const i=Math.round(e%60);this.timer.innerHTML=("0"+i).slice(-2)+":"+("0"+t).slice(-2),3===i&&this.stopRecording()}hideTimer(){clearInterval(this.displayInterval),this.timer.classList.add("gm-timer-hidden"),this.timer.innerHTML=""}findBestMimeType(){const e=[];return["video/webm","video/x-matroska","video/mpeg","video/ogg","video/3gpp","video/3gpp2","video/mp4","video/x-flv"].forEach(t=>{MediaRecorder.isTypeSupported(t)&&e.push(t)}),e[0]}startRecording(){try{this.mediaRecorder=new MediaRecorder(this.instance.stream,{mimeType:this.findBestMimeType()})}catch(e){return s.error("Error while creating MediaRecorder: "+e),this.hideTimer(),void this.toolbarBtnImage.classList.remove("gm-screencast-button-recording")}this.recordedBlobs=[],this.isRecording=!0,this.startTime=new Date,this.displayTimer(),this.mediaRecorder.ondataavailable=this.handleDataAvailable.bind(this),this.mediaRecorder.start(50),s.debug("MediaRecorder started",this.mediaRecorder)}stopRecording(){this.mediaRecorder.stop(),this.hideTimer(),this.toolbarBtnImage.classList.remove("gm-screencast-button-recording"),this.downloadScreencast(),s.debug("MediaRecorder stopped",this.mediaRecorder)}renderToolbarButton(){const e=this.instance.getChildByClass(this.instance.root,"gm-toolbar");if(!e)return;const t=e.children[0];this.toolbarBtn=document.createElement("li"),this.toolbarBtnImage=document.createElement("div"),this.toolbarBtnImage.className="gm-icon-button gm-screencast-button",this.toolbarBtnImage.title=this.i18n.SCREENCAST_TITLE||"Screencast",this.timer=document.createElement("div"),this.timer.className="gm-screencast-timer gm-timer-hidden",this.toolbarBtnImage.appendChild(this.timer),this.toolbarBtn.appendChild(this.toolbarBtnImage),this.toolbarBtn.onclick=this.toggleWidget.bind(this),t.appendChild(this.toolbarBtn)}renderWidget(){this.widget=document.createElement("div"),this.form=document.createElement("form");const e=document.createElement("div");e.className="gm-title",e.innerHTML=this.i18n.SCREENCAST_TITLE||"Screencast",this.form.appendChild(e);const t=document.createElement("div");t.className="gm-inputs";const i=document.createElement("div");this.screenshotBtn=document.createElement("div"),this.screenshotBtn.className="gm-action gm-screencast-screenshot",i.onclick=this.onScreenshotClick.bind(this),i.className="gm-horizontal gm-screenshot";const n=this.i18n.SCREENCAST_SCREENSHOT||"Screenshot";i.innerHTML="<label>"+n+"</label>",i.appendChild(this.screenshotBtn),t.appendChild(i),this.screencast=document.createElement("div"),this.screencastBtn=document.createElement("div"),this.screencastBtn.className="gm-action gm-screencast-screencast",this.screencast.onclick=this.onScreencastClick.bind(this),this.screencast.className="gm-horizontal gm-screencast";const s=this.i18n.SCREENCAST_SCREENCAST||"Screencast";this.screencast.innerHTML="<label>"+s+"</label>",this.screencast.appendChild(this.screencastBtn),t.appendChild(this.screencast),this.form.appendChild(t),this.widget.className="gm-overlay gm-screencast-plugin gm-hidden";const a=document.createElement("div");a.className="gm-close-btn",a.onclick=this.toggleWidget.bind(this),this.widget.appendChild(a),this.widget.appendChild(this.form),this.overlays.push(this.widget),this.instance.root.appendChild(this.widget)}toggleWidget(e){this.checkForMediarecorder(),this.isRecording?this.stopRecording():(this.widget.classList.contains("gm-hidden")?(this.instance.emit("close-overlays"),this.instance.emit("keyboard-disable")):this.instance.emit("keyboard-enable"),this.widget.classList.toggle("gm-hidden"),this.toolbarBtnImage.classList.toggle("gm-active"),!0===e&&this.toolbarBtnImage.classList.add("gm-screencast-button-recording"))}onScreenshotClick(e){e.preventDefault(),this.toggleWidget();const t=document.createElement("canvas"),i=t.getContext("2d"),{video:n}=this.instance;if(t.width=n.videoWidth,t.height=n.videoHeight,!(i&&n instanceof HTMLVideoElement))return;i.drawImage(n,0,0,n.videoWidth,n.videoHeight,0,0,n.videoWidth,n.videoHeight);const s=document.createElement("a");s.download="device-screenshot.png",document.body.appendChild(s);let a=t.toDataURL("image/png");a&&(a=a.replace(/^data:image\/[^;]*/,"data:application/octet-stream")),s.href=a,s.click(),setTimeout(()=>{document.body.removeChild(s)},100)}onScreencastClick(){this.isRecording?this.stopRecording():(this.toggleWidget(!0),this.startRecording())}}},{"./util/OverlayPlugin":144,loglevel:99}],142:[function(e,t,i){t.exports=class{constructor(e,t){this.instance=e,this.instance.StreamBitrate=this,this.i18n=t||{},this.highQuality=!1,this.renderToolbarButton()}renderToolbarButton(){const e=this.instance.getChildByClass(this.instance.root,"gm-toolbar");if(!e)return;const t=e.children[0],i=document.createElement("li");this.chooser=document.createElement("div"),this.chooser.className=".gm-streamrate-chooser gm-icon-button gm-streamrate-button",this.chooser.title=this.i18n.STREAMRATE_TITLE||"High quality",i.appendChild(this.chooser),t.appendChild(i),this.chooser.onclick=()=>{if(this.highQuality=!this.highQuality,this.chooser.classList.toggle("gm-active"),this.highQuality){const e={type:"BITRATE",videoBitrate:5e3,audioBitrate:192e3};this.instance.sendEvent(e),this.instance.renegotiateWebRTCConnection()}else{const e={type:"BITRATE",videoBitrate:0,audioBitrate:0};this.instance.sendEvent(e),this.instance.renegotiateWebRTCConnection()}}}}},{}],143:[function(e,t,i){const n=[{text:"-",value:"0"},{text:"240p",value:"240"},{text:"360p",value:"360"},{text:"480p",value:"480"},{text:"720p",value:"720"},{text:"1080p",value:"1080"}];t.exports=class{constructor(e,t){this.instance=e,this.instance.StreamResolution=this,this.i18n=t||{},this.renderToolbarButton()}renderToolbarButton(){const e=this.instance.getChildByClass(this.instance.root,"gm-toolbar");if(!e)return;const t=e.children[0];this.select=document.createElement("select"),this.select.className="gm-icon-button gm-streamres-button",this.select.title=this.i18n.STREAMRES_TITLE||"Quality",n.forEach(e=>{this.select.add(new Option(e.text,e.value))}),this.select.onchange=this.onStreamResolutionChange.bind(this),t.appendChild(this.select)}onStreamResolutionChange(){const e={type:"SIZE",width:Number(this.select.value)};this.instance.sendEvent(e),this.select.blur()}}},{}],144:[function(e,t,i){t.exports=class{constructor(e){this.overlays=[],this.savedState=null,this.toolbarBtnImage=null,this.instance=e,this.instance.registerEventCallback("close-overlays",this.closeOverlays.bind(this))}closeOverlays(){this.overlays.forEach(e=>{e&&!e.classList.contains("gm-hidden")&&(e.classList.add("gm-hidden"),e.onclose&&e.onclose())}),this.instance.emit("keyboard-enable"),this.toolbarBtnImage&&this.toolbarBtnImage.classList.remove("gm-active")}saveState(){this.savedState||(this.savedState={toolbarBtn:{className:this.toolbarBtn.className,onclick:this.toolbarBtn.onclick},toolbarBtnImage:{className:this.toolbarBtnImage.className}})}restoreState(){this.savedState&&(this.toolbarBtn.className=this.savedState.toolbarBtn.className,this.toolbarBtnImage.className=this.savedState.toolbarBtnImage.className,this.toolbarBtn.onclick=this.savedState.toolbarBtn.onclick,this.savedState=null)}disable(){this.toolbarBtn&&this.toolbarBtnImage&&(this.saveState(),this.toolbarBtn.className+=" gm-disabled-widget-pop-up",this.toolbarBtnImage.className+=" gm-disabled-widget-icon",this.toolbarBtn.onclick=null)}enable(){this.toolbarBtn&&this.toolbarBtnImage&&this.restoreState()}}},{}],145:[function(e,t,i){const n={createSwitch:e=>{let{onChange:t}=e;const i=document.createElement("div");i.style.position="relative",i.style.display="inline-block",i.style.width="50px",i.style.height="20px";const n=document.createElement("input");n.type="checkbox",n.style.opacity="0",n.style.width="0",n.style.height="0";const s=document.createElement("span");s.style.position="absolute",s.style.cursor="pointer",s.style.top="0",s.style.left="0",s.style.right="0",s.style.bottom="0",s.style.backgroundColor="#ccc",s.style.transition=".4s",s.style.borderRadius="15px";const a=document.createElement("span");a.style.position="absolute",a.style.content="",a.style.height="30px",a.style.width="30px",a.style.left="-3px",a.style.bottom="-5px",a.style.backgroundColor="white",a.style.transition=".4s",a.style.borderRadius="50%",s.appendChild(a),i.appendChild(n),i.appendChild(s);const r=e=>{n.checked!==e&&(n.checked=e,n.checked?(s.style.backgroundColor="#E6195E",a.style.transform="translateX(26px)"):(s.style.backgroundColor="#ccc",a.style.transform="translateX(0)"),t&&"function"==typeof t&&t(n.checked))};return s.addEventListener("click",()=>{r(!n.checked)}),i.setState=r,i}};t.exports={switchButton:n}},{}],146:[function(e,t,i){t.exports=[{name:"High-end device",label:"High-end device",readByteRate:200},{name:"Mid-range device",label:"Mid-range device",readByteRate:100},{name:"Low-end device",label:"Low-end device",readByteRate:50},{name:"Custom",label:"Custom device"}]},{}],147:[function(e,t,i){t.exports=[{id:4,name:"great",label:"Great"},{id:3,name:"good",label:"Good"},{id:2,name:"moderate",label:"Moderate"},{id:1,name:"poor",label:"Poor"},{id:0,name:"none",label:"None"}]},{}],148:[function(e,t,i){t.exports=[{id:7,name:"5g",label:"5G"},{id:6,name:"lte",label:"4G LTE"},{id:5,name:"hsdpa",label:"3G HSDPA"},{id:4,name:"umts",label:"3G UMTS"},{id:3,name:"edge",label:"2G EDGE"},{id:2,name:"gprs",label:"2G GPRS"},{id:1,name:"gsm",label:"2G GSM"},{id:0,name:"none",label:"Unlimited"}]},{}],149:[function(e,t,i){t.exports=[{id:8,name:"wifi",label:"Wifi",downSpeed:{label:"40.0Mb/s",value:4e4},downDelay:{label:"0ms",value:0},downPacketLoss:{label:"0%",value:0},upSpeed:{label:"33.0Mb/s",value:33e3},upDelay:{label:"0ms",value:0},upPacketLoss:{label:"0%",value:0},dnsDelay:{label:"0ms",value:0}},{id:7,name:"4g_with_loss",label:"4G (High packet losses)",downSpeed:{label:"17.9Mb/s",value:17900},downDelay:{label:"50ms",value:50},downPacketLoss:{label:"10%",value:10},upSpeed:{label:"5.5Mb/s",value:5500},upDelay:{label:"50ms",value:50},upPacketLoss:{label:"10%",value:10},dnsDelay:{label:"100ms",value:100}},{id:6,name:"4g_with_delay",label:"4G (High DNS delay)",downSpeed:{label:"17.9Mb/s",value:17900},downDelay:{label:"50ms",value:50},downPacketLoss:{label:"0.01%",value:.01},upSpeed:{label:"5.5Mb/s",value:5500},upDelay:{label:"50ms",value:50},upPacketLoss:{label:"0.01%",value:.01},dnsDelay:{label:"3000ms",value:3e3}},{id:5,name:"4g",label:"4G",downSpeed:{label:"17.9Mb/s",value:17900},downDelay:{label:"50ms",value:50},downPacketLoss:{label:"0.01%",value:.01},upSpeed:{label:"5.5Mb/s",value:5500},upDelay:{label:"50ms",value:50},upPacketLoss:{label:"0.01%",value:.01},dnsDelay:{label:"100ms",value:100}},{id:4,name:"3g",label:"3G",downSpeed:{label:"7.2Mb/s",value:7200},downDelay:{label:"100ms",value:100},downPacketLoss:{label:"0.01%",value:.01},upSpeed:{label:"1.5Mb/s",value:1500},upDelay:{label:"100ms",value:100},upPacketLoss:{label:"0.01%",value:.01},dnsDelay:{label:"200ms",value:200}},{id:3,name:"edge",label:"EDGE",downSpeed:{label:"240Kb/s",value:240},downDelay:{label:"400ms",value:400},downPacketLoss:{label:"0.01%",value:.01},upSpeed:{label:"200Kb/s",value:200},upDelay:{label:"400ms",value:400},upPacketLoss:{label:"0.01%",value:.01},dnsDelay:{label:"800ms",value:800}},{id:2,name:"gprs",label:"GPRS",downSpeed:{label:"40Kb/s",value:40},downDelay:{label:"500ms",value:500},downPacketLoss:{label:"0.01%",value:.01},upSpeed:{label:"40Kb/s",value:40},upDelay:{label:"500ms",value:500},upPacketLoss:{label:"0.01%",value:.01},dnsDelay:{label:"1000ms",value:1e3}},{id:1,name:"no_data",label:"No data",downSpeed:{label:"0Kb/s",value:0},downDelay:{label:"0ms",value:0},downPacketLoss:{label:"0%",value:0},upSpeed:{label:"0Kb/s",value:0},upDelay:{label:"0ms",value:0},upPacketLoss:{label:"0%",value:0},dnsDelay:{label:"0ms",value:0}},{id:0,name:"native",label:"Native",downSpeed:{label:"N/A",value:1/0},downDelay:{label:"N/A",value:0},downPacketLoss:{label:"N/A",value:0},upSpeed:{label:"N/A",value:1/0},upDelay:{label:"N/A",value:0},upPacketLoss:{label:"N/A",value:0},dnsDelay:{label:"N/A",value:0}}]},{}],150:[function(e,t,i){const{generateUID:n}=e("../utils/helpers"),s={isWebRTCConnectionReady:!1},a=(e,t)=>{switch(t.type){case"WEBRTC_CONNECTION_READY":return{...e,isWebRTCConnectionReady:t.payload};default:return e}};t.exports=e=>{((e,t,i)=>{const s=[],a=()=>e.store.state;e.store={state:i,getState:a,dispatch:i=>{e.store.state=t(e.store.state,i),s.forEach(e=>{let{cb:t}=e;t()})},subscribe:e=>{const t=n();s.push({uid:t,cb:()=>e(a())});return()=>{const e=s.findIndex(e=>{let{uid:i}=e;return i===t});e>=0&&s.splice(e,1)}}}})(e,a,s)}},{"../utils/helpers":151}],151:[function(e,t,i){t.exports={generateUID:function(){const e=Date.now().toString(36);return e.substring(e.length-5)+Math.random().toString(36).substring(2,7)}}},{}],152:[function(e,t,i){t.exports=function(){const e=this;this.socket=null,this.token=null,this.hasError=!1,this.isUploading=!1,this.uploadedSize=0,this.file=null,this.address=null,this.MEGABYTE=1e6,e.getChunkSize=function(t){const i=5*e.MEGABYTE,n=75*e.MEGABYTE;return Math.max(i,Math.min(.1*t,n))},e.onOpen=function(){const t={type:"token",token:e.token};e.socket.send(JSON.stringify(t))},e.onClose=function(){setTimeout((function(){e.connect(e.address)}),1e3)},e.connect=function(t){e.socket=new WebSocket(t),e.socket.binaryType="arraybuffer",e.socket.onopen=e.onOpen,e.socket.onerror=e.onFailure,e.socket.onmessage=e.onSocketMsg,e.socket.onclose=e.onClose},e.onFailure=function(){e.isUploading=!1,postMessage({type:"FILE_UPLOAD",code:"FAIL"})},e.uploadData=function(t){!1===e.hasError&&e.socket.send(t.target.result,{binary:!0})},e.onSocketMsg=function(t){const i=JSON.parse(t.data);if("FILE_UPLOAD"===i.type)switch(i.code){case"NEXT":if(e.uploadedSize<e.file.size){const t=e.getChunkSize(e.file.size);let i;const n=new FileReader;n.onload=e.uploadData,n.onabort=e.onFailure,n.onerror=e.onFailure,e.file.size-e.uploadedSize>t?(i=e.file.slice(e.uploadedSize,e.uploadedSize+t),e.uploadedSize+=t):(i=e.file.slice(e.uploadedSize),e.uploadedSize=e.file.size),n.readAsArrayBuffer(i)}else{const t={type:"FILE_UPLOAD",done:!0};e.socket.send(JSON.stringify(t)),e.isUploading=!1}break;case"PROGRESS":case"SUCCESS":postMessage(i);break;case"FAIL":e.hasError=!0,postMessage(i)}},e.onmessage=function(t){const i=t.data;switch(i.type){case"address":e.token=i.token,e.address=i.fileUploadAddress,e.connect(e.address);break;case"close":e.isUploading=!1,e.socket&&(e.socket.onclose=null,e.socket.close());break;case"upload":if(!e.isUploading){e.file=i.file,e.isUploading=!0,e.hasError=!1,e.uploadedSize=0;const t={type:"FILE_UPLOAD",name:e.file.name,size:e.file.size};e.socket.send(JSON.stringify(t))}}}}},{}]},{},[119])(119)}));